(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{7164:function(e,l,t){Promise.resolve().then(t.bind(t,62517))},62517:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return lh}});var n,o,i=t(57437),r=t(53436),s=t(13894),a=t(19252),d=t(55037),u=t.n(d),c=t(60059),v=t(86262),m=t(49070),p=t(2265),h=t(47978),f=t(48614),x=t(30278),g=t(28431),b=t.n(g),y=t(71096),w=t.n(y),j=t(22495),I=t.n(j),k=t(7310),C=t.n(k),A=t(8782),N=t(8783),E=t(71623),S=t(45721),L=t.n(S);function T(e){let{name:l}=e;return(0,i.jsx)("div",{className:"py-[10px] font-bold text-[12px] text-bwleftdate uppercase px-[14px] border-b-[1px] transition-all duration-300 border-b-darkcolor/[0.1]",children:l})}var P=t(86520),R=t(84979),_=t(91528),O=t(64798),M=t.n(O),D=t(48547),Z=t(46314),F=t.n(Z),B=t(56210);let U=(0,p.forwardRef)((e,l)=>{let{onChange:n,onClear:o,isDisabled:r,value:s}=e,a=(0,p.useRef)(null);return(0,i.jsx)("div",{className:(0,B.cn)("absolute z-10 right-0 group focus-within:bg-darkcoloro rounded-md mx-3.5",F().searchInputTemp,{"pointer-events-none":r,[F().hasFilterText]:!!s,"bg-darkcoloro dark:bg-transparent":!!s}),children:(0,i.jsxs)("div",{className:(0,B.cn)("relative flex w-full focus-within:border focus-within:border-darkcolor/15 dark:border-white/50 rounded-md",{border:!!s}),children:[(0,i.jsx)("div",{className:(0,B.cn)("relative rounded-l-md z-10 flex items-center justify-center dark:text-bwleftdate/90 text-bwleftdate/90 group-focus-within:bg-darktoptext/10 group-focus-within:pointer-events-none",F().magnifyingGlassIcon,{"bg-darktoptext/10 !justify-center":!!s}),onClick:()=>{var e;null===(e=a.current)||void 0===e||e.focus()},children:(0,i.jsx)(D.G,{icon:t(65152).faMagnifyingGlass})}),(0,i.jsx)("input",{className:"text-sm text-darkcolor bg-transparent h-9 !outline-none pl-1 !w-[calc(100%-76px)]",placeholder:"Search conversations",onChange:n,ref:e=>{"function"==typeof l?l(e):l&&(l.current=e),a.current=e},dir:"auto"}),(0,i.jsx)("div",{id:"close-icon-container",className:(0,B.cn)("absolute right-0 inset-y-0 z-20 flex w-9 border-l border-l-darkcolor/15 cursor-pointer hover:bg-darkcolor/5 transition-all duration-300 items-center justify-center",F().clearIcon,{"opacity-0":!s}),onClick:e=>{e.preventDefault(),null==o||o()},children:(0,i.jsx)(D.G,{id:"close-icon",className:"opacity-60",icon:t(90361).EO,transform:{size:12}})})]})})});var z=t(29827),G=t(3916),W=t(5529),H=t(56383),q=t(89475),V=t(14301),K=t(67375),Q=t(14438),Y=t(95951);let J="https://static.abacus.ai/codellm/releases";function X(e){let{children:l,className:n}=e,[o,s]=(0,p.useState)(!0),[a,d]=(0,p.useState)(!1),[u,c]=(0,p.useState)(null),v=(0,p.useCallback)(()=>{let e=async()=>{var e,l,t,n;let o=null,i=null,r=null===(e=navigator.userAgent)||void 0===e?void 0:e.toLowerCase();if((null==r?void 0:r.includes("mac"))||(null==r?void 0:r.includes("darwin"))?o="darwin":(null==r?void 0:r.includes("win"))?o="windows":(null==r?void 0:r.includes("linux"))&&(o="linux"),"darwin"===o)i=(null==r?void 0:r.includes("mac"))&&/macintosh.*mac.*os.*x.*version.*\d+.*\d+.*\d+.*arm64/i.test(r)?"arm64":"x64";else try{if(navigator.userAgentData){let e=await (null===(t=navigator)||void 0===t?void 0:null===(l=t.userAgentData)||void 0===l?void 0:l.getHighEntropyValues(["architecture"])),o=null==e?void 0:null===(n=e.architecture)||void 0===n?void 0:n.toLowerCase();i=(null==o?void 0:o.includes("arm"))?"arm64":(null==o?void 0:o.includes("64"))?"x64":"ia32"}else i=(null==r?void 0:r.includes("arm"))?"arm64":(null==r?void 0:r.includes("x64"))||(null==r?void 0:r.includes("x86_64"))?"x64":"ia32"}catch(e){i="x64"}return"darwin"===o&&(i="arm64"),{platform:"".concat(o,"-").concat(i)}};return(async()=>{let l=await e();if(!l)return null;l.quality="stable";try{var t;let e=await fetch("https://abacus.ai/api/_getCodeLlmVersion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),n=await e.json();if(null==n?void 0:null===(t=n.result)||void 0===t?void 0:t.url){let e=n.result.url;if(e.endsWith(".tar.gz")&&l.platform.startsWith("linux")){let l=n.result.name;e="".concat(J,"/").concat(l,"/codellm_").concat(l,"_amd64.deb"),n.result.url=e}if(e.endsWith(".zip")&&l.platform.startsWith("darwin")){let t=l.platform.split("-")[1],o=n.result.name;e="".concat(J,"/").concat(o,"/CodeLLM.").concat(t,".").concat(o,".dmg"),n.result.url=e}if(e.endsWith(".zip")&&l.platform.startsWith("win")){let l=n.result.name;e="".concat(J,"/").concat(l,"/CodeLLMSetup-x64-").concat(l,".exe"),n.result.url=e}}return n}catch(e){return console.error("Error fetching code LLM version:",e),null}})()},[]);(0,p.useEffect)(()=>{v().then(e=>{(null==e?void 0:e.result)&&c({url:e.result.url,name:e.result.name})}).catch(e=>{console.error("Error pre-fetching CodeLLM version:",e)})},[v]);let m=(0,p.useCallback)(e=>{window.open(e,"_blank")},[]),h=(0,p.useCallback)(()=>{if(!(null==u?void 0:u.url)){Q.Am.error("Error: Download URL not available");return}Q.Am.info("Preparing download..."),(0,r.ptG)({isInstalled:!0}).then(()=>m(u.url)).catch(()=>m(u.url))},[u,m]),f=(0,p.useCallback)(e=>{if(!(null==u?void 0:u.name)){Q.Am.error("Version information not available");return}m("".concat(J,"/").concat(u.name,"/CodeLLM-darwin-").concat(e,"-").concat(u.name,".zip"))},[u,m]),x=(0,p.useCallback)(e=>{if(!(null==u?void 0:u.name)){Q.Am.error("Version information not available");return}m("".concat(J,"/").concat(u.name,"/CodeLLM.").concat(e,".").concat(u.name,".dmg"))},[u,m]),g=(0,p.useCallback)(e=>{if(!(null==u?void 0:u.name)){Q.Am.error("Version information not available");return}m("".concat(J,"/").concat(u.name,"/codellm_").concat(u.name,"_").concat(e,".deb"))},[u,m]),b=(0,p.useCallback)(e=>{if(!(null==u?void 0:u.name)){Q.Am.error("Version information not available");return}m("".concat(J,"/").concat(u.name,"/codellm-").concat(u.name,"-el9.").concat(e,".rpm"))},[u,m]),y=(0,p.useCallback)(e=>{if(!(null==u?void 0:u.name)){Q.Am.error("Version information not available");return}m("".concat(J,"/").concat(u.name,"/CodeLLM-linux-").concat(e,"-").concat(u.name,".tar.gz"))},[u,m]),j=(0,p.useCallback)(e=>{if(!(null==u?void 0:u.name)){Q.Am.error("Version information not available");return}m("".concat(J,"/").concat(u.name,"/CodeLLMUserSetup-").concat(e,"-").concat(u.name,".exe"))},[u,m]),I=(0,p.useCallback)(e=>{if(!(null==u?void 0:u.name)){Q.Am.error("Version information not available");return}m("".concat(J,"/").concat(u.name,"/CodeLLMSetup-").concat(e,"-").concat(u.name,".exe"))},[u,m]),k=(0,p.useCallback)(e=>{if(!(null==u?void 0:u.name)){Q.Am.error("Version information not available");return}m("".concat(J,"/").concat(u.name,"/CodeLLM-win32-").concat(e,"-").concat(u.name,".zip"))},[u,m]),C=(0,p.useCallback)(e=>{if(!(null==u?void 0:u.name)){Q.Am.error("Version information not available");return}m("".concat(J,"/").concat(u.name,"/CodeLLM-").concat(e,"-").concat(u.name,".msi"))},[u,m]),A=(0,p.useMemo)(()=>(0,i.jsxs)("div",{className:"flex flex-col items-center p-8",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Download Code LLM"}),(0,i.jsx)("h2",{className:"text-lg mb-8",children:"AI Code Assistant and Editor"}),(0,i.jsxs)("div",{className:"flex gap-4 mb-8",children:[(0,i.jsx)(V.Z,{isPrimary:!0,onClick:h,children:"Download CodeLLM"}),(0,i.jsx)(V.Z,{isPrimary:!0,onClick:()=>{Q.Am.info("Preparing..."),(0,r.afj)({expiresAt:w()().add(6,"months").toISOString()}).then(e=>{var l,t;let n=null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.apiKey,o=null==e?void 0:null===(t=e.result)||void 0===t?void 0:t.apiKeyId;if(n){let e=(0,K.m)(n,o);e&&((0,r.YG9)({apiKeyId:o,keepCount:2}).catch(e=>{console.error("Failed to delete other API keys:",e)}),(0,r.ptG)({isInstalled:!0}).then(()=>window.location.href=e).catch(()=>window.location.href=e))}else Q.Am.error("Failed to create code")}).catch(e=>{Q.Am.error("Error: "+e)})},children:"Open CodeLLM"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-8 w-full max-w-4xl",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsxs)("div",{className:"w-full mb-2 p-2 rounded-lg border",children:[(0,i.jsx)(D.G,{icon:t(79120).Av,className:"mr-2"}),"Download for Mac"]}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"macOS 10.15+"}),(0,i.jsx)("div",{className:"flex flex-col gap-2 mt-4",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium mb-1",children:".dmg"}),(0,i.jsxs)("div",{className:"text-xs text-purple-600",children:[(0,i.jsx)("span",{className:"mr-2 cursor-pointer hover:underline",onClick:()=>x("arm64"),children:"Apple silicon"}),(0,i.jsx)("span",{className:"mr-2 cursor-pointer hover:underline",onClick:()=>x("x64"),children:"Intel chip"})]})]})})]}),(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsxs)("div",{className:"w-full mb-2 p-2 rounded-lg border",children:[(0,i.jsx)(D.G,{icon:t(3751).qJ,className:"mr-2"}),"Download for Linux"]}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Debian, Ubuntu, Fedora, Redhat, etc."}),(0,i.jsxs)("div",{className:"flex flex-col gap-2 mt-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium mb-1",children:".deb - Ubuntu/Debian"}),(0,i.jsx)("div",{className:"text-xs text-purple-600",children:(0,i.jsx)("span",{className:"mr-2 cursor-pointer hover:underline",onClick:()=>g("amd64"),children:"x64"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium mb-1",children:".rpm - Fedora/Redhat"}),(0,i.jsx)("div",{className:"text-xs text-purple-600",children:(0,i.jsx)("span",{className:"mr-2 cursor-pointer hover:underline",onClick:()=>b("x86_64"),children:"x64"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium mb-1",children:".tar.gz - Others"}),(0,i.jsx)("div",{className:"text-xs text-purple-600",children:(0,i.jsx)("span",{className:"mr-2 cursor-pointer hover:underline",onClick:()=>y("x64"),children:"x64"})})]})]})]}),(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsxs)("div",{className:"w-full mb-2 p-2 rounded-lg border",children:[(0,i.jsx)(D.G,{icon:t(63454).ts,className:"mr-2"}),"Download for Windows"]}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Windows 10, 11"}),(0,i.jsxs)("div",{className:"flex flex-col gap-2 mt-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium mb-1",children:"User Installer"}),(0,i.jsx)("div",{className:"text-xs text-purple-600",children:(0,i.jsx)("span",{className:"mr-2 cursor-pointer hover:underline",onClick:()=>j("x64"),children:"x64"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium mb-1",children:"System Installer"}),(0,i.jsx)("div",{className:"text-xs text-purple-600",children:(0,i.jsx)("span",{className:"mr-2 cursor-pointer hover:underline",onClick:()=>I("x64"),children:"x64"})})]})]})]})]})]}),[h,f,x,g,b,y,j,I,k,C]);return(0,i.jsx)(i.Fragment,{children:o&&(0,i.jsxs)(i.Fragment,{children:[null==l&&(0,i.jsx)(Y.Z,{cancelText:"Ok",hideOkButton:!0,content:A,className:"text-center !z-[50]",children:(0,i.jsxs)("div",{className:"col-span-1 h-8 relative text-darktoptext flex gap-3 text-xs items-center cursor-pointer pl-1 ".concat(n),children:[(0,i.jsx)(D.G,{icon:a?t(39847).QD:t(28531).dT,transform:{size:18},spin:a}),(0,i.jsx)("div",{children:"CODELLM"})]})}),l]})})}var $=e=>{let{computerAgentInfo:l}=e,[n,o]=(0,p.useState)(!1),s=(0,p.useCallback)(async()=>{var e;o(!0);let t=await (0,r.syY)({deploymentId:l.deploymentId,name:m.be,externalApplicationId:l.externalApplicationId});o(!1),window.open("".concat(window.location.origin).concat(window.location.pathname,"?appId=").concat(l.externalApplicationId,"&convoId=").concat(null==t?void 0:null===(e=t.result)||void 0===e?void 0:e.deploymentConversationId))},[l]);return(0,i.jsx)("div",{className:"w-full",children:(0,i.jsx)("div",{className:"h-8 relative text-darktoptext flex gap-3 text-xs items-center cursor-pointer pl-1 justify-between",children:(0,i.jsxs)("div",{className:"flex gap-3 items-center relative",onClick:s,children:[n?(0,i.jsx)(D.G,{icon:t(68153).QD,spin:!0,transform:{size:18}}):(0,i.jsx)(D.G,{icon:t(54093).tc,transform:{size:18}}),(0,i.jsx)("div",{children:"OPERATOR"})]})})})},ee=t(41237),el=t(10013),et=t(93810),en=t.n(et),eo=t(86159);function ei(e){let{}=e,[l,n]=(0,p.useState)(!1),o=G.Z.calcRealHost(window.location.hostname);return(0,p.useEffect)(()=>{(0,r.OkA)({limit:50}).then(e=>{var l,t;n((null==e?void 0:null===(t=e.result)||void 0===t?void 0:null===(l=t.projects)||void 0===l?void 0:l.length)>0)}).catch(en())},[]),(0,i.jsx)(eo.Z,{title:"Agents Platform",side:"top",children:(0,i.jsx)("div",{className:"size-7 border border-darkcolor rounded-full relative text-darktoptext flex text-xs items-center justify-center cursor-pointer hover:bg-darkcolor/[0.1]",onClick:()=>{l?window.open("".concat(window.location.protocol+"//"+o,"/app/projects"),"_blank"):window.open("".concat(window.location.protocol+"//"+o,"/app/project_add?actualStep=3"),"_blank")},children:(0,i.jsx)(D.G,{icon:t(30938).dt,transform:{size:20}})})})}var er=t(82029);class es{setToken(e){this.octokit=new er.v({auth:e})}async getUserRepos(e){try{return(await this.octokit.repos.listForAuthenticatedUser({per_page:100})).data}catch(e){throw e}}async getRepoBranches(e,l){try{return(await this.octokit.repos.listBranches({owner:e,repo:l})).data}catch(e){throw e}}async getAuthenticatedUser(){try{return(await this.octokit.users.getAuthenticated()).data}catch(e){throw e}}constructor(){}}var ea=t(48958),ed=e=>{let{repos:l,onRepoChange:n,isContentLoading:o}=e,[r,s]=(0,p.useState)(""),a=(0,p.useRef)(),d=(0,p.useMemo)(()=>{let e=[];return r?(null==l||l.forEach(l=>{var t,n;(null===(n=l.name)||void 0===n?void 0:null===(t=n.toLowerCase())||void 0===t?void 0:t.includes(r.toLowerCase()))&&e.push(l)}),e):l},[l,r,o]),u=(0,p.useCallback)(M()(e=>{s(e)},300),[]);return(0,i.jsxs)("div",{className:"flex flex-col gap-6 p-6",children:[(0,i.jsxs)("div",{className:"flex  flex-col gap-6 ",children:[(0,i.jsx)("div",{className:"text-[20px] font-normal",children:"Select Repository"}),(0,i.jsx)("div",{className:"dark:bg-transparent rounded group",children:(0,i.jsxs)("div",{className:"relative flex w-full border-[1px] border-darkcolor/[0.15] dark:border-[#ffffff]/[0.5] rounded",children:[(0,i.jsx)("div",{className:"flex items-center  w-[34px] justify-center dark:text-darkcolor text-neutral-500 group-focus-within:text-bwleftblue group-focus-within:bg-bwleftblue/[0.1] group-focus-within:pointer-events-none ",children:(0,i.jsx)(D.G,{icon:t(65885).zh,transform:{size:24}})}),(0,i.jsx)("input",{className:"flex-1 text-darkcolor bg-transparent h-[40px] !outline-none pl-[4px]",placeholder:"Search Repo Name...",dir:"auto",ref:a,onChange:e=>{var l,t;u(null==e?void 0:null===(t=e.target)||void 0===t?void 0:null===(l=t.value)||void 0===l?void 0:l.trim())}}),(0,i.jsx)("div",{className:"flex flex-col w-[34px] border-l-[1px] border-l-darkcolor/[0.15] cursor-pointer",children:(0,i.jsx)("div",{className:"select-none flex-1 flex items-center justify-center hover:bg-darkcolor/[0.05] transition-all duration-300",onClick:()=>{s(null),a.current.value=""},children:(0,i.jsx)(D.G,{className:"opacity-60",icon:t(90361).EO,transform:{size:10}})})})]})}),(0,i.jsx)("div",{className:"border-t-[1px] border-neutral-300/[0.8]"})]}),(0,i.jsxs)("div",{className:"rounded border-[1px] border-neutral-300/[0.8] dark:text-neutral-300/[0.9] h-[300px] overflow-auto p-2",children:[o?(0,i.jsx)("div",{className:"flex items-center justify-center h-full text-bwleftblue",children:(0,i.jsx)(D.G,{spin:!0,icon:t(39847).QD})}):null,!o&&r&&(null==d?void 0:d.length)===0?(0,i.jsx)("div",{className:"text-darkcolor px-[14px] text-center",children:"No repositories found."}):null,null==d?void 0:d.map((e,l)=>(0,i.jsxs)("div",{className:"flex items-center gap-2 h-[32px] cursor-pointer",onClick:()=>{n(e)},children:[(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(D.G,{icon:e.private?t(48698).QR:t(88633).FL}),e.private?(0,i.jsx)("span",{className:"absolute top-[-2px] left-0",children:(0,i.jsx)(D.G,{icon:t(56388).by,transform:{size:7}})}):null]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("span",{className:"font-light",children:e.owner.login}),"/",(0,i.jsx)("span",{children:e.name})]})]},l))]}),(0,i.jsxs)("div",{className:"text-[13px] text-neutral-500",children:["Please install the ",(0,i.jsx)("a",{href:"https://github.com/apps/abacusai",className:"text-bwleftblue underline",target:"_blank",children:"Abacus.AI Github app"})," on your personal or organization accounts to access private repositories."]})]})},eu=t(65178),ec=t(60610),ev=e=>{let{progress:l}=e;return(0,i.jsx)(ec.fC,{style:{transform:"translateZ(0)"},className:"relative overflow-hidden bg-neutral-300 rounded-lg w-[150px] h-[8px]",value:l<=100?l:100,children:(0,i.jsx)(ec.z$,{className:"bg-bwleftblue ".concat(l>100?"bg-red-500":""," w-full h-full transition-transform duration-660 ease-custom-ease transform"),style:{transform:"translateX(-".concat(100-(l<=100?l:100),"%)")}})})},em=t(10854);let ep={moreFilesError:"You're trying to select more than 50 files. Select a few files in order to proceed.",moreTokensError:"You're trying to select too many files, and that exceeded the context length of 100K tokens. Select a few files in order to proceed."};var eh=e=>{var l,n;let{selectedRepo:o,accessTokenInfo:s,clearSelectedRepo:a,onClose:d}=e,[u,c]=(0,p.useState)(!1),[v,m]=(0,p.useState)(null),[h,f]=(0,p.useState)(null),[x,g]=(0,p.useState)("main"),[b,y]=(0,p.useState)([]),[w,j]=(0,p.useState)({}),[I,k]=(0,p.useState)(new Set),[C,A]=(0,p.useState)(!1),[N,E]=(0,p.useState)(""),[S,L]=(0,p.useState)([]),[T,P]=(0,p.useState)([]),R=(0,p.useRef)(!1),_=(0,p.useRef)(null),O=(0,p.useRef)(new es),{setSelectedGithubPersistenceFiles:Z,selectedGithubMetadataFiles:F}=(0,em.G)(),B=(0,p.useMemo)(()=>{let e=Object.values(w||{}).filter(e=>e.number_of_tokens>0).length;return R.current?0===e?"Update Files":"Update with ".concat(e," File").concat(e>1?"s":""):0===e?"Add Files":"Add ".concat(e," File").concat(e>1?"s":"")},[w,F,R.current]),U=(0,p.useMemo)(()=>{let e=0,l=Object.values(w||{}).filter(l=>{var t;let n=null!==(t=null==l?void 0:l.number_of_tokens)&&void 0!==t?t:0;return n&&(e+=n),n>0});return{numberOfTokens:100*e/1e5,numberOfFiles:l.length}},[w]),z=(0,p.useMemo)(()=>{if("main"!==x)return!!w[x];{var e,l;let t=Object.values(w||{});return t.length&&(null==v?void 0:null===(l=v.result)||void 0===l?void 0:null===(e=l[""])||void 0===e?void 0:e.num_descendents)===t.filter(e=>e.number_of_tokens>0).length}},[w,x,v]),G=(e,l)=>{let t={},n=0,i=0;t[l]={service:"githubuser",github_repo:"".concat(o.owner.login,"/").concat(o.name),github_path:l,number_of_tokens:0};let r=(e,s)=>{Object.values(e).forEach(e=>{let a=e[""]?e[""]:e,d=s?"".concat(s,"/").concat(a.name):a.name;if(a.name){if("dir"===a.type)t[a.path]={service:"githubuser",github_repo:"".concat(o.owner.login,"/").concat(o.name),github_path:l,number_of_tokens:0},r(e,d);else{var u;t[d]={service:"githubuser",github_repo:"".concat(o.owner.login,"/").concat(o.name),github_path:d,number_of_tokens:a.num_tokens},n+=null!==(u=a.num_tokens)&&void 0!==u?u:0,i+=1}}})};return r(e,l),{files:t,numberOfTokens:n,numberOfFiles:i}},W=(e,l)=>e?(Q.Am.error(ep.moreFilesError),!0):l?(Q.Am.error(ep.moreTokensError),!0):void 0,H=(e,l,t,n)=>{if(e){if("dir"===l.type){let e=W(l.num_descendents>50,l.num_tokens>1e5);if(e)return;let i=G(t,l.path);if(e=W(i.numberOfFiles>50,i.numberOfTokens>1e5))return;let r={...w,...i.files},s=e=>{let l=e.substring(0,e.lastIndexOf("/"));l&&Object.values(n||{}).every(e=>{var t;let n=(null==e?void 0:null===(t=e[""])||void 0===t?void 0:t.path)||(null==e?void 0:e.path);return n===l||r[n]})&&(r[l]={service:"githubuser",github_repo:"".concat(o.owner.login,"/").concat(o.name),github_path:l,number_of_tokens:0},s(l))};s(l.path),(e=W(Object.values(r||{}).filter(e=>e.number_of_tokens>0).length>50,!1))||(j(r),k(e=>{let l=new Set(e);return Object.keys(i.files).forEach(e=>l.delete(e)),l}))}else{if(W(Object.values(w||{}).filter(e=>e.number_of_tokens>0).length>49,!1))return;j(e=>{var t;let i={...e,[l.path]:{service:"githubuser",github_repo:"".concat(o.owner.login,"/").concat(o.name),github_path:l.path,number_of_tokens:null!==(t=l.num_tokens)&&void 0!==t?t:0}},r=e=>{let l=e.substring(0,e.lastIndexOf("/"));l&&Object.values(n||{}).every(e=>{var t;let n=(null==e?void 0:null===(t=e[""])||void 0===t?void 0:t.path)||(null==e?void 0:e.path);return n===l||i[n]})&&(i[l]={service:"githubuser",github_repo:"".concat(o.owner.login,"/").concat(o.name),github_path:l,number_of_tokens:0},r(l))};return r(l.path),i}),k(e=>{let t=new Set(e);return t.delete(l.path),t})}}else j(e=>{let n={...e},o=e=>{Object.values(e).forEach(e=>{var l,t;let i=(null==e?void 0:null===(l=e[""])||void 0===l?void 0:l.path)||(null==e?void 0:e.path);((null==e?void 0:null===(t=e[""])||void 0===t?void 0:t.type)==="dir"||"dir"===e.type)&&o(e),delete n[i]})};"dir"===l.type&&o(t),delete n[l.path];let i=e=>{let l=e.substring(0,e.lastIndexOf("/"));l&&Object.values(h[x][l]||{}).every(e=>{var l;return!n[(null==e?void 0:null===(l=e[""])||void 0===l?void 0:l.path)||(null==e?void 0:e.path)]})&&(delete n[l],i(l))};return i(l.path),n}),k(e=>{let t=new Set(e);return t.add(l.path),t})};(0,p.useEffect)(()=>{let e={};(null==F?void 0:F.length)>0&&o&&(null==v?void 0:v.success)&&(F.forEach(l=>{l.metadata.github_repo==="".concat(o.owner.login,"/").concat(o.name)&&(R.current=!0,l.metadata.github_paths.forEach(t=>{var n;let o=t.split("/"),i=null;for(let e of o)i=i?i[e]:v.result[e];e[t]={github_repo:l.metadata.github_repo,service:l.ServiceWorker,github_path:t,number_of_tokens:null!==(n=null==i?void 0:i.num_tokens)&&void 0!==n?n:l.size}}))}),j({...w,...e}))},[F,o,v]),(0,p.useEffect)(()=>{s&&(O.current.setToken(s.result.auth.accessToken),c(!0))},[s]),(0,p.useEffect)(()=>{(null==v?void 0:v[x])||(A(!0),(0,r.la6)({githubRepo:"".concat(o.owner.login,"/").concat(o.name)}).then(e=>{m(e),f({[x]:e.result})}).finally(()=>{A(!1)}))},[]),(0,p.useEffect)(()=>{if(x&&h){let e={};Object.entries((null==h?void 0:h[x])||{}).forEach(l=>{var t,n;let[i,r]=l,s=(null==r?void 0:null===(t=r[""])||void 0===t?void 0:t.path)||(null==r?void 0:r.path);(null==s?void 0:s.includes(x))&&w[x]&&!I.has(s)&&!Object.keys(h[x][i]||{}).some(e=>{var l;let t=null===(l=h[x][i][e])||void 0===l?void 0:l.path;return I.has(t)})&&(e[s]={service:"githubuser",github_repo:"".concat(o.owner.login,"/").concat(o.name),github_path:s,number_of_tokens:(null==r?void 0:r.type)==="dir"?0:null!==(n=r.num_tokens)&&void 0!==n?n:0})}),j(l=>({...l,...e}))}},[x,h,I]);let q=(0,p.useCallback)(M()(e=>{E(e.toLowerCase())},300),[]),K=(0,p.useCallback)(e=>{let l=[],t=e=>{if("object"==typeof e&&null!==e)for(let n in e)e[n]&&"object"==typeof e[n]&&"html_url"in e[n]?l.push("".concat(e[n].path,"___abacus_").concat(e[n].type)):t(e[n])};return t(e),l},[]),Y=(0,p.useCallback)(e=>{var l,t;E(""),_.current.value="",null==_||null===(l=_.current)||void 0===l||l.focus();let[n,o]=e.split("___abacus_"),i=n.split("/");"dir"!==o&&i.splice(i.length-1,1);let r=i.join("/");g(r),y(i);let s=null;for(let e of i)s=s?null==s?void 0:s[e]:null===(t=v.result)||void 0===t?void 0:t[e];f({[r]:s})},[v]);return(0,p.useEffect)(()=>{if(null==v?void 0:v.success){var e;L(null!==(e=K(null==v?void 0:v.result))&&void 0!==e?e:[])}},[v]),(0,p.useEffect)(()=>{N&&P(S.filter(e=>e.toLowerCase().split("___abacus")[0].includes(N)).sort((e,l)=>{let t=e.startsWith(N)?1:0,n=l.startsWith(N)?1:0;return t!==n?n-t:e.localeCompare(l)}))},[N]),(0,i.jsxs)("div",{className:"bg-darkcoloro text-[14px] mx-6 text-neutral-600/[0.9] dark:text-darkcolor/[0.8]",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"pr-[10px] cursor-pointer",children:(0,i.jsx)(D.G,{icon:t(39688).ac,onClick:()=>{if(b.length>0){var e,l;b.pop(),y(b),g(null!==(e=b[b.length-1])&&void 0!==e?e:"main");let t=v.result;for(let e=0;e<b.length;e++)t=t[b[e]];f({[null!==(l=b[b.length-1])&&void 0!==l?l:"main"]:t})}else a()},transform:{size:16}})}),(0,i.jsx)("div",{className:"border-r-[1px] h-[56px]"}),(0,i.jsx)("div",{className:"flex w-[110px]",children:(0,i.jsxs)("div",{className:"flex items-center gap-[5px] px-[15px]",children:[(0,i.jsx)(D.G,{icon:t(98511).mh}),(0,i.jsx)("div",{children:null!==(n=null==o?void 0:o.default_branch)&&void 0!==n?n:"-"})]})}),(0,i.jsx)("div",{className:"border-r-[1px] h-[56px]"}),(0,i.jsxs)("div",{className:"relative flex w-full items-center pr-[20px]",children:[(0,i.jsx)("input",{className:"flex-1 text-darkcolor bg-transparent h-[40px] !outline-none pl-[4px]",placeholder:"Go to file",dir:"auto",ref:_,onChange:e=>{var l,t;q(null==e?void 0:null===(t=e.target)||void 0===t?void 0:null===(l=t.value)||void 0===l?void 0:l.trim())}}),N?(0,i.jsx)("div",{className:" flex items-center justify-center w-[16px] h-[16px] right-[10px] text-darkwhite !bg-gray-400/[0.6] truncate dark:!bg-gray-600 hover:!bg-gray-400/[0.6] cursor-pointer flex items-center justify-center rounded-[10px] transition-all duration-300",onClick:()=>{E(null),_.current.value="",_.current.focus()},children:(0,i.jsx)(D.G,{className:"opacity-60",icon:t(90361).EO,transform:{size:10}})}):null,N?(0,i.jsxs)("div",{className:"absolute top-[2.5rem] h-[350px] left-[-172px] overflow-y-auto overflow-x-hidden w-[502px] bg-darkcoloro z-[1] p-[0.75rem] rounded-md border-neutral-300 border-[1px]",children:[null==T?void 0:T.map(e=>(0,i.jsxs)("div",{className:"h-[3rem] cursor-pointer flex gap-1.5 items-center",onClick:()=>{Y(e)},children:[(0,i.jsx)(D.G,{icon:e.includes("___abacus_dir")?t(19688).Pk:t(93802).gM}),(0,i.jsx)("div",{className:"w-[95%] break-word",children:e.split("___abacus")[0]})]},e)),(null==T?void 0:T.length)<1?(0,i.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:"No matches found"}):null]}):null]})]}),(0,i.jsx)("div",{className:"mx-[-24px]",children:(0,i.jsxs)("div",{className:"flex justify-between h-[64px] items-center bg-neutral-300/[0.3] dark:bg-neutral-300/[0.2] px-6",children:[(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(eu.Z,{className:"rounded-sm cursor-pointer !w-[16px] !h-[16px]",value:z,disabled:C||!(null==v?void 0:v.success),onChange:e=>{let l=v.result,t=[...b];for(let e of(t.splice(t.length-1,1),t))l=l[e];H(e,null==h?void 0:h[x][""],null==h?void 0:h[x],l)}}),(0,i.jsxs)("div",{className:"max-w-[340px]",children:[(0,i.jsx)("span",{children:o.owner.login}),"/",(0,i.jsx)("span",{children:o.name})," ",b.length>0?"/".concat(b.join("/")):null]})]}),(0,i.jsx)(V.Z,{className:"h-[32px] !bg-bwleftblue rounded-full text-white text-[14px]",disabled:0===U.numberOfFiles||U.numberOfFiles>50||U.numberOfTokens>100,onClick:()=>{let e={...w};for(let l of Object.keys(w))0===w[l].number_of_tokens&&delete e[l];Z(e),d()},children:B})]})}),(0,i.jsx)("div",{className:"text-[13px] text-red-500 text-center p-[2px] absolute bg-darkcoloro ".concat(U.numberOfTokens>100?"block":"hidden"),children:"You chose too many files, and that exceeded the context length of 100K tokens. Select a few files in order to proceed."}),(0,i.jsxs)("div",{className:" h-[300px] overflow-auto",children:[C?(0,i.jsx)("div",{className:"flex items-center justify-center h-full text-bwleftblue",children:(0,i.jsx)(D.G,{spin:!0,icon:t(39847).QD})}):null,null===(l=Object.keys((null==h?void 0:h[x])||{}))||void 0===l?void 0:l.map((e,l)=>{var n;if(""===e)return;let o=h[x][e][""]?h[x][e][""]:h[x][e],r=(null!==(n=o.num_tokens)&&void 0!==n?n:0)/1e5,s=!o.uploadable||o.num_tokens>1e5,a=s?o.upload_restriction||"Not uploadable":100*r<1?"<1%":"".concat((100*r).toLocaleString(void 0,{maximumFractionDigits:0,minimumFractionDigits:0}),"%");return(0,i.jsxs)("div",{className:"flex items-center gap-2 h-[40px] cursor-pointer border-b-[1px] border-neutral-600/[0.2] hover:bg-bwleftblue/[0.2] text-[13px]",children:[(0,i.jsx)(eu.Z,{disabled:s,className:"rounded-sm ".concat(s?"border-neutral-600/[0.2] pointer-events-none":"border-neutral-600/[0.6]"," !w-[16px] !h-[16px]"),value:!!w[o.path]||(Object.keys(w||{}).some(e=>e.startsWith("".concat(o.path,"/")))&&"dir"===o.type?"indeterminate":!!w[o.path]),onChange:e=>H(e,o,null==h?void 0:h[x][o.name],null==h?void 0:h[x])}),(0,i.jsxs)("div",{onClick:()=>{"dir"===o.type&&(E(""),y([...b,o.name]),g(o.path),f({[o.path]:h[x][o.name]}))},className:"flex gap-2 items-center flex-[2_2_0%]",children:[(0,i.jsx)(D.G,{icon:"dir"===o.type?t(19688).Pk:t(93802).gM}),(0,i.jsx)("div",{className:"max-w-[282px] overflow-hidden text-ellipsis whitespace-nowrap",children:o.name})]}),s?(0,i.jsx)("div",{className:"flex-1 text-red-500 text-[13px]",children:(0,i.jsx)(eo.Z,{side:"top",title:a,children:(0,i.jsx)(D.G,{icon:t(12398).xH,transform:{size:20}})})}):(0,i.jsx)("div",{className:"flex-1 text-[13px]",children:a})]},l)}),C||(null==h?void 0:h[x])?null:(0,i.jsx)("div",{className:"flex items-center justify-center h-full",children:"No files available."})]})]}),(0,i.jsx)("div",{className:"bg-neutral-300/[0.3] dark:bg-neutral-300/[0.2] mx-[-24px]",children:(0,i.jsxs)("div",{className:"mx-6 h-8 flex items-center text-[13px] text-neutral-500 dark:text-darkcolor/[0.8] gap-3",children:["Files to add to chat ",(0,i.jsx)(ev,{progress:U.numberOfTokens})," ","".concat(U.numberOfTokens.toLocaleString(void 0,{maximumFractionDigits:0,minimumFractionDigits:0}),"%")]})})]})},ef=e=>{let{repos:l,accessTokenInfo:t,onClose:n,isContentLoading:o}=e,[r,s]=(0,p.useState)();return(0,i.jsxs)("div",{children:[r?null:(0,i.jsx)(ed,{repos:l,onRepoChange:e=>{s(e)},isContentLoading:o}),r?(0,i.jsx)(eh,{selectedRepo:r,accessTokenInfo:t,clearSelectedRepo:()=>{s(null)},onClose:n}):null]})};let ex={connect:"GITHUB CONNECT",connecting:"CONNECTING GITHUB..."};var eg=e=>{let{oauthConfig:l,isDisabled:n}=e,o=(0,p.useRef)(new es),[s,a]=(0,p.useState)(null),[d,u]=(0,p.useState)(null),[c,v]=(0,p.useState)(null),[m,h]=(0,p.useState)(null),[f,x]=(0,p.useState)(!1),[g,b]=(0,p.useState)(!1),[y,w]=(0,p.useState)(ex.connect),j=(0,p.useRef)(null),I=(0,p.useRef)(null),k=()=>{let e=window.location.host;e.endsWith("abacus.ai")&&(e="abacus.ai");let t="".concat(null==l?void 0:l.url,"?client_id=").concat(null==l?void 0:l.clientId,"&redirect_uri=").concat(encodeURIComponent("https://".concat(e,"/oauth/callback"))),n=window.open(t,"GitHub OAuth");if(!n){Q.Am.error("Popup blocked! Please allow popups for this site.");return}j.current=n,I.current="github"},C=(0,p.useCallback)(()=>new Promise(e=>{(0,r.xGB)({applicationConnectorId:s.result.applicationConnectorId}).then(l=>{(null==l?void 0:l.success)?(a(null),w(ex.connect),v(null),u(null),x(!1),Q.Am.success("Github disconnected successfully."),e(!0)):(Q.Am.error(G.Z.isNullOrEmpty(l.error)?G.Z.errorDefault:""+l.error),e(!1))}).catch(l=>{Q.Am.error(G.Z.isNullOrEmpty(l)?G.Z.errorDefault:""+l),e(!1)})}),[s]),A=e=>{[ex.connect,ex.connecting].includes(y)&&e?Q.Am.error(G.Z.errorDefault):x(!0)},N=e=>{if(e.data.query&&"github"===I.current){let l=new URLSearchParams(e.data.query).get("code");l&&(u(l),setTimeout(()=>{j.current&&!j.current.closed&&(j.current.close(),j.current=null,I.current=null)},100))}},E=async()=>{try{return await (0,r.TdF)({})}catch(e){console.log(e)}},S=e=>{y!==ex.connecting&&w(ex.connecting),E().then(l=>{(null==l?void 0:l.success)?(o.current.setToken(l.result.auth.accessToken),setTimeout(()=>{a(l),e&&A(!1)},100)):(w(ex.connect),a({success:!1}))}).catch(e=>{w(ex.connect),a({success:!1})})};(0,p.useEffect)(()=>{S()},[]),(0,p.useEffect)(()=>{d&&(w(ex.connecting),(0,r.mrq)({authorizationCode:d}).then(e=>{(null==e?void 0:e.success)&&S(!0)}).catch(()=>{w(ex.connect)}))},[d]);let L=async()=>{try{y!==ex.connecting&&w(ex.connecting),b(!0);let e=await o.current.getAuthenticatedUser();(null==e?void 0:e.login)?(v(e),w("".concat(e.login.toUpperCase()," GITREPO - CONNECTED"))):w(ex.connect),b(!1)}catch(e){w(ex.connect),b(!1)}};(0,p.useEffect)(()=>{(null==s?void 0:s.success)&&L()},[s]);let T=async()=>{if(b(!0),null==c?void 0:c.login){let e=await o.current.getUserRepos(c.login);(null==e?void 0:e.length)>0&&h(e)}b(!1)};(0,p.useEffect)(()=>{(null==c?void 0:c.login)&&f&&T()},[c,f]);let P=(0,p.useCallback)(()=>{j.current&&!j.current.closed&&j.current.close(),j.current=null,I.current=null},[]);(0,p.useEffect)(()=>(window.addEventListener("message",N),()=>{window.removeEventListener("message",N),P()}),[]);let R=(0,p.useMemo)(()=>ex.connecting===y,[y]);return(0,i.jsxs)(i.Fragment,{children:[![ex.connect,ex.connecting].includes(y)&&(null==s?void 0:s.success)?(0,i.jsx)(Y.Z,{disableClickOutside:!0,title:"Are you sure?",zIndex:"z-[10001]",className:"w-auto",isDanger:!0,okText:"Disconnect",onClickOk:C,children:(0,i.jsx)(eo.Z,{title:"Disconnect Github",children:(0,i.jsxs)("div",{className:"group size-7 border border-darkcolor rounded-full relative text-darktoptext flex text-xs items-center justify-center cursor-pointer hover:bg-darkcolor/[0.1]",children:[R?(0,i.jsx)(D.G,{icon:t(68153).QD,transform:{size:22},spin:!0}):(0,i.jsx)(D.G,{icon:t(65885).zh,transform:{size:22}}),(0,i.jsx)("div",{className:"size-2.5 bg-green-500 rounded-full absolute -right-0.5 -top-0.5 flex items-center justify-center group-hover:bg-red-500 transition-colors duration-300",children:(0,i.jsx)(D.G,{icon:t(25667).faXmark,transform:{size:9},className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-white"})})]})})}):(0,i.jsx)("div",{className:"size-7 border border-darkcolor rounded-full relative text-darktoptext flex text-xs items-center justify-center cursor-pointer hover:bg-darkcolor/[0.1]",onClick:()=>{(null==s?void 0:s.success)?A(!0):k()},children:R?(0,i.jsx)(D.G,{icon:t(68153).QD,transform:{size:22},spin:!0}):(0,i.jsx)(D.G,{icon:t(65885).zh,transform:{size:22}})}),(0,i.jsx)(ea.Vq,{open:f,children:(0,i.jsxs)(ea.cZ,{className:"max-w-[530px] p-0",children:[(0,i.jsx)(ef,{repos:m,accessTokenInfo:s,onClose:()=>{x(!1)},isContentLoading:g}),(0,i.jsx)("div",{className:"absolute right-[8px] top-[4px] cursor-pointer",onClick:()=>{x(!1)},children:(0,i.jsx)(D.G,{icon:t(68770).g8})})]})})]})},eb=t(99376),ey=()=>{let e=(0,eb.useRouter)(),l=(0,p.useCallback)(async()=>{e.push("/?appId=ai_engineer")},[e]);return(0,i.jsx)("div",{className:"w-full",children:(0,i.jsx)("div",{className:"h-8 relative text-darktoptext flex gap-3 text-xs items-center cursor-pointer pl-1",children:(0,i.jsxs)("div",{className:"flex gap-3.5 items-center relative",onClick:l,children:[(0,i.jsx)(D.G,{icon:t(7687).jZ,transform:{size:18}}),(0,i.jsx)("div",{children:"AI ENGINEER"})]})})})},ew=t(73272);let ej=ew.fC,eI=p.forwardRef((e,l)=>{let{className:t,...n}=e;return(0,i.jsx)(ew.ck,{ref:l,className:(0,B.cn)("border-b",t),...n})});eI.displayName="AccordionItem";let ek=p.forwardRef((e,l)=>{let{className:n,children:o,...r}=e;return(0,i.jsx)(ew.h4,{className:"flex",children:(0,i.jsxs)(ew.xz,{ref:l,className:(0,B.cn)("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",n),...r,children:[o,(0,i.jsx)(D.G,{icon:t(33812).pt,transform:{size:14}})]})})});ek.displayName=ew.xz.displayName;let eC=p.forwardRef((e,l)=>{let{className:t,children:n,...o}=e;return(0,i.jsx)(ew.VY,{ref:l,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...o,children:(0,i.jsx)("div",{className:(0,B.cn)("pb-4 pt-0",t),children:n})})});eC.displayName=ew.VY.displayName;let eA=e=>{var l,n,o,r,s,a;let{data:d,validAppConnectors:u,appId:c,computerAgentInfo:v,isSearchLLM:m}=e,[h,f]=(0,p.useState)(null),{isWebSearchSelected:x,isComputerAgent:g}=(0,W.b)(e=>({isWebSearchSelected:e.isWebSearchSelected,isComputerAgent:e.isComputerAgent})),b=null==d?void 0:null===(n=d.result)||void 0===n?void 0:null===(l=n.organization)||void 0===l?void 0:l.isSelfServe;return(0,p.useEffect)(()=>{let e=()=>{g||(window.innerWidth>1280&&window.innerHeight>700?f("tools-item"):f(null))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[g]),(0,i.jsxs)(i.Fragment,{children:[g?null:(0,i.jsx)(ej,{className:"w-full",type:"single",defaultValue:"tools-item",collapsible:!0,value:h,onValueChange:e=>{f(e)},children:(0,i.jsxs)(eI,{value:"tools-item",className:"border-none",children:[(0,i.jsx)(ek,{className:"cursor-pointer text-darktoptext/[0.6] ".concat(h?"h-10":"h-5"),children:(0,i.jsx)("div",{className:"text-[12px] font-bold",children:"TOOLS"})}),(0,i.jsxs)(eC,{className:"grid grid-cols-2 gap-x-4",children:[b?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(X,{}),v?(0,i.jsx)($,{computerAgentInfo:v}):null,(0,i.jsx)(eN,{}),c!==G.Z.aiEngAppId?(0,i.jsx)(ey,{}):null]}):null,(0,i.jsxs)("div",{className:"col-span-2 bottom-[30px] flex items-center gap-2 pt-3 pb-0.5",children:[b?(0,i.jsx)(ei,{}):null,b?(0,i.jsx)(ee.Z,{position:"relative"}):null,m||c===G.Z.aiEngAppId?null:(0,i.jsx)(el.Z,{position:"relative",isFullWidth:!(null==d?void 0:null===(r=d.result)||void 0===r?void 0:null===(o=r.organization)||void 0===o?void 0:o.isSelfServe),isBottom:!1,isIcon:!0,isDisabled:x}),(null==u?void 0:null===(s=u.githubuser)||void 0===s?void 0:s.isUserLevelConnector)&&c!==G.Z.aiEngAppId&&!m?(0,i.jsx)(eg,{oauthConfig:null==u?void 0:null===(a=u.githubuser)||void 0===a?void 0:a.oauthConfig,isDisabled:x}):null]}),(0,i.jsx)("div",{className:"col-span-2",children:b?(0,i.jsxs)("div",{className:"flex gap-2 pt-3",children:[(0,i.jsx)("img",{onClick:()=>{window.open("https://apps.apple.com/us/app/chatllm-ai-chat-and-agents/id6502844681","_blank")},className:"cursor-pointer",alt:"ChatLLM App",src:"/chatllm/staticllm/app_store.svg"}),(0,i.jsx)("img",{onClick:()=>{window.open("https://play.google.com/store/apps/details?id=com.abacusai.chatllm&hl=en_US&pli=1","_blank")},className:"cursor-pointer",alt:"ChatLLM App",src:"/chatllm/staticllm/play_store.svg"})]}):null})]})]})}),b&&!h?(0,i.jsxs)("div",{className:"flex items-center gap-[18px] text-neutral-500 dark:text-darkcolor/[0.5]",children:[(0,i.jsx)(D.G,{icon:t(79120).Av,transform:{size:20},onClick:()=>{window.open("https://apps.apple.com/us/app/chatllm-ai-chat-and-agents/id6502844681","_blank")},className:"cursor-pointer"}),(0,i.jsx)(D.G,{icon:t(60838).us,transform:{size:20},onClick:()=>{window.open("https://play.google.com/store/apps/details?id=com.abacusai.chatllm&hl=en_US&pli=1","_blank")},className:"cursor-pointer"}),(0,i.jsx)(X,{className:"text-neutral-500 dark:text-darkcolor/[0.5]"})]}):null]})},eN=()=>{let e=(0,eb.useRouter)(),l=(0,p.useCallback)(()=>{e.push("/?appId=".concat(G.Z.appLlmEndAppId))},[e]);return(0,i.jsx)("div",{className:"col-span-1",children:(0,i.jsx)("div",{className:"h-8 relative text-darktoptext flex gap-3 text-xs items-center cursor-pointer pl-1",children:(0,i.jsxs)("div",{className:"flex gap-3.5 items-center relative",onClick:l,children:[(0,i.jsx)(D.G,{icon:t(37419).ov,transform:{size:18}}),(0,i.jsxs)("div",{className:" relative ",children:["APPLLM",(0,i.jsx)("div",{className:" absolute text-[10px] text-bwleftblue -top-[4px] -right-[25px] ",children:"NEW"})]})]})})})};var eE=t(59128),eS=t.n(eE),eL=t(65308),eT=t(35987),eP=t(21770),eR=t(81447),e_=t(591),eO=t(89307),eM=t(25415);function eD(e){var l,n;let{refetchConversations:o}=e,s=(0,eb.useRouter)(),[a,d]=(0,eM.Z)("projects-item-accordion","projects-item"),u=(0,m.T5)(),{data:c}=(0,m.Pc)({ignoreNeedLogin:!0}),v=(null==c?void 0:null===(l=c.result)||void 0===l?void 0:l.isChatOnly)!==!0,[h,f]=(0,m.PB)("projectId"),[x,g]=(0,m.PB)("convoId"),[b,y]=(0,m.PB)("appId"),{data:w,isLoading:j}=(0,eL.Z0)(),[I,k]=(0,p.useState)(!1),[C,A]=(0,p.useState)(null),N=(0,z.NL)(),{mutate:E}=(0,eP.D)({mutationFn:async e=>{var l;let t=await (0,r.Srz)({payload:e});if(t.success)return t.result;Q.Am.error(null!==(l=null==t?void 0:t.error)&&void 0!==l?l:G.Z.errorDefault)},onSuccess:e=>{N.invalidateQueries({queryKey:["projects"]}),k(!1),(null==u?void 0:u.externalApplicationId)&&y(null==u?void 0:u.externalApplicationId),f(null==e?void 0:e.chatllmProjectId),g(null)}}),[S,L]=(0,p.useState)(null),{mutate:T}=(0,eP.D)({mutationFn:async e=>{let l=await (0,r.DOk)({chatllmProjectId:e});if(!l.success){var t;throw Error(null!==(t=null==l?void 0:l.error)&&void 0!==t?t:G.Z.errorDefault)}},onSuccess:()=>{N.invalidateQueries({queryKey:["projects"]}),f(null),null==o||o()},onError:e=>{var l;Q.Am.error(null!==(l=e.message)&&void 0!==l?l:G.Z.errorDefault)}}),{mutate:P}=(0,eP.D)({mutationFn:async e=>{var l;let t=await (0,r.rEg)({payload:e});if(t.success)return t.result;Q.Am.error(null!==(l=null==t?void 0:t.error)&&void 0!==l?l:G.Z.errorDefault)},onSuccess:()=>{N.invalidateQueries({queryKey:["project",h]}),N.invalidateQueries({queryKey:["projects"]}),A(null)}});return(0,i.jsxs)(i.Fragment,{children:[I?(0,i.jsx)(eT.Z,{open:!0,onClose:()=>k(!1),onSave:e=>E({name:e.name,description:null==e?void 0:e.description})}):null,C&&(0,i.jsx)(eT.Z,{open:!0,onClose:()=>A(null),defaultName:null==C?void 0:C.name,defaultDescription:null!==(n=null==C?void 0:C.description)&&void 0!==n?n:"",onSave:e=>P({chatllmProjectId:null==C?void 0:C.chatllmProjectId,name:e.name,description:null==e?void 0:e.description})}),(0,i.jsx)(eO.aR,{open:!!S,onOpenChange:e=>e?null:L(null),children:(0,i.jsxs)(eO._T,{children:[(0,i.jsx)(eO.fY,{children:(0,i.jsx)(eO.f$,{children:"Do you want to delete the project?"})}),(0,i.jsxs)(eO.xo,{children:[(0,i.jsx)(eO.le,{size:"sm",className:"rounded-full px-4",children:"Cancel"}),(0,i.jsx)(eO.OL,{size:"sm",variant:"destructive",className:"rounded-full px-4",onClick:()=>T(S),children:"Delete"})]})]})}),(0,i.jsx)(ej,{className:"w-full",type:"single",defaultValue:"projects-item",collapsible:!0,value:a,onValueChange:e=>{d(e)},children:(0,i.jsxs)(eI,{value:"projects-item",className:"border-none",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between h-9 pl-3.5 pr-2 border-b border-b-darkcolor/[0.1]",children:[(0,i.jsxs)("div",{className:"font-bold text-xs text-bwleftdate uppercase cursor-pointer grow",onClick:()=>{s.push(v?"/admin/projects":"/projects")},children:["Projects"," ",(0,i.jsx)(eo.Z,{content:"View all",side:"right",children:(0,i.jsx)("span",{children:(0,i.jsx)(D.G,{icon:t(56940).gJ,transform:{size:14}})})})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)(eo.Z,{content:"New Project",side:"right",children:(0,i.jsx)("span",{children:(0,i.jsx)(eR.z,{variant:"ghost",size:"icon-xs",onClick:()=>k(!0),className:"text-darktoptext/70 rounded-full",children:(0,i.jsx)(D.G,{icon:t(74751).r8,transform:{size:14}})})})}),(0,i.jsx)(ek,{className:"cursor-pointer h-9 mr-2.5"})]})]}),(0,i.jsx)(eC,{className:"max-h-32 overflow-y-auto group",children:j?null:(null==w?void 0:w.length)?w.slice().reverse().map(e=>(0,i.jsx)(eZ,{open:h===e.chatllmProjectId,project:e,onEdit:e=>{A(e)},onDelete:()=>L(null==e?void 0:e.chatllmProjectId),onClick:()=>{(null==u?void 0:u.externalApplicationId)&&y(null==u?void 0:u.externalApplicationId),g(null),f(e.chatllmProjectId)},defaultProjectLLMId:null==u?void 0:u.externalApplicationId},e.chatllmProjectId)):null})]})})]})}function eZ(e){let{open:l,project:n,onEdit:o,onDelete:r,onClick:s,defaultProjectLLMId:a}=e,[d,u]=(0,p.useState)(l),[c,v]=(0,m.PB)("projectId"),[h,f]=(0,m.PB)("convoId"),{data:x}=(0,eL.jw)({projectId:n.chatllmProjectId,enabled:d}),g=null==x?void 0:x.some(e=>e.deploymentConversationId===h);return(0,p.useEffect)(()=>{u(l)},[l]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{id:"project-item",className:(0,B.cn)("ml-2.5 h-[38px] pl-2 pr-2 flex items-center gap-1 transition-all duration-300 cursor-pointer rounded-l-full text-darktoptext/70 group",{"bg-bwleftblue/25 dark:bg-bwleftblue/40":l&&!g}),onClick:e=>{var l;(null===(l=e.target)||void 0===l?void 0:l.id)==="project-item"&&s()},children:[(0,i.jsx)(eR.z,{variant:"ghost",size:"icon-xs",className:"rounded-full shrink-0",onClick:()=>{d?(f(null),v(null)):u(!0)},children:d?(0,i.jsx)(D.G,{icon:t(76916).cC,transform:{size:16,y:-1}}):(0,i.jsx)(D.G,{icon:t(23804).mD,transform:{size:16,y:-1}})}),(0,i.jsx)("div",{id:"project-item",className:"line-clamp-1 text-sm",children:n.name}),(0,i.jsx)("div",{id:"project-item",className:"grow"}),(0,i.jsx)("div",{className:(0,B.cn)("opacity-0 group-hover:opacity-100 transition-opacity duration-300",{"opacity-100":l&&!g}),children:(0,i.jsxs)(e_.h_,{modal:!0,children:[(0,i.jsx)(e_.$F,{asChild:!0,children:(0,i.jsxs)(eR.z,{variant:"ghost",size:"icon-xs",className:"rounded-full shrink-0",children:[(0,i.jsx)(D.G,{icon:t(91559).S6,transform:{size:16}}),(0,i.jsx)("span",{className:"sr-only",children:"More"})]})}),(0,i.jsxs)(e_.AW,{className:"w-fit max-w-60 rounded-lg",side:"right",align:"start",children:[(0,i.jsxs)(e_.Xi,{className:"cursor-pointer gap-2",onSelect:()=>o(n),children:[(0,i.jsx)(D.G,{icon:t(25785).Iw,transform:{size:16}}),(0,i.jsx)("span",{children:"Edit"})]}),(0,i.jsxs)(e_.Xi,{className:"cursor-pointer text-destructive focus:bg-destructive/10 focus:text-destructive dark:text-red-500 gap-2",onSelect:()=>r(null==n?void 0:n.chatllmProjectId),children:[(0,i.jsx)(D.G,{icon:t(31898).Vu,transform:{size:16}}),(0,i.jsx)("span",{children:"Delete Project"})]})]})]})})]}),d&&(null==x?void 0:x.length)?(0,i.jsx)("div",{className:"ml-7 border-l border-neutral-300 dark:border-neutral-700",children:x.map(e=>(0,i.jsx)(eF,{conversation:e,project:n,defaultProjectLLMId:a},e.deploymentConversationId))}):null]})}function eF(e){let{conversation:l,project:t,defaultProjectLLMId:n}=e;return(0,i.jsx)(h.Z,{data:l,isLoading:!1,isAdminPage:!1,onEditName:()=>{},isEditNameAny:!1,appId:null,isForceSelected:!1,unseen:!1,project:t,isSelfServe:!0,defaultProjectLLMId:n})}var eB=t(57099);let eU=()=>{var e;let l=(0,eb.useRouter)(),{data:n}=(0,m.Pc)({ignoreNeedLogin:!0}),o=(null==n?void 0:null===(e=n.result)||void 0===e?void 0:e.isChatOnly)!==!0;return(0,i.jsx)("div",{className:"flex items-center justify-between h-9 pl-3.5 pr-4 border-b border-b-darkcolor/[0.1]",onClick:()=>{l.push(o?"/admin/tasks":"/tasks")},children:(0,i.jsxs)("div",{className:"font-bold text-xs text-bwleftdate uppercase cursor-pointer grow",onClick:()=>{l.push(o?"/admin/projects":"/projects")},children:["Tasks"," ",(0,i.jsx)(eo.Z,{content:"View all",side:"right",children:(0,i.jsx)("span",{children:(0,i.jsx)(D.G,{icon:t(56940).gJ,transform:{size:14}})})})]})})};function ez(e){var l,t,n;let{deploymentId:o,dataInitUserInfo:s,dataInitConvosData:a,onEditName:d,isDeployError:u,appId:c,showTextAsNew:v,isMobile:g,isAgent:y,isHideTopBar:j,isAutonomousAgent:I,computerAgentInfo:k}=e,{data:S,error:L,isLoading:O}=(0,m.Pc)({dataInit:s,ignoreNeedLogin:!0}),D=(0,z.NL)(),{isLoading:Z}=(0,m.VR)({deploymentId:o,dataInit:a,refetchInterval:!!I&&1e4}),{data:F,isLoading:B}=(0,m.I_)({isSelfServe:c===G.Z.aiEngAppId}),{isEditNameAny:V,setIsEditNameAny:K,tempDeploymentConversationId:Q,onDeploymentConversationIdChanged:Y}=(0,R.h)(),[J,X]=(0,m.PB)("convoId"),[$,ee]=(0,p.useState)(null),el=(0,p.useRef)(),{listOfConversationsData:et,isSearchLLM:en}=(0,W.b)(e=>({listOfConversationsData:e.listOfConversationsData,isSearchLLM:e.isSearchLLM})),[eo]=(0,m.b2)(),[ei,er]=(0,p.useState)(null),[es,ea]=(0,m.PB)("agentPreviewMode"),ed=(0,p.useMemo)(()=>{var e,l;if(c===G.Z.appLlmEndAppId)return null;if(c===G.Z.aiEngAppId){if(null==F)return null}else if(null==et)return null;let t=c!==G.Z.aiEngAppId?[...null!==(e=null==et?void 0:et.result)&&void 0!==e?e:[]]:[...null!==(l=null==F?void 0:F.result)&&void 0!==l?l:[]];t=null==t?void 0:t.filter(e=>!(null==e?void 0:e.chatllmProjectId)),t=b()(t,["lastEventCreatedAt"],["desc"]),y&&(t=null==t?void 0:t.filter(e=>(null==e?void 0:e.conversationType)!=G.Z.testAgentConversationType));let n=[],o=null;return null==t||t.some((e,l)=>{let t=w()(null==e?void 0:e.lastEventCreatedAt),i=t.format("ll");if(t.isAfter(w()().startOf("day"))?i="Today":t.isAfter(w()().startOf("day").subtract(1,"days"))?i="Yesterday":t.isAfter(w()().startOf("day").subtract(4,"days"))&&(i=t.fromNow()),null==o||o!==i)o=i,n.push({name:i,items:[e]});else if((null==n?void 0:n.length)>0){let l=n[n.length-1];if(null!=l){var r;null===(r=l.items)||void 0===r||r.push(e)}}}),n},[et,F,c,en]),eu=(0,p.useMemo)(()=>{let e=[],l={};return $?(null==ed||ed.forEach(t=>{var n;null==t||null===(n=t.items)||void 0===n||n.forEach(n=>{var o,i;(null===(i=n.name)||void 0===i?void 0:null===(o=i.toLowerCase())||void 0===o?void 0:o.includes($.toLowerCase()))&&(l[t.name]>-1?e[l[t.name]].items.push(n):(l[t.name]=e.length,e.push({name:t.name,items:[n]})))})}),e):ed},[ed,$]);(0,p.useEffect)(()=>{ee(null),(null==el?void 0:el.current)&&(el.current.value=null)},[J,o,null==el?void 0:el.current]),(0,p.useEffect)(()=>{c===G.Z.aiEngAppId&&(0,r.lIh)()},[c,J]),(0,p.useEffect)(()=>{er(Math.floor(1e3*Math.random()))},[I]),(0,p.useEffect)(()=>{Q&&(c===G.Z.aiEngAppId&&D.invalidateQueries({queryKey:["listCopilotConvos"]}),X(Q||""),Y(null))},[Q,c]),(0,p.useMemo)(()=>{let e=[];for(let l=0;l<7;l++)e.push(l);return e},[]);let ec=(0,p.useCallback)(e=>{K(e),null==d||d(e)},[]),ev=(0,p.useCallback)(M()(e=>{ee(e)},300),[]),em=!et&&Z,ep=(0,p.useCallback)(e=>{var l,t;ev(null==e?void 0:null===(t=e.target)||void 0===t?void 0:null===(l=t.value)||void 0===l?void 0:l.trim())},[ev]),eh=(0,p.useCallback)(()=>{ee(null),el.current.value=null},[el]),[ef,{height:ex}]=(0,H.Z)(),[eg,{height:eb}]=(0,H.Z)(),ey=(0,p.useMemo)(()=>new E.ZP({fixedWidth:!0,defaultHeight:50}),[]),ew=(0,p.useMemo)(()=>{var e,l;return!!(null==S?void 0:null===(l=S.result)||void 0===l?void 0:null===(e=l.organization)||void 0===e?void 0:e.isSelfServe)},[S]),{data:ej}=(0,m.PJ)({enabled:ew}),eI=(0,m.T5)(),ek=(0,p.useMemo)(()=>{var e,l,t;let n=null==eu?eu:eS()(eu);for(let l=0;l<(null==n?void 0:n.length);l++){let t=n[l],o=null==t?void 0:null===(e=t.items)||void 0===e?void 0:e.filter(e=>(null==e?void 0:e.conversationType)!=q.i);n[l].items=[...o]}if(I){let e=[];for(let o=0;o<(null==n?void 0:n.length);o++){let i=n[o],r=null==i?void 0:null===(l=i.items)||void 0===l?void 0:l.filter(e=>{var l;return null==e?void 0:null===(l=e.metadata)||void 0===l?void 0:l.isSuccessfulTrigger}),s=null==i?void 0:null===(t=i.items)||void 0===t?void 0:t.filter(e=>{var l;return!(null==e?void 0:null===(l=e.metadata)||void 0===l?void 0:l.isSuccessfulTrigger)});n[o].items=[...r],e.push(...s)}if((null==e?void 0:e.length)>0){let l=e.sort((e,l)=>new Date(l.lastEventCreatedAt).getTime()-new Date(e.lastEventCreatedAt).getTime()).slice(0,5);n.push({name:"Unsuccessful Runs (Most Recent)",items:l})}}let o=null==n?void 0:n.map((e,l)=>{var t;return[(0,i.jsx)(T,{name:null==e?void 0:e.name},"convoTitle"+l)].concat(null==e?void 0:null===(t=e.items)||void 0===t?void 0:t.map((e,t)=>{var n,o;return(0,i.jsx)(h.Z,{appId:c,isEditNameAny:V,onEditName:ec,data:e,unseen:null==ej?void 0:ej.includes(null==e?void 0:e.deploymentConversationId),isSelfServe:null==S?void 0:null===(o=S.result)||void 0===o?void 0:null===(n=o.organization)||void 0===n?void 0:n.isSelfServe,defaultProjectLLMId:null==eI?void 0:eI.externalApplicationId},"convoOne"+l+"-"+t)}))});return null==o?o:C()(o)},[eu,V,ec,ej,I]),[eC,{width:eN,height:eE}]=(0,H.Z)(),eL=(0,p.useCallback)(e=>{let{index:l,key:t,parent:n,style:o}=e;return(0,i.jsx)(N.Z,{cache:ey,parent:n,columnIndex:0,rowIndex:l,children:e=>{let{measure:t}=e;return(0,i.jsx)("div",{style:o,onLoad:t,children:null==ek?void 0:ek[l]})}},t)},[ey,ek]);return(0,i.jsx)(f.M,{initial:null==a,children:(0,i.jsxs)(x.E.div,{className:" h-full block sm:absolute top-0 left-0 right-0 bottom-0 ",children:[em&&B?null:(0,i.jsx)("div",{className:"flex justify-center items-center z-[2] relative",children:!u&&(g||I)&&(null==S?void 0:S.result)!=null&&(0,i.jsx)(_.Z,{isMobile:g||I,deploymentId:o,appId:c,showTextAsNew:v,sideBySidePdf:!1,isSelfServe:null==S?void 0:null===(t=S.result)||void 0===t?void 0:null===(l=t.organization)||void 0===l?void 0:l.isSelfServe})}),(0,i.jsxs)("div",{ref:eg,children:[eB.featureFlags.showTasks&&ew?(0,i.jsx)(eU,{}):null,eB.featureFlags.showProjects&&ew&&c!==G.Z.aiEngAppId?(0,i.jsx)(eD,{refetchConversations:()=>{D.invalidateQueries({queryKey:["listConvos",o]})}}):null]}),(0,i.jsxs)("div",{ref:eC,className:" relative ",style:{height:"calc(100% - ".concat((null!=ex?ex:0)+(null!=eb?eb:0)+42,"px)")},children:[(null==ed?void 0:ed.length)>0&&!j?(0,i.jsx)(U,{onChange:ep,ref:el,onClear:eh,isDisabled:V,value:$}):null,(!em||!B)&&(0,i.jsx)(P.Z,{onlyVertical:!0,children:(0,i.jsxs)("div",{className:"  ",children:[$&&(null==eu?void 0:eu.length)===0?(0,i.jsx)("div",{className:"text-darktoptext dark:text-darktoptext pt-10 px-[14px] text-center",children:"No conversations found."}):null,(0,i.jsx)(A.ZP,{className:" ",width:eN,height:eE,rowCount:null!==(n=null==ek?void 0:ek.length)&&void 0!==n?n:0,rowHeight:null==ey?void 0:ey.rowHeight,deferredMeasurementCache:ey,rowRenderer:eL,overscanRowCount:5})]})})]}),em||B||c===G.Z.appLlmEndAppId||g||y?null:(0,i.jsx)("div",{className:"pt-[10px] mx-[20px] w-[calc(100%-40px)] flex flex-col gap-3 justify-between border-t border-darktoptext/15 absolute bottom-[30px]",ref:ef,children:(0,i.jsx)(eA,{appId:c,data:S,isSearchLLM:en,computerAgentInfo:k,validAppConnectors:eo})})]})})}function eG(e){let{dataInitUserInfo:l,dataInitConvosData:t,deploymentId:n,onClickExpand:o,isExpanded:r,isDeployError:a,appId:d,showTextAsNew:u,isMobile:c,isAgent:v,isHideTopBar:m,dataInitCopilotConvosData:h,isMatrixAgent:f,isReadyRenderUserInfo:x,isAutonomousAgent:g,isAssistedAgentCreation:b,computerAgentInfo:y}=e,[w,j]=(0,p.useState)(!1);return(0,i.jsx)("div",{className:" flex-col flex absolute left-0 top-0 bottom-0 right-0 ",children:(0,i.jsx)("div",{className:" flex-1 relative "+(r?"":" hidden "),children:d===s.Z.aiEngAppId||d===s.Z.appLlmEndAppId||n?(0,i.jsx)(ez,{isReadyRenderUserInfo:x,showTextAsNew:u,onEditName:e=>{j(e)},dataInitUserInfo:l,dataInitConvosData:t,appId:d,isDeployError:a,isAgent:v,isHideTopBar:m,deploymentId:n,isMobile:c,dataInitCopilotConvosData:h,isMatrixAgent:f,isAutonomousAgent:g,isAssistedAgentCreation:b,computerAgentInfo:y}):null})})}w().extend(I()),w().extend(L());var eW=t(98870);(n=o||(o={})).ACTIVE="ACTIVE",n.DEPLOYING="DEPLOYING",n.FAILED="FAILED",n.PENDING="PENDING",n.STOPPED="STOPPED",n.STOPPING="STOPPING",n.CANCELLED="CANCELLED",n.DELETING="DELETING";var eH=t(16593),eq=t(30166),eV=e=>{var l,t,n;let{isAutonomousAgent:o,isDeployError:r,hideCodeBlocksInit:s,deploymentId:a,botName:d,botIconUrl:u,highlightColorHex:c,dataInit:v,dataInitConvosData:m,dataInitChatParams:p,appId:h,agentId:f,isAgent:x,listExtApps:g,isChatLLM:b,isBinaryEnable:y,orgHost:w,isInternal:j,workflowGraph:I,validAppConnectors:k,agentInfo:C,isWorkflowAgentChatInterface:A}=e;null==I||null===(l=I.nodes[0])||void 0===l||l.input_mappings;let N=(null==I?void 0:null===(n=I.nodes[0])||void 0===n?void 0:null===(t=n.input_mappings)||void 0===t?void 0:t.length)>=2;return(0,i.jsx)(eW.ZP,{appIdOri:h,isAgent:x,isAutonomousAgent:o,isChatLLM:b,isBinaryEnable:N,listExtApps:g,dataInitConvosData:m,deploymentId:a,isDeployError:r,botIconUrlOri:u,highlightColorHex:c,hideCodeBlocksInit:s,isInternal:j,agentId:f,botNameOri:d,dataInit:v,dataInitChatParams:p,orgHost:w,isWorkflowAgent:!0,isWorkflowAgentChatInterface:A,workflowGraph:I,validAppConnectors:k,agentInfo:C})},eK=t(66888);let eQ=(0,eq.default)(()=>Promise.all([t.e(1205),t.e(5423),t.e(6683)]).then(t.bind(t,56683)),{loadableGenerated:{webpack:()=>[56683]},ssr:!1}),eY=(0,eq.default)(()=>t.e(9258).then(t.bind(t,39258)),{loadableGenerated:{webpack:()=>[39258]},ssr:!1}),eJ=(0,eq.default)(()=>Promise.all([t.e(3545),t.e(1709),t.e(9851),t.e(6401),t.e(8044),t.e(7608),t.e(3131),t.e(1771),t.e(288),t.e(4772),t.e(616),t.e(7072),t.e(3834),t.e(6663),t.e(8633),t.e(2040)]).then(t.bind(t,52048)),{loadableGenerated:{webpack:()=>[52048]},ssr:!1}),eX=(0,eq.default)(()=>t.e(4283).then(t.bind(t,74283)),{loadableGenerated:{webpack:()=>[74283]},ssr:!1});function e$(e){let{leftWidth:l,dataInitUserInfo:n,dataInitConvosData:s,deploymentId:a,dataInitChat:d,dataInitChatParams:u,appIdOri:v,isDark:h,agentId:g,isAgent:b,isChatLLM:y,isBinaryEnable:w,isMobileSSR:j,isIOS:I,isAndroid:k,isDeployError:C,isInternal:A,orgHost:N,highlightColorHex:E,isHideTopBar:S,isHostTeams:L,botName:T,botIconUrl:P,isSelfServe:R,listExtApps:_,extAppPredictionOverridesOri:O,isReadyRenderUserInfo:M,dataInitCopilotConvosData:Z,hideCodeBlocks:F}=e,[B,{width:U}]=(0,H.Z)(),[z,V]=(0,p.useState)(!0),[K,Y]=(0,m.PB)("sidebar"),[J,X]=(0,m.PB)("appId"),[$,ee]=(0,m.PB)("convoId"),[el,et]=(0,m.PB)("agentPreviewMode"),[en,eo]=(0,p.useState)([]),ei=(0,eb.useRouter)(),{setIsSearchLLM:er,setIsRouteLLM:es,setIsComputerAgent:ea,isComputerAgent:ed,setIsMatrixAgent:eu,setIsAutonomousAgent:ec,setIsAssistedAgentCreation:ev,setShowWebSearch:em,isAiEngineerWorkflowPreview:ep,listOfConversationsData:eh,showRightSidePanel:ef,setShowRightSidePanel:ex}=(0,W.b)(e=>({setIsSearchLLM:e.setIsSearchLLM,setIsRouteLLM:e.setIsRouteLLM,setIsComputerAgent:e.setIsComputerAgent,isComputerAgent:e.isComputerAgent,setIsMatrixAgent:e.setIsMatrixAgent,setIsAutonomousAgent:e.setIsAutonomousAgent,setIsAssistedAgentCreation:e.setIsAssistedAgentCreation,setShowWebSearch:e.setShowWebSearch,isAiEngineerWorkflowPreview:e.isAiEngineerWorkflowPreview,listOfConversationsData:e.listOfConversationsData,showRightSidePanel:e.showRightSidePanel,setShowRightSidePanel:e.setShowRightSidePanel})),eg=(0,m.z0)(),ey=(0,m.br)(),{isPreviewExpanded:ew}=(0,eK.W)(e=>({isPreviewExpanded:e.isPreviewExpanded})),ej=!0===ey,eI=!!J,{error:ek}=function(e){let{deploymentId:l,refetchOnWindowFocus:t=!0}=e,[n,o]=p.useState(!1),[i,s]=p.useState(null),a=!!i&&!["ACTIVE","STOPPED","FAILED","CANCELLED"].includes(i),{data:d}=(0,eH.a)({queryKey:["userInfo"],queryFn:()=>(0,r.FDQ)({ignoreNeedLogin:!0})}),{data:u}=(0,eH.a)({queryKey:["deployment",l],queryFn:()=>(0,r.vHz)({deploymentId:l}),enabled:!!l,refetchOnWindowFocus:t,refetchInterval:(!!a||!!n)&&1e4});return p.useEffect(()=>{if(u&&d){var e,l,t,n,i,r,a,c;let v=!1;(null==d?void 0:null===(l=d.result)||void 0===l?void 0:null===(e=l.organization)||void 0===e?void 0:e.isSelfServe)?(null==u?void 0:null===(c=u.result)||void 0===c?void 0:null===(a=c.status)||void 0===a?void 0:a.toUpperCase())==="FAILED"&&(v=!0):(null===(n=u.result)||void 0===n?void 0:null===(t=n.status)||void 0===t?void 0:t.toUpperCase())!=="ACTIVE"&&(null==u?void 0:null===(i=u.result)||void 0===i?void 0:i.needDeployment)&&(v=!0),s(null==u?void 0:null===(r=u.result)||void 0===r?void 0:r.status),o(v)}},[d,u]),{error:n,status:i,isProcessing:a}}({deploymentId:a,refetchOnWindowFocus:!0});(0,p.useEffect)(()=>{if(eI)return()=>{ei.refresh()}},[eI]);let eC=(0,p.useMemo)(()=>J||v,[J,v]),eA=(0,p.useMemo)(()=>{var e,l,t;return null!==(t=J?null==_?void 0:null===(l=_.result)||void 0===l?void 0:null===(e=l.find(e=>(null==e?void 0:e.externalApplicationId)===J))||void 0===e?void 0:e.predictionOverrides:null)&&void 0!==t?t:O},[J,O,_]),eN=(0,p.useMemo)(()=>{var e;return null==_?void 0:null===(e=_.result)||void 0===e?void 0:e.find(e=>{var l;return null==e?void 0:null===(l=e.predictionOverrides)||void 0===l?void 0:l.forComputerUse})},[_]);(0,p.useEffect)(()=>{let e=(null==eN?void 0:eN.externalApplicationId)&&(null==eN?void 0:eN.externalApplicationId)===eC;ea(e),e&&ex(e)},[eN,eC,$]),(0,p.useEffect)(()=>{var e,l;er(!!(null==eA?void 0:eA.isSearchLlm)),es(!!(null==eA?void 0:null===(l=eA.llmName)||void 0===l?void 0:null===(e=l.toLowerCase())||void 0===e?void 0:e.includes("route")))},[eA]);let[eE,eS]=(0,m.PB)("sideBySide"),[eL,eT]=(0,p.useState)({}),[eP,eR]=(0,p.useState)(!0),[e_,eO]=(0,p.useState)(!1),[eM,eD]=(0,p.useState)(null),eZ=(0,p.useCallback)(e=>{V(e=>!e)},[]);(0,p.useEffect)(()=>{eg&&V(!1)},[eg]);let eF=(0,p.useMemo)(()=>!ef&&(!!j||U<=980&&U>10),[U,j,ef]),eB=()=>{(0,r.Z7F)({}).then(e=>{eo(null==e?void 0:e.result)}).catch(e=>{eo(null)})},eU=e=>{var l,t,n,o;let i=(null==e?void 0:e.result)||{};if(eC===G.Z.testAiAgentAppId){i.workflowGraph=null==i?void 0:i.draftWorkflowGraph;let e=null==i?void 0:i.agentConfig;e.AGENT_INTERFACE=null==i?void 0:null===(t=i.draftWorkflowGraphInfo)||void 0===t?void 0:t.agentInterface,e.AGENT_CONNECTORS=null==i?void 0:null===(n=i.draftWorkflowGraphInfo)||void 0===n?void 0:n.agentConnectors,e.packageRequirements=null==i?void 0:null===(o=i.draftWorkflowGraphInfo)||void 0===o?void 0:o.packageRequirements,i.agentConfig=e}eR(!1);let r=Object.keys((null==i?void 0:null===(l=i.agentConfig)||void 0===l?void 0:l.AGENT_INPUT_SCHEMA)||{}).length>0,s=Object.keys((null==i?void 0:i.workflowGraph)||{}).length>0;(r||s)&&eT(i)},ez=(0,p.useMemo)(()=>{var e;return!!(null==eL?void 0:null===(e=eL.agentConfig)||void 0===e?void 0:e.AGENT_INPUT_SCHEMA)},[eL]),eq=(0,p.useMemo)(()=>!!(null==eL?void 0:eL.workflowGraph),[eL]),e$=(0,p.useMemo)(()=>{var e;return eq&&(null==eL?void 0:null===(e=eL.agentConfig)||void 0===e?void 0:e.AGENT_INTERFACE)==="CHAT"},[eL]),e0=(0,p.useMemo)(()=>{var e;return eq&&(null==eL?void 0:null===(e=eL.agentConfig)||void 0===e?void 0:e.AGENT_INTERFACE)==="AUTONOMOUS"},[eL]),e1=(0,p.useMemo)(()=>{var e;return(null==eL?void 0:null===(e=eL.agentConfig)||void 0===e?void 0:e.AGENT_INTERFACE)==="MATRIX"},[eL]);(0,p.useEffect)(()=>{var e,l;return eu((null==eL?void 0:null===(e=eL.agentConfig)||void 0===e?void 0:e.AGENT_INTERFACE)==="MATRIX"),ec(eq&&(null==eL?void 0:null===(l=eL.agentConfig)||void 0===l?void 0:l.AGENT_INTERFACE)==="AUTONOMOUS"),()=>{ec(!1),eu(!1)}},[eL,eq]),(0,p.useEffect)(()=>(ev(eC===G.Z.aiEngAppId&&!R),()=>{ev(!1)}),[eC,R]),(0,p.useEffect)(()=>{if(e0&&$){var e,l;if(eC!==G.Z.testAiAgentAppId&&eO(!0),(null==eh?void 0:null===(e=eh.result)||void 0===e?void 0:e.length)>0){let e=null==eh?void 0:null===(l=eh.result)||void 0===l?void 0:l.find(e=>(null==e?void 0:e.deploymentConversationId)===$);if(e){eD((null==e?void 0:e.conversationType)||"WORKFLOW_AGENT"),eO(!1);return}}else(0,r.Jqi)({deploymentId:a,deploymentConversationId:$,skipDocumentBoundingBoxes:!0,filterIntermediateConversationEvents:!1}).then(e=>{var l;eD((null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.conversationType)||"WORKFLOW_AGENT")}).catch(e=>{Q.Am.error("Error loading conversation"),eD("WORKFLOW_AGENT")}).finally(()=>{eO(!1)})}},[e0,$]);let e2=()=>{if(eR(!0),eB(),eC===G.Z.testAiAgentAppId){(0,r.T80)({agentId:g}).then(eU).catch(e=>{Q.Am.error("Error loading conversation"),eR(!1)}),eR(!1);return}(0,r.vHz)({deploymentId:a}).then(e=>{var l;let t=null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.modelVersion;(0,r.Or)({agentVersion:t||g}).then(eU).catch(e=>{Q.Am.error("Error loading conversation"),eR(!1)})}).catch(e=>{Q.Am.error("Error loading conversation"),eR(!1)})},e5=()=>{if(!el)return Promise.reject(Error("Agent preview mode is required"));let e=()=>(0,r.dLx)({deploymentId:a}).then(l=>{var t;return(null==l?void 0:null===(t=l.result)||void 0===t?void 0:t.find(e=>[o.PENDING,o.DEPLOYING].includes(null==e?void 0:e.lifecycle)))?new Promise(l=>{setTimeout(()=>{l(e())},2e3)}):(eR(!1),l)}).catch(e=>(console.error(e,"Error fetching deployment versions"),eR(!1),Promise.reject(e)));return e()};(0,p.useEffect)(()=>{let e=e=>{var l,t,n,o,i,r,s,a,d,u,c;let v=e=>e.split(".").slice(-2).join("."),m=v(new URL(e.origin).hostname),p=v(new URL(window.location.origin).hostname);m===p&&(null===(l=e.data)||void 0===l?void 0:l.type)==="AGENT_UPDATED"&&(null===(t=e.data)||void 0===t?void 0:t.from)==="AI_ENGINEER"&&(null===(n=e.data)||void 0===n?void 0:n.to)==="EMBEDDED_CHATWEB"&&(eR(!0),e5().then(()=>{e2(),ee(null)}).catch(e=>{console.error(e,"Error fetching agent info"),eR(!1)})),m===p&&(null===(o=e.data)||void 0===o?void 0:o.type)==="AGENT_UPDATED"&&(null===(i=e.data)||void 0===i?void 0:i.from)==="EMBEDDED_PLATFORM"&&(null===(r=e.data)||void 0===r?void 0:r.to)==="EMBEDDED_CHATWEB"&&document.querySelectorAll("iframe").forEach(e=>{if(G.Z.isValidUrl(e.src)){let l=new URL(e.src),t=l.hostname===new URL(window.location.origin).hostname;l.pathname.includes("chatllm")&&t&&e.contentWindow.postMessage({type:"AGENT_UPDATED",from:"AI_ENGINEER",to:"EMBEDDED_CHATWEB",data:{timestamp:Date.now()}},l.origin)}}),m===p&&(null===(s=e.data)||void 0===s?void 0:s.type)==="RELOAD_CONVERSATION"&&(null===(a=e.data)||void 0===a?void 0:a.from)==="PLATFORM"&&(null===(d=e.data)||void 0===d?void 0:d.to)==="EMBEDDED_CHATWEB"&&(ee(null),(null===(c=e.data)||void 0===c?void 0:null===(u=c.data)||void 0===u?void 0:u.refreshAgent)&&e2())};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[g,a]),(0,p.useEffect)(()=>{b&&g?e2():eT({})},[b,g,a]),(0,p.useEffect)(()=>{let e=e=>{if(null!=e){var l;let t=window.getSelection();if(!t||0===t.rangeCount)return;let n=t.getRangeAt(0).cloneContents();n.querySelectorAll("*").forEach(e=>{e instanceof HTMLElement&&(e.style.backgroundColor="transparent")});let o=document.createElement("div");o.appendChild(n);let i=t.toString()||"";i=null==i?void 0:null===(l=i.replace(/(\u00A0)|  \n|\n$/g,(e,l)=>"\xa0"===l?" ":"  \n"===e?"\n":"\n"===e?"":e))||void 0===l?void 0:l.trim(),e.clipboardData.setData("text/html",o.innerHTML),e.clipboardData.setData("text/plain",i||""),e.preventDefault()}};return document.addEventListener("copy",e),()=>{document.removeEventListener("copy",e)}},[]);let e6=(0,p.useMemo)(()=>{var e,l;return R&&(null==_?void 0:null===(l=_.result)||void 0===l?void 0:null===(e=l.filter(e=>{var l;return(null==e?void 0:e.isSystemCreated)===1&&!(null==e?void 0:null===(l=e.predictionOverrides)||void 0===l?void 0:l.forComputerUse)}))||void 0===e?void 0:e.some(e=>e.externalApplicationId===eC))},[R,_,eC]);(0,p.useEffect)(()=>{e6&&(async()=>{let e=await (0,r.xI2)({params:{externalApplicationId:eC}});if(null==e?void 0:e.success){var l;em(null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.enableWebSearch)}})()},[e6,eC]);let e3=(a||eC===G.Z.aiEngAppId||eC===G.Z.testAiAgentAppId||eC===G.Z.appLlmEndAppId)&&(!b||!eP)&&(!b||!e_),e4=(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(eG,{showTextAsNew:(ez||eq||e0)&&!e$,isReadyRenderUserInfo:M,isMatrixAgent:e1,isHideTopBar:S,isAutonomousAgent:e0,isExpanded:z||eF,onClickExpand:eZ,isAssistedAgentCreation:eC===G.Z.aiEngAppId&&!R,appId:eC,isAgent:b,isDeployError:C,deploymentId:a,isMobile:eF,dataInitCopilotConvosData:Z,computerAgentInfo:eN},"elemNav")}),e8=(0,p.useMemo)(()=>ej?0:550,[ej]),e9=b&&el&&eP?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center absolute inset-0 bg-[#131b26] gap-4 text-slate-300",children:[(0,i.jsx)(D.G,{spin:!0,icon:t(74519).go,transform:{size:60}}),(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,i.jsx)("div",{className:"text-xl pt-[20px]",children:"Loading latest agent configuration"}),(0,i.jsx)("div",{className:"text-sm text-white/70 dark:text-darkwhite/70",children:"(This might take a few minutes)"})]})]}):null,e7=(0,p.useMemo)(()=>ey?{}:eg?{width:e8,left:10}:{},[eg,ey]);return ek?(0,i.jsx)(c.Z,{deployId:a}):(0,i.jsxs)("div",{className:eF||S?" relative h-full ":" absolute top-0 bottom-0 left-0 right-0 ",ref:B,children:[!eF&&"1"!==eE&&!K&&!ed&&!ef&&!eg&&!ep&&!el&&(0,i.jsx)("div",{className:" absolute top-0 left-0 bottom-0 w-[260px] ",children:e4}),(0,i.jsxs)("div",{style:e7,className:eF||S||eC===G.Z.testAiAgentAppId?" bg-bwcentercolor absolute top-0 left-0 right-0 bottom-0 ":" transition-all duration-300 rounded-sm absolute top-0 right-0 bottom-0 sm:bottom-[12px] bg-bwcentercolor "+(ey?" ":" sm:right-[12px] ")+("1"===eE||"1"===K||ed||ef||ep||el?" left-0 ":" left-[260px] ")+(eg?ey?" ":" drop-shadow-[0_0_2px_rgba(0,0,0,0.25)] !rounded-r-[0px] ":" right-0 ")+(ej?" h-[400px] !left-0 ":" ")+(ef?"left-[12px] !right-0 rounded-tr-none rounded-br-none":""),children:[e9,e3&&(ez?(0,i.jsx)(eQ,{agentInfo:null==eL?void 0:eL.agentConfig,deploymentConversationId:null==u?void 0:u.deploymentConversationId,deploymentId:a,orgHost:N,botIconUrl:P,botName:T,conversationsList:s}):e1?(0,i.jsx)(eY,{deploymentId:a,isMobile:eF,appId:eC,orgHost:N,botName:T,isAndroid:k,isIOS:I,isSelfServe:R}):(null==u?void 0:u.deploymentConversationId)&&eM!=q.i||!e0?eq?(0,i.jsx)(eV,{isAutonomousAgent:e0,isWorkflowAgentChatInterface:e$,isDeployError:C,hideCodeBlocksInit:F,deploymentId:a,listExtApps:_,botName:T,botIconUrl:P,highlightColorHex:E,dataInit:d,dataInitConvosData:s,dataInitChatParams:u,appId:eC,agentId:g,isAgent:b,isChatLLM:y,isBinaryEnable:w,orgHost:N,isInternal:A,workflowGraph:null==eL?void 0:eL.workflowGraph,validAppConnectors:en,agentInfo:eL}):(0,i.jsx)(eW.ZP,{appIdOri:eC,isAgent:b,isHideTopBarParam:S,isChatLLM:y,isBinaryEnable:w,dataInitConvosData:s,deploymentId:a,isDeployError:C,isMobile:eF,isIOS:I,isAndroid:k,isHostTeams:L,botIconUrlOri:P,highlightColorHex:E,isSelfServe:R,hideCodeBlocksInit:F,listExtApps:_,isInternal:A,agentId:g,botNameOri:T,extAppPredictionOverrides:eA,dataInit:d,dataInitChatParams:u,orgHost:N,dataInitUserInfo:n}):(0,i.jsx)(q.Z,{deploymentId:a,isMobile:eF,isAndroid:k,isIOS:I,isSelfServe:R,agentInfo:eL,validAppConnectors:en,appId:eC}))]}),eg&&(0,i.jsx)(p.Suspense,{children:(0,i.jsx)(eX,{isDark:h})}),eg&&(0,i.jsx)(p.Suspense,{children:(0,i.jsx)(eJ,{isDark:h})}),eF||ed||S||ef?(0,i.jsxs)(f.M,{initial:!1,children:[K&&(0,i.jsx)("div",{onClick:e=>{Y(null)},className:"z-10 absolute top-0 left-0 right-0 bottom-0 bg-black/[0.5] ".concat(ef?"w-[100vw]":"")},"a1"),K&&(0,i.jsx)(x.E.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"".concat(ef?"100%":"80%")},exit:{opacity:0,width:0},className:" z-10 bg-gradient-to-tr to-bwbackto via-bwbackvia from-bwbackfrom to-[88%] via-[73%] from-[12%] absolute top-0 left-0 w-10/12 bottom-0 ".concat(ef?"":"max-w-sm"," ").concat(ed||ef?"":"shadow-[0_0_20px_rgba(0,0,0,0.6)]"),children:e4},"a2")]}):null]})}var e0=t(90216);function e1(e){let{initThemeData:l}=e,{isDark:t,theme:n,setTheme:o,ignoreRefreshTheme:i,forceRefreshTheme:r}=(0,e0.J)();return(0,p.useEffect)(()=>{l&&null==n&&o(l)},[l]),null}var e2=t(5612);function e5(e){let{text:l,classNames:t=""}=e,n=(0,p.useMemo)(()=>{let e=[],t=null==l?void 0:l.split(/[\n]/gi);return null==t||t.some((l,t)=>{let n=l;(null==l?void 0:l.startsWith("## "))?(null==(l=null==l?void 0:l.substring(3))?void 0:l.startsWith("(( "))?(l=null==l?void 0:l.substring(3),n=(0,i.jsx)("h1",{className:" text-[18px] font-bold text-center ",children:l})):n=(0,i.jsx)("h2",{className:" text-[18px] font-bold ",children:l}):(null==l?void 0:l.startsWith("# "))?(null==(l=null==l?void 0:l.substring(2))?void 0:l.startsWith("(( "))?(l=null==l?void 0:l.substring(3),n=(0,i.jsx)("h1",{className:" text-[16px] font-bold text-center ",children:l})):n=(0,i.jsx)("h1",{className:" text-[16px] font-bold ",children:l}):(null==l?void 0:l.startsWith("(( "))&&(l=null==l?void 0:l.substring(3),n=(0,i.jsx)("h1",{className:" text-center ",children:l})),e.push((0,i.jsx)("div",{children:n},"line_"+t))}),e},[l]);return(0,i.jsx)("div",{className:" text-bwleftnavtext px-[30px] py-[15px] text-[14px] border-b-[1px] border-b-darkcoloro/[0.2] ".concat(t),children:n})}function e6(){return(0,i.jsxs)("div",{className:" flex-1 items-center justify-center flex flex-col mx-[22px] lg:mx-[0] ",children:[(0,i.jsx)("div",{className:" text-[40px] text-[#8c54ff] font-[600] ",children:"ChatLLM Teams"}),(0,i.jsx)("div",{className:" text-[24px] text-[#ffffff] font-[300] text-center",children:"Chat With The AI Brain For Your Organization"}),(0,i.jsx)("div",{className:" mt-[36px] rounded-[7px] bg-darkcoloro px-[24px] py-[17px] ",children:(0,i.jsxs)("div",{className:" text-[#34235e] dark:text-[#ffffff] text-[16px] sm:text-[24px] font-[600] sm:max-w-[30vw] flex items-center gap-[15px]",children:[(0,i.jsx)(D.G,{icon:t(12398).xH,transform:{size:16}}),(0,i.jsx)("span",{className:" ml-[5px] sm:text-[20px] text-[14px] ",children:"Your subscription has been suspended due to payment failure. Please contact your admin to have this subscription restored!"})]})})]})}var e3=t(16206),e4=t.n(e3),e8=t(63020),e9=t(3426),e7=t(51517);let le=(0,eq.default)(()=>Promise.all([t.e(9168),t.e(2025)]).then(t.bind(t,42025)),{loadableGenerated:{webpack:()=>[42025]},ssr:!1});var ll=e=>{var l;let{isProcessing:n,content:o,metadata:s,onCloseCsv:a,deploymentId:d,attachmentId:u,isUploadedCsv:c,isDark:v,areColumnsTruncated:m,areRowsTruncated:h}=e,[f,x]=(0,p.useState)(!1),g=(0,p.useCallback)(async e=>{e.stopPropagation(),e.preventDefault(),x(!0);let l=c?(0,r._WC)({docId:u}):(0,r.iMe)({deploymentId:d,attachmentId:u});try{let e=await (0,r.EZn)({url:l,isGet:!0,isBlob:!0}),t=document.createElement("a"),n=URL.createObjectURL(e);t.href=n,t.download=(null==s?void 0:s.filename)||"filename",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(n)}catch(e){Q.Am.error(G.Z.isNullOrEmpty(e)?""+e:G.Z.errorDefault)}x(!1)},[d,u,s,c]);return(0,i.jsxs)("div",{"data-gramm":"false",className:"prose0 prose dark:prose-invert bg-darkcoloro text-darkcolor flex flex-col absolute top-0 bottom-0 right-0 left-0 shadow-lg mr-[-16px] rounded-r-[10px] w-full",style:{fontFamily:'ui-sans-serif, -apple-system, system-ui, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"',maxWidth:"100%"},children:[(0,i.jsxs)("div",{className:"h-[60px] p-4  flex justify-between items-center gap-[16px]border-b-[1px] border-b-neutral-200 dark:border-b-neutral-800",children:[(0,i.jsx)("div",{className:"flex items-center gap-[8px] flex-1",children:(0,i.jsx)("div",{className:"text-[1.125rem]",children:null!==(l=null==s?void 0:s.filename)&&void 0!==l?l:"CSV"})}),(0,i.jsxs)("div",{className:"flex gap-5 items-center",children:[f?(0,i.jsx)(D.G,{icon:t(68153).QD,transform:{size:16},spin:f}):(0,i.jsx)(eo.Z,{title:"Download CSV",children:(0,i.jsx)(D.G,{icon:t(96951).E0,transform:{size:16},onClick:g,spin:f,className:"cursor-pointer"})}),(0,i.jsx)("div",{className:"cursor-pointer ".concat(n?"pointer-events-none":""),onClick:a,children:(0,i.jsx)(D.G,{icon:t(19173).EO,transform:{size:14}})})]})]}),(0,i.jsx)("div",{className:"overflow-auto markdown h-full",children:(0,i.jsx)(le,{content:o,isDark:v,areColumnsTruncated:m,areRowsTruncated:h,filename:null==s?void 0:s.filename})})]})};let lt=e=>new Promise((l,t)=>{let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{let e=document.createElement("canvas");e.width=n.width,e.height=n.height;let t=e.getContext("2d");null==t||t.drawImage(n,0,0),l(e.toDataURL("image/png").split(",")[1])},n.onerror=e=>t(e),n.src=e}),ln=p.memo((0,p.forwardRef)((e,l)=>{let{imageSrc:t,isPaintingMode:n,brushSize:o,displaySize:r,zoomLevel:s,setHistoryIndexProp:a,setHistoryProp:d}=e,u=(0,p.useRef)(null),c=(0,p.useRef)(null),v=(0,p.useRef)(null),m=(0,p.useRef)(null),h=(0,p.useRef)(null),[f,x]=(0,p.useState)(!1),[g,b]=(0,p.useState)({width:0,height:0}),[y,w]=(0,p.useState)(null),[j,I]=(0,p.useState)(null),[k,C]=(0,p.useState)(!1),[A,N]=(0,p.useState)([]),[E,S]=(0,p.useState)(-1),[L,T]=(0,p.useState)([]),P=(0,p.useRef)(null),[R,_]=(0,p.useState)({x:0,y:0}),[O,M]=(0,p.useState)(!1),[D,Z]=(0,p.useState)({x:0,y:0});(0,e9.H)(e=>e.mask64);let F=(0,e9.H)(e=>e.setMask64),B=(0,e9.H)(e=>e.setImage64),U=(0,p.useMemo)(()=>o/s,[o,s]),z=(0,p.useMemo)(()=>({width:o/s,height:o/s,left:R.x,top:R.y,boxShadow:"0 0 0 1px rgba(0,0,0,0.5)",transform:"translate(-50%, -50%) scale(".concat(s,")"),transformOrigin:"center",pointerEvents:"none",transition:f?"none":"transform 0.1s ease",willChange:"transform"}),[o,s,R.x,R.y,f]);(0,p.useEffect)(()=>{F(null),B(null)},[]);let G=(0,p.useCallback)(e=>{let l=c.current;if(!l)return{x:0,y:0};let t=l.getBoundingClientRect();return{x:(e.clientX-t.left)/s,y:(e.clientY-t.top)/s}},[s]),W=(0,p.useMemo)(()=>({width:"100%",height:"100%",transform:"scale(".concat(s,")"),transformOrigin:"0 0"}),[s]),H=(0,p.useCallback)(e=>{if(M(!0),1===e.buttons){let{x:l,y:t}=G(e);T([{x:l,y:t}])}},[G]),q=(0,p.useCallback)(e=>{if(!f||!n)return;let l=h.current,t=v.current;if(!l||!t)return;let{x:o,y:i}=G(e);T(e=>[...e,{x:o,y:i}]),l.globalAlpha=1,l.lineWidth=U,l.lineTo(o,i),l.stroke(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.globalAlpha=.4,t.drawImage(m.current,0,0)},[f,n,U]);(0,p.useEffect)(()=>{a(E),d(A)},[E]),(0,p.useEffect)(()=>{let e=u.current,l=c.current;if(!e||!l||!r)return;let t=e.getContext("2d"),n=l.getContext("2d"),o=document.createElement("canvas"),i=o.getContext("2d");if(t&&n&&i){if(v.current=n,m.current=o,h.current=i,l.width>0&&l.height>0&&(P.current=n.getImageData(0,0,l.width,l.height)),e.width=r.width,e.height=r.height,l.width=r.width,l.height=r.height,o.width=r.width,o.height=r.height,t.fillStyle="transparent",t.fillRect(0,0,r.width,r.height),n.clearRect(0,0,r.width,r.height),i.clearRect(0,0,r.width,r.height),P.current){let e=document.createElement("canvas");e.width=P.current.width,e.height=P.current.height;let l=e.getContext("2d");l&&(l.putImageData(P.current,0,0),n.drawImage(e,0,0,r.width,r.height),i.drawImage(e,0,0,r.width,r.height),N([n.getImageData(0,0,r.width,r.height)]),S(0))}else N([n.getImageData(0,0,r.width,r.height)]),S(0);n.globalCompositeOperation="source-over",i.globalCompositeOperation="source-over",n.globalAlpha=.4,i.globalAlpha=.4}},[t,r]),(0,p.useEffect)(()=>{let e=v.current,l=h.current;e&&l&&(e.clearRect(0,0,e.canvas.width,e.canvas.height),l.clearRect(0,0,l.canvas.width,l.canvas.height),N([e.getImageData(0,0,e.canvas.width,e.canvas.height)]),S(0),F(null),B(null),e.globalCompositeOperation="source-over",l.globalCompositeOperation="source-over",e.globalAlpha=.4,l.globalAlpha=.4)},[t]);let V=(0,p.useCallback)(e=>{if(!n){C(!0);let l=G(e);w(l),I(l);return}let{x:l,y:t}=G(e);T([{x:l,y:t}]),x(!1);let o=h.current;o&&(o.beginPath(),o.moveTo(l,t))},[n,G]),K=(0,p.useCallback)(e=>{if(!n)return;let l=c.current;if(!l)return;let t=l.getBoundingClientRect();if(_({x:e.clientX-t.left,y:e.clientY-t.top}),1===e.buttons){if(!f&&L.length>0){let{x:l,y:t}=L[0],{x:n,y:i}=G(e);if(Math.abs(l-n)>1||Math.abs(t-i)>1){x(!0);let e=h.current;if(!e)return;e.globalCompositeOperation="source-over",e.fillStyle="#8A54FF",e.strokeStyle="#8A54FF",e.lineWidth=o,e.lineCap="round",e.lineJoin="round",e.globalAlpha=.4,e.beginPath(),e.moveTo(n,i)}}f&&q(e)}else x(!1),T([])},[n,f,L,o,.4,q,G]),Q=(0,p.useCallback)(()=>{if(E<=0){J();return}let e=h.current,l=v.current;if(!e||!l)return;let t=A[E-1];if(!(t instanceof ImageData)){J();return}e.globalAlpha=1,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.putImageData(t,0,0),l.clearRect(0,0,l.canvas.width,l.canvas.height),l.globalAlpha=.4,l.drawImage(m.current,0,0),S(e=>e-1)},[E,A,.4]),Y=(0,p.useCallback)(()=>{if(E>=A.length-1)return;let e=h.current,l=v.current;if(!e||!l)return;let t=A[E+1];e.globalAlpha=1,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.putImageData(t,0,0),l.clearRect(0,0,l.canvas.width,l.canvas.height),l.globalAlpha=.4,l.drawImage(m.current,0,0),S(e=>e+1)},[E,A,.4]),J=(0,p.useCallback)(()=>{F(null),B(null);let e=h.current,l=v.current;e&&l&&(e.clearRect(0,0,e.canvas.width,e.canvas.height),l.clearRect(0,0,l.canvas.width,l.canvas.height),N([0]),S(0),T([]))},[]),X=(0,p.useCallback)(()=>{let e=c.current,l=u.current;if(!e||!l)return;let n=new Image;n.onload=()=>{let l=document.createElement("canvas");l.width=n.width,l.height=n.height;let o=l.getContext("2d");if(!o)return;o.fillStyle="black",o.fillRect(0,0,l.width,l.height),o.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height);let i=o.getImageData(0,0,l.width,l.height),r=i.data;for(let e=0;e<r.length;e+=4){let l=r[e+2]>0?255:0;r[e]=l,r[e+1]=l,r[e+2]=l,r[e+3]=255}o.putImageData(i,0,0);let s=l.toDataURL("image/png").split(",")[1];A.length>1&&lt(t).then(e=>{F(s),B(e)})},n.src=t},[t,A]),$=(0,p.useCallback)(()=>{if(x(!1),C(!1),L.length>0){let e=h.current;if(!e)return;let l=e.getImageData(0,0,e.canvas.width,e.canvas.height);N(e=>[...e.slice(0,E+1),l]),S(e=>e+1),e.beginPath()}T([]),X()},[L.length,E,X]),ee=(0,p.useCallback)(()=>{X(),M(!1),x(!1)},[X]);return(0,p.useImperativeHandle)(l,()=>({undo:Q,redo:Y,clearMask:J,saveMask:X})),(0,p.useEffect)(()=>{var e,l,t;let n=null===(t=c.current)||void 0===t?void 0:null===(l=t.parentElement)||void 0===l?void 0:null===(e=l.parentElement)||void 0===e?void 0:e.parentElement;if(!n)return;let o=()=>{Z({x:n.scrollLeft,y:n.scrollTop})};return n.addEventListener("scroll",o),()=>n.removeEventListener("scroll",o)},[s]),(0,i.jsx)("div",{className:"flex flex-col items-center w-full h-full",children:(0,i.jsx)("div",{className:"relative overflow-hidden",style:{width:(null==r?void 0:r.width)||"auto",height:(null==r?void 0:r.height)||"auto"},children:(0,i.jsxs)("div",{className:"absolute inset-0",style:{width:"100%",height:"100%"},children:[(0,i.jsx)("canvas",{ref:u,className:"absolute inset-0",style:W}),(0,i.jsx)("canvas",{ref:c,className:"absolute inset-0",style:{...W,cursor:"none"},onMouseDown:V,onMouseMove:K,onMouseUp:$,onMouseLeave:ee,onMouseEnter:H}),n&&O&&(0,i.jsx)("div",{className:"pointer-events-none absolute border-2 border-white rounded-full",style:z})]})})})}),(e,l)=>{var t,n,o,i;return e.imageSrc===l.imageSrc&&e.isPaintingMode===l.isPaintingMode&&e.brushSize===l.brushSize&&e.zoomLevel===l.zoomLevel&&(null===(t=e.displaySize)||void 0===t?void 0:t.width)===(null===(n=l.displaySize)||void 0===n?void 0:n.width)&&(null===(o=e.displaySize)||void 0===o?void 0:o.height)===(null===(i=l.displaySize)||void 0===i?void 0:i.height)});var lo=t(69440);let li=e=>{var l,n;let{isMobile:o,isDark:r}=e,{selectedImage:s,setSelectedImage:a,setIsLinesSelected:d,isPaintingMode:u,setIsPaintingMode:c,setEditedImageMode:v}=(0,e9.H)(),{setPrependMessage:h,setShowRightSidePanel:f}=(0,W.b)(e=>({setPrependMessage:e.setPrependMessage,setShowRightSidePanel:e.setShowRightSidePanel})),x=(0,p.useRef)(null),[g,b]=(0,p.useState)(!1),[y,w]=(0,p.useState)(40),[j,I]=(0,p.useState)(1),[k,C]=(0,p.useState)(-1),[A,N]=(0,p.useState)([]),[E,S]=(0,m.PB)("sidebar"),L=(0,p.useRef)(null),T=(0,p.useMemo)(()=>k>=A.length-1,[k]),P=(0,p.useMemo)(()=>k<=0,[k]);(0,p.useEffect)(()=>{u?d(!0):d(!1)},[u]);let R=(0,p.useMemo)(()=>x.current?{width:x.current.clientWidth,height:x.current.clientHeight}:null,[null===(l=x.current)||void 0===l?void 0:l.clientWidth,null===(n=x.current)||void 0===n?void 0:n.clientHeight]),_=(0,p.useCallback)(()=>{c(!1)},[c]),O=(0,p.useCallback)(e=>{a(e),f(!0)},[a]);return((0,p.useEffect)(()=>()=>{S(null),a(null),v(!1),c(!1)},[]),s)?(0,i.jsx)("div",{className:"bg-darkcoloro text-darkcolor text-[14px] flex flex-col absolute top-[0px] bottom-0 right-0 left-0 rounded-tr-[8px] rounded-br-[8px] border-darkcolor/[0.1] shadow-lg",children:(0,i.jsxs)("div",{className:"flex flex-col relative h-full",children:[(0,i.jsx)("div",{className:"flex h-16 w-full justify-between",children:u?(0,i.jsx)("div",{className:"flex justify-between w-full h-[60px] items-center p-4 border-b-[1px] border-b-neutral-200 dark:border-b-neutral-800",children:(0,i.jsxs)("div",{className:"flex items-center w-full gap-4",children:[(0,i.jsxs)("div",{className:"relative w-60 gap-3 flex items-center",children:[(0,i.jsx)(D.G,{icon:t(32407).QE,size:"sm"}),(0,i.jsx)("input",{type:"range",min:20,max:150,value:y,onChange:e=>w(Number(e.target.value)),className:"w-full h-[2px] bg-darkcolor/[0.1] appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-bwleftblue [&::-webkit-slider-thumb]:cursor-pointer",style:{background:"".concat(r?"linear-gradient(to right, #7F56D9 0%, #7F56D9 ".concat((y-20)/150*100,"%, rgba(255,255,255,1) ").concat((y-20)/150*100,"%, rgba(255,255,255,1) 100%)"):"linear-gradient(to right, #7F56D9 0%, #7F56D9 ".concat((y-20)/150*100,"%, rgba(0,0,0,1) ").concat((y-20)/150*100,"%, rgba(0,0,0,1) 100%)"))}}),(0,i.jsx)(D.G,{icon:t(32407).QE,size:"xl"})]}),(0,i.jsxs)("div",{className:"flex items-center border-x-2 border-darkcolor/[0.1]",children:[(0,i.jsx)(V.Z,{disabled:P,onClick:()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.undo()},className:"!px-3 py-2 text-darkcolor disabled:opacity-50",style:{background:"none"},children:(0,i.jsx)(D.G,{icon:t(3454).Xn,size:"lg"})}),(0,i.jsx)(V.Z,{disabled:T,onClick:()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.redo()},className:"!px-3 py-2 text-darkcolor disabled:opacity-50",style:{background:"none"},children:(0,i.jsx)(D.G,{icon:t(12437).mH,size:"lg"})})]}),(0,i.jsxs)("div",{className:"flex items-center w-full justify-between gap-4",children:[(0,i.jsx)(V.Z,{onClick:()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.clearMask()},style:{background:"none"},className:"!px-1 py-2",children:"Clear Selection"}),(0,i.jsx)(V.Z,{onClick:()=>c(!1),style:{background:"none"},className:"!px-1 py-2",children:"Cancel"})]})]})}):(0,i.jsxs)("div",{className:"flex justify-between w-full h-[60px] items-center p-4 border-b-[1px] border-b-neutral-200 dark:border-b-neutral-800",children:[(0,i.jsxs)("span",{className:"text-lg font-medium",children:["Image generated by ",null==s?void 0:s.model]}),(0,i.jsxs)("div",{className:"flex relative items-center",children:[(0,i.jsx)(eo.Z,{side:"bottom",title:"Edit image",children:(0,i.jsx)("div",{className:"flex items-center justify-center text-gray-600 rounded-sm w-8 h-8 hover:bg-[#F1F1F1] cursor-pointer hover:text-gray-900",onClick:()=>{h(null),c(!u),v(!1)},children:(0,i.jsx)(D.G,{icon:t(32407).QE,size:"lg"})})}),(0,i.jsx)("a",{onClick:()=>{var e;null===(e=s.downloadImage)||void 0===e||e.call(s,s.segment)},children:(0,i.jsx)(eo.Z,{side:"bottom",title:"Download",children:(0,i.jsx)("div",{className:"right-[0px] top-[0px] text-gray-600 hover:text-gray-900 rounded-sm w-8 h-8 flex items-center justify-center cursor-pointer hover:bg-[#F1F1F1]",children:(0,i.jsx)(D.G,{icon:t(96951).E0,size:"lg"})})})}),(null==s?void 0:s.imgGenerationPrompt)&&(0,i.jsx)(eo.Z,{side:"bottom",title:"Prompt",children:(0,i.jsx)("div",{className:"flex items-center justify-center rounded-sm w-8 h-8 hover:bg-[#F1F1F1]",children:(0,i.jsx)(lo.P,{type:null==s?void 0:s.type,promptInfo:null==s?void 0:s.imgGenerationPrompt,isMobile:o})})}),(0,i.jsx)(eo.Z,{side:"bottom",title:"Close",children:(0,i.jsx)("div",{className:"flex items-center justify-center text-gray-600 rounded-sm w-8 h-8 hover:bg-[#F1F1F1] cursor-pointer hover:text-gray-900",onClick:()=>{S(null),a(null),v(!1),f(!1)},children:(0,i.jsx)(D.G,{icon:t(63914).FG,size:"lg"})})})]})]})}),(0,i.jsx)("div",{className:"flex flex-col h-full justify-center px-4 items-center relative overflow-auto",children:(0,i.jsxs)("div",{className:"relative",style:{width:"fit-content",height:"fit-content"},children:[(0,i.jsx)("img",{className:"max-w-full max-h-[500px] object-contain select-none transition-transform duration-200",style:{transform:"scale(".concat(j,")")},src:s.segment,alt:"Selected",ref:x,onLoad:()=>b(!0)}),u&&(0,i.jsx)("div",{className:"absolute inset-0",children:(0,i.jsx)(ln,{ref:L,imageSrc:s.segment,isPaintingMode:u,brushSize:y,displaySize:R,onCancel:_,setSelectedImage:O,zoomLevel:j,setHistoryIndexProp:C,setHistoryProp:N})})]})})]})}):null};var lr=t(52626),ls=e=>{let{isProcessing:l,lastBotResponseHadAgentUpdateNotification:n,setShowFullScreen:o,showFullScreen:r,...s}=e,{dashboardEndpoint:a,isAiEngineerWorkflowPreview:d,setIsAiEngineerWorkflowPreview:u,metadataUpdate:c,setShowRightSidePanel:v}=(0,W.b)(e=>({dashboardEndpoint:e.dashboardEndpoint,isAiEngineerWorkflowPreview:e.isAiEngineerWorkflowPreview,setIsAiEngineerWorkflowPreview:e.setIsAiEngineerWorkflowPreview,metadataUpdate:e.metadataUpdate,setShowRightSidePanel:e.setShowRightSidePanel})),[m,h]=(0,p.useState)(!1),[f,g]=(0,p.useState)(!1),[b,y]=(0,p.useState)("WORKFLOW"),w=(0,p.useRef)(null),j=(0,p.useRef)(null),I=!!(null==c?void 0:c.externalApplicationId),k=e=>{let l=new URL(window.location.origin).hostname;return l.startsWith("aaa")&&(e=e.replace(new URL(e).hostname,l)),(null==e?void 0:e.startsWith("http://"))&&(e=e.replace("http://","https://")),e},C=(0,p.useMemo)(()=>{var e,l,t,n;return(null==s?void 0:s.listExtApps)&&(null==s?void 0:null===(l=s.listExtApps)||void 0===l?void 0:null===(e=l.result)||void 0===e?void 0:e.length)&&(null==c?void 0:c.externalApplicationId)&&(null==c?void 0:c.agentId)&&(null==s?void 0:null===(n=s.listExtApps)||void 0===n?void 0:null===(t=n.result)||void 0===t?void 0:t.find(e=>(null==e?void 0:e.externalApplicationId)===(null==c?void 0:c.externalApplicationId)))||null},[null==s?void 0:s.listExtApps,c]),A=(0,p.useMemo)(()=>{if(!d||!(null==c?void 0:c.projectId)||!(null==c?void 0:c.agentId))return null;let e=k(a);return h(!0),"".concat(e,"/app/agent_one_workflow/").concat(null==c?void 0:c.agentId,"/").concat(null==c?void 0:c.projectId,"?isEmbeddedInAIengineer=1")},[a,null==c?void 0:c.projectId,null==c?void 0:c.agentId,h,d]),N=(0,p.useMemo)(()=>{if(!C)return null;g(!0);let e=k(window.location.origin);return"".concat(e,"/chatllm/?appId=").concat(null==C?void 0:C.externalApplicationId,"&agentPreviewMode=1")},[C,a,g]),E=(0,p.useMemo)(()=>A?(0,i.jsx)("iframe",{ref:w,className:"w-full h-full rounded-r-[8px] bg-darkcoloro",src:A,onLoad:()=>{setTimeout(()=>{h(!1)},1500)}}):(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full gap-4",children:[(0,i.jsx)(D.G,{icon:t(89653).faTriangleExclamation,transform:{size:60}}),(0,i.jsx)("div",{className:"text-xl pt-[20px]",children:"Sorry, you are not allowed to view this agent"})]}),[A,h]),S=(0,p.useMemo)(()=>N?(0,i.jsx)("iframe",{ref:j,className:"w-full h-full rounded-r-[8px] bg-darkcoloro",src:N,onLoad:()=>{setTimeout(()=>{g(!1)},1500)}}):(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full gap-4",children:[(0,i.jsx)(D.G,{icon:t(89653).faTriangleExclamation,transform:{size:60}}),(0,i.jsx)("div",{className:"text-xl pt-[20px]",children:"Sorry, failed to load Agent"})]}),[N,g]),L=(e,l,t)=>{if(null==e?void 0:e.current){var n,o;null==e||null===(o=e.current)||void 0===o||null===(n=o.contentWindow)||void 0===n||n.postMessage({type:"AGENT_UPDATED",from:"AI_ENGINEER",to:t,data:{timestamp:Date.now()}},l)}};(0,p.useEffect)(()=>{n&&(L(w,A,"EMBEDDED_PLATFORM"),L(j,N,"EMBEDDED_CHATWEB"))},[n,A,N]);let T=(0,i.jsxs)("div",{className:"bg-darkcoloro  text-[14px] flex flex-col h-full shadow-lg rounded-r-[10px] text-darkcoloro",children:[E,m&&(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center absolute top-0 bottom-0 right-0 left-0 bg-[#131b26] gap-4 text-slate-300",children:[(0,i.jsx)(D.G,{spin:!0,icon:t(74519).go,transform:{size:60}}),(0,i.jsx)("div",{className:"text-xl pt-[20px]",children:"Loading Agent Workflow"})]})]}),P=(0,i.jsxs)("div",{className:"flex bg-bwcentercolor text-darkcolor flex-col items-center justify-center w-full h-full gap-4",children:[S,f&&(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center absolute top-0 bottom-0 right-0 left-0 bg-[#131b26] gap-4 text-slate-300",children:[(0,i.jsx)(D.G,{spin:!0,icon:t(74519).go,transform:{size:60}}),(0,i.jsx)("div",{className:"text-xl pt-[20px]",children:"Loading Agent"})]})]}),R=(0,i.jsxs)("div",{className:"flex items-center flex-row justify-between bg-darkcoloro text-darkcolor px-[20px] py-[10px] border-b-[1px] border-darkcolor/20 h-[60px]",children:[(0,i.jsx)("div",{className:" flex items-center justify-start ",children:(0,i.jsxs)("div",{className:"flex items-center flex-row border-darkcolor/20 bg-darkcolor/[0.05] p-[4px] border-[1px] rounded-[4px] ",children:[(0,i.jsx)("div",{className:"py-[5px] px-[20px] rounded-[4px] cursor-pointer text-center ".concat("WORKFLOW"===b?"bg-bwleftblue text-white":""),onClick:()=>{y("WORKFLOW")},children:" Workflow"}),(0,i.jsx)("div",{className:(0,B.cn)("py-[5px] px-[20px] rounded-[4px] cursor-pointer text-center ".concat("VIEW_AGENT"===b?"bg-bwleftblue text-white":""),{"cursor-not-allowed":!I,"pointer-events-none":!I||!N}),onClick:()=>{y("VIEW_AGENT")},children:"Test Agent"})]})}),(0,i.jsx)("div",{className:" flex items-center flex-row justify-end gap-[4px]",children:(0,i.jsx)(eo.Z,{title:"Exit",side:"top",children:(0,i.jsx)(D.G,{className:"cursor-pointer border-darkcolor/20 border-[1px] rounded-[4px] py-[8px] px-[12px] shadow-md",color:"#FF5656",icon:t(71269).faCircleXmark,transform:{size:20},onClick:()=>{u(!1),v(!1)}})})})]});return(0,i.jsx)(x.E.div,{className:(0,B.cn)(" absolute top-[0px] bottom-[0px] right-[0] bg-darkcoloro/50"),animate:r?{left:"0px",width:"100%"}:{width:"100%"},children:(0,i.jsxs)("div",{className:"flex flex-col h-full text-darkcoloro relative",children:[R,(0,i.jsxs)("div",{className:"flex-1 relative",children:[(0,i.jsx)("div",{className:"h-full absolute inset-0",style:{visibility:"WORKFLOW"===b?"visible":"hidden",zIndex:"WORKFLOW"===b?1:0},children:T}),(0,i.jsx)("div",{className:"h-full absolute inset-0",style:{visibility:"VIEW_AGENT"===b?"visible":"hidden",zIndex:"VIEW_AGENT"===b?1:0},children:P}),l&&(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center absolute top-0 bottom-0 right-0 left-0 bg-black/50 gap-4 text-white z-10",children:[(0,i.jsx)(D.G,{color:"#fff",spin:!0,icon:t(74519).go,transform:{size:60}}),(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,i.jsx)("div",{className:"text-xl pt-[20px]",children:"AI Engineer at work"}),(0,i.jsx)("div",{className:"text-sm text-white/70 dark:text-darkwhite/70",children:"(This might take a few minutes)"})]})]})]}),(0,i.jsx)("span",{className:(0,B.cn)("absolute left-[0px] top-1/2 -translate-y-1/2 bg-darkcolor/80 text-darkcoloro flex items-center px-[10px] py-[30px] rounded-r-[10px] z-50 cursor-pointer",{"bg-gray-300 text-zinc-950":"WORKFLOW"===b}),onClick:()=>{o(e=>!e)},children:(0,i.jsx)(D.G,{icon:t(96665).A3,transform:{size:20},rotation:r?180:null})})]})})};let la=e=>{let{convoMainProps:l,isAiEngineerWorkflowPreview:t,setShowFullScreen:n,showFullScreen:o}=e,{isProcessing:r,isRegenerateProcessing:s,lastBotResponseHadAgentUpdateNotification:a}=(0,W.b)(e=>({isProcessing:e.isProcessing,isRegenerateProcessing:e.isRegenerateProcessing,lastBotResponseHadAgentUpdateNotification:e.lastBotResponseHadAgentUpdateNotification}));return(0,i.jsx)(ls,{isProcessing:r||s,lastBotResponseHadAgentUpdateNotification:a,appIdOri:l.appId,isAgent:l.isAgent,isChatLLM:l.isChatLLM,isBinaryEnable:l.isBinaryEnable,dataInitConvosData:l.dataInitConvosData,deploymentId:l.deploymentId,isDeployError:l.isDeployError,isMobile:l.isMobile,isIOS:l.isIOS,isAndroid:l.isAndroid,isHostTeams:l.isHostTeams,botIconUrlOri:l.botIconUrl,highlightColorHex:l.highlightColorHex,isSelfServe:l.isSelfServe,hideCodeBlocksInit:l.hideCodeBlocks,listExtApps:l.listExtApps,isInternal:l.isInternal,agentId:l.agentId,botNameOri:l.botName,extAppPredictionOverrides:l.extAppPredictionOverrides,dataInit:l.dataInit,dataInitChatParams:l.dataInitChatParams,orgHost:l.orgHost,dataInitUserInfo:l.dataInitUserInfo,setShowFullScreen:n,showFullScreen:o},"agent-workflow-preview-".concat(t))},ld=e=>{let{isSelfServe:l,deploymentId:n,isMobile:o,isInternal:r,isHideTopBar:s,userInfo:a,convoMainProps:d}=e,[u,c]=(0,m.PB)("sidebar"),[v,h]=(0,p.useState)(!1),{streamingArtifactInfo:f,listOfArtifacts:g}=(0,e8.P)(e=>({streamingArtifactInfo:e.streamingArtifactInfo,listOfArtifacts:e.listOfArtifacts})),{enterpriseToolBar:b,isProcessing:y,isRegenerateProcessing:w,csvMsgInfo:j,setCsvMsgInfo:I,setShowRightSidePanel:k,isComputerAgent:C,isComputerAgentOldConvo:A,computerAgentInfo:N,isComputerAgentInfoProcessing:E,setComputerBrowserType:S,setComputerModel:L,isCentredChatInfo:T,showArtifactInfo:P,isAiEngineerWorkflowPreview:R,metadataUpdate:_}=(0,W.b)(e=>({enterpriseToolBar:e.enterpriseToolBar,isProcessing:e.isProcessing,isRegenerateProcessing:e.isRegenerateProcessing,csvMsgInfo:e.csvMsgInfo,setCsvMsgInfo:e.setCsvMsgInfo,setShowRightSidePanel:e.setShowRightSidePanel,isComputerAgent:e.isComputerAgent,isComputerAgentOldConvo:e.isComputerAgentOldConvo,computerAgentInfo:e.computerAgentInfo,isComputerAgentInfoProcessing:e.isComputerAgentInfoProcessing,setComputerBrowserType:e.setComputerBrowserType,setComputerModel:e.setComputerModel,isCentredChatInfo:e.isCentredChatInfo,showArtifactInfo:e.showArtifactInfo,isAiEngineerWorkflowPreview:e.isAiEngineerWorkflowPreview,metadataUpdate:e.metadataUpdate})),{selectedImage:O}=(0,e9.H)(e=>({selectedImage:e.selectedImage})),[M,Z]=(0,p.useState)(localStorage.getItem("selectedBrowser")||"chrome"),[F,U]=(0,p.useState)(localStorage.getItem("selectedModel")||"v3.7"),{isDark:z}=(0,e0.J)(),G=(0,p.useMemo)(()=>R&&!!(null==_?void 0:_.agentId),[R,_]);return(0,p.useEffect)(()=>{localStorage.setItem("selectedBrowser",M),localStorage.setItem("selectedModel",F),S(M),L(F)},[M,F,S,L]),(0,i.jsx)("div",{className:"absolute ".concat(v?"left-0 w-full z-[12]":"left-[478px] w-[calc(100%-478px)]","  h-full"),children:(0,i.jsxs)("div",{children:[u?(0,i.jsx)("div",{className:"z-10 absolute top-0 left-0 right-0 bottom-0 bg-black/[0.5] w-[100vw] h-[60px]",onClick:e=>{c(null)}}):null,(0,i.jsxs)(x.E.div,{className:(0,B.cn)("absolute top-[0px] bottom-[0px] right-[0px] z-[1]"),animate:{width:"100%"},children:[((null==g?void 0:g.length)>0||f)&&(l||b)&&"showArtifact"===P&&!o?(0,i.jsx)(e7.Qs,{isDark:z,deploymentId:n,isProcessing:y||w}):null,(null==j?void 0:j.content)?(0,i.jsx)(ll,{content:null==j?void 0:j.content,metadata:null==j?void 0:j.metadata,isProcessing:y||w,onCloseCsv:()=>{y?Q.Am.error("CSV generation is still in progress."):(I(null),k(!1))},deploymentId:n,attachmentId:null==j?void 0:j.attachmentId,isUploadedCsv:null==j?void 0:j.isUploadedCsv,isDark:z,areColumnsTruncated:null==j?void 0:j.areColumnsTruncated,areRowsTruncated:j.areRowsTruncated}):null,O?(0,i.jsx)(li,{isMobile:o,isDark:z}):null,C?(0,i.jsxs)("div",{className:"bg-darkcoloro text-darkcolor text-[14px] flex flex-col absolute top-0 bottom-0 right-0 left-0 shadow-lg mr-[-16px] rounded-r-[10px]",children:[(0,i.jsxs)("div",{className:"h-[60px] border-b-[1px] px-8 flex items-center justify-between",children:[!s&&r&&(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("select",{className:"bg-transparent border border-gray-600 rounded px-2 py-1 text-xs text-darktoptext",value:M,onChange:e=>Z(e.target.value),children:[(0,i.jsx)("option",{value:"chrome-playwright",children:"Chrome Playwright"}),(0,i.jsx)("option",{value:"chrome",children:"Chrome"}),(0,i.jsx)("option",{value:"grapevine",children:"Grapevine"})]}),(0,i.jsxs)("select",{className:"bg-transparent border border-gray-600 rounded px-2 py-1 text-xs text-darktoptext",value:F,onChange:e=>U(e.target.value),children:[(0,i.jsx)("option",{value:"v3.5",children:"v3.5"}),(0,i.jsx)("option",{value:"v3.7",children:"v3.7"})]})]}),E||T?null:(0,i.jsx)("div",{className:"flex items-center justify-center",children:(0,i.jsx)(lr.Z,{userInfo:a,insideFileSegment:!1})})]}),(null==N?void 0:N.vncEndpoint)?(0,i.jsx)("iframe",{className:"w-full h-[calc(100%-60px)] rounded-r-[8px] ".concat(A?"pointer-events-none":""),src:N.vncEndpoint}):E?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-[calc(100%-60px)] gap-4",children:[(0,i.jsx)("div",{className:"text-xl",children:"Loading Operator..."}),(0,i.jsx)(D.G,{spin:!0,icon:t(39847).QD,transform:{size:20}})]}):(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-[calc(100%-60px)] gap-4 text-red-600",children:[(0,i.jsx)(D.G,{icon:t(89653).faTriangleExclamation,transform:{size:20}}),(0,i.jsx)("div",{className:"text-xl",children:"Failed to load operator. Please try after sometime."})]})]}):null,G?(0,i.jsx)(la,{convoMainProps:d,isAiEngineerWorkflowPreview:R,setShowFullScreen:h,showFullScreen:v}):null]})]})})},lu=(0,eq.default)(()=>t.e(9958).then(t.bind(t,79958)),{loadableGenerated:{webpack:()=>[79958]},ssr:!1});function lc(e){var l,t,n,o,d,v,h,f,x,g,b,y,w,j,I,k,C,A,N,E,S,L,T,P,R,_,O,M,D,Z,F,B,U,H,q,V,K,Q,Y,J,X,$,ee,el,et,en,eo,ei,er;let{isReadyRenderUserInfo:es,userInfo:ea,isHideTopBar:ed}=e,[eu,ec]=(0,m.PB)("convoId"),[ev,em]=(0,m.PB)("appId"),[ep,eh]=(0,m.PB)("debugAgentId"),[ef,ex]=(0,m.PB)("agentPreviewMode"),eg=(0,m.br)(),eb=(0,m.z0)(),[ey,ew]=(0,p.useState)(null),[ej,eI]=(0,p.useState)(!1),ek=navigator.userAgent||"",eC=/iPhone|iPod|Opera Mini|Android.*Mobile|NetFront|PSP|BlackBerry|Windows Phone/i.test(ek),{refetch:eA,data:eN}=(0,m.KS)({includeSearchLLM:!eC&&(null==ea?void 0:null===(t=ea.result)||void 0===t?void 0:null===(l=t.organization)||void 0===l?void 0:l.isSelfServe),isDesktop:!eC}),{refetch:eE}=(0,m.wE)({externalApplicationId:ev,enabled:!1}),{refetchListExtAppForAIEng:eS,setRefetchListExtAppForAIEng:eL,isAiEngineerWorkflowPreview:eT,showRightSidePanel:eP,setEnterpriseToolBar:eR}=(0,W.b)(e=>({refetchListExtAppForAIEng:e.refetchListExtAppForAIEng,setRefetchListExtAppForAIEng:e.setRefetchListExtAppForAIEng,isAiEngineerWorkflowPreview:e.isAiEngineerWorkflowPreview,showRightSidePanel:e.showRightSidePanel,setEnterpriseToolBar:e.setEnterpriseToolBar})),e_=(0,z.NL)();(0,p.useEffect)(()=>{if(!ev)return;let e=async()=>{var e,l,t,n;let o=null,i=null;if(ev===s.Z.aiEngAppId||ev===s.Z.appLlmEndAppId)eS&&(o=await eA());else{let e=await e_.getQueryData(["describeExternalApplication",ev]);i=null!=e?e:null===(n=await eE())||void 0===n?void 0:n.data}let r=(null==o?void 0:null===(e=o.data)||void 0===e?void 0:e.result)||(null==eN?void 0:eN.result);if(null!=ea&&(null==ea?void 0:null===(t=ea.result)||void 0===t?void 0:null===(l=t.organization)||void 0===l?void 0:l.isSelfServe)&&!(ev===s.Z.aiEngAppId||ev===s.Z.appLlmEndAppId||(null==r?void 0:r.find(e=>(null==e?void 0:e.externalApplicationId)===ev)))&&(null==r?void 0:r.length)>0){let e=null==r?void 0:r.find(e=>{var l;return(null==e?void 0:null===(l=e.name)||void 0===l?void 0:l.toLowerCase().indexOf("routellm"))>-1});if(e||(e=null==r?void 0:r.find(e=>null==e?void 0:e.isSystemCreated)),(null==e?void 0:e.externalApplicationId)&&(null==e?void 0:e.externalApplicationId)!==ev){setTimeout(()=>{em(null==e?void 0:e.externalApplicationId)},0);return}}ew(i)};((null==ea?void 0:ea.success)||eS)&&e(),eS&&eL(!1)},[ev,ea,eC,eS,eN]);let eO=ev!==s.Z.aiEngAppId&&ev!==s.Z.appLlmEndAppId&&ev!==s.Z.testAiAgentAppId&&!!ey&&!(null==ey?void 0:ey.success)&&!(null==ey?void 0:ey.needLogin),eM=null==ey?void 0:null===(o=ey.result)||void 0===o?void 0:null===(n=o.useCase)||void 0===n?void 0:n.toUpperCase(),eD=ev===s.Z.testAiAgentAppId||eM===r.ZIR,eZ=ev===s.Z.aiEngAppId||ev===s.Z.appLlmEndAppId||eM===r.NJX,eF=(0,p.useMemo)(()=>{var e,l;return ev===s.Z.aiEngAppId||ev===s.Z.appLlmEndAppId||ev===s.Z.testAiAgentAppId?null:null==eN?void 0:null===(l=eN.result)||void 0===l?void 0:null===(e=l.find(e=>e.externalApplicationId===ev))||void 0===e?void 0:e.deploymentId},[ev,eN]),eB=ev===s.Z.aiEngAppId||ev===s.Z.appLlmEndAppId||ev===s.Z.testAiAgentAppId?null:(null==ey?void 0:null===(d=ey.result)||void 0===d?void 0:d.predictionOverrides)||null,[eU,ez]=(0,p.useState)(!1),[eG,eW]=(0,p.useState)(null),[eH,eq]=(0,p.useState)(null),[eV,eK]=(0,p.useState)(null),[eQ,eY]=(0,p.useState)(null),[eJ,eX]=(0,p.useState)(null),{refetch:e0}=(0,m.Vg)({deploymentId:eF});(0,p.useEffect)(()=>{if(!ev)return;let e=async()=>{let[e,l]=await Promise.all([(0,r._j4)({__simulate:!0}),(0,r.Pl0)({})]);eK(e),eY(l)};(null==ea?void 0:ea.success)&&e()},[ev,eF,ea,eC]),(0,p.useEffect)(()=>{ev&&eF&&(e0(),(0,r.vHz)({deploymentId:eF}).then(e=>{eW(e)}).catch(e=>{eW(null)}))},[eF,ev]),(0,p.useEffect)(()=>{if(ea&&(null!=eG||null!=ey)){if(ev!==s.Z.aiEngAppId&&ev!==s.Z.appLlmEndAppId&&ev!==s.Z.testAiAgentAppId){var e,l,t,n,o,i,r;(null==ey?void 0:ey.success)===!1||(null==eG?void 0:eG.success)===!1?ez(!0):(null==ea?void 0:null===(l=ea.result)||void 0===l?void 0:null===(e=l.organization)||void 0===e?void 0:e.isSelfServe)?(null==eG?void 0:null===(r=eG.result)||void 0===r?void 0:null===(i=r.status)||void 0===i?void 0:i.toUpperCase())==="FAILED"?ez(!0):ez(!1):eG&&(null==eG?void 0:null===(n=eG.result)||void 0===n?void 0:null===(t=n.status)||void 0===t?void 0:t.toUpperCase())!=="ACTIVE"&&(null==eG?void 0:null===(o=eG.result)||void 0===o?void 0:o.needDeployment)?ez(!0):ez(!1)}else ez(!1)}},[ev,eG,ea,ey,es]);let e3=ev===s.Z.testAiAgentAppId?ep:null!==(et=null==eG?void 0:null===(v=eG.result)||void 0===v?void 0:v.modelId)&&void 0!==et?et:null,e4=(null==ea?void 0:null===(h=ea.result)||void 0===h?void 0:h.isChatOnly)!==!0,e8=null==ea?void 0:null===(f=ea.result)||void 0===f?void 0:f.needsMandate,e9=void 0,e7=(null==eV?void 0:null===(x=eV.result)||void 0===x?void 0:x.logo)||null,le=(null==eV?void 0:null===(g=eV.result)||void 0===g?void 0:g.logo)||null,ll=(null==eV?void 0:null===(b=eV.result)||void 0===b?void 0:b.theme)||null;null==eV&&(le=G.Z.transparentPixelBase64,e7=G.Z.transparentPixelBase64);let lt=(null==ey?void 0:null===(y=ey.result)||void 0===y?void 0:y.theme)||null,ln=null===(w=u().get(null,{path:"/"}))||void 0===w?void 0:w.isDark,lo=(0,r.BWi)(ln,ll),li=/iPhone|iPod|iPad/i.test(ek),lr=/Android/i.test(ek),ls=(null==ll?void 0:ll[r.B2g])==="1",la=null==ll?void 0:ll[r.TRi],lc=null==eN?void 0:null===(j=eN.result)||void 0===j?void 0:j.map(e=>({label:null==e?void 0:e.name,value:null==e?void 0:e.externalApplicationId,deployId:null==e?void 0:e.deploymentId}));if(null==ea?void 0:null===(k=ea.result)||void 0===k?void 0:null===(I=k.organization)||void 0===I?void 0:I.isSelfServe){let e=e=>{var l;null==e||null===(l=e.result)||void 0===l||l.some(e=>{var l,t;let n=null==e?void 0:null===(l=e.name)||void 0===l?void 0:l.toLowerCase(),o=null;(null==n?void 0:n.indexOf("claude"))>-1?o="claude":(null==n?void 0:n.indexOf("llama"))>-1?o="llama3":(null==n?void 0:n.indexOf("gemini"))>-1?o="gemini":(null==n?void 0:n.indexOf("gpt"))>-1||(null==n?void 0:n.indexOf("o1"))>-1||(null==n?void 0:n.indexOf("o3"))>-1?o="gpt":(null==n?void 0:n.indexOf("smaug"))>-1?o="smaug":(null==n?void 0:n.indexOf("dracarys"))>-1?o="dracarys":(null==n?void 0:n.indexOf("qwen"))>-1?o="qwen":(null==n?void 0:n.indexOf("qwq"))>-1?o="qwen":(null==n?void 0:n.indexOf("deepseek"))>-1?o="deepseek":(null==n?void 0:n.indexOf("grok"))>-1?o="grok":(null==n?void 0:n.indexOf("searchllm"))>-1?o="searchLLM":(null==n?void 0:n.indexOf("routellm"))>-1?o="routeLLM":((null==n?void 0:n.indexOf("computer agent"))>-1||(null==n?void 0:n.indexOf("operator"))>-1)&&(o="computerAgent"),o&&null!=e&&(null!==(t=e.theme)&&void 0!==t||(e.theme={}),e.theme[r.my0]||(e.theme[r.my0]="/chatllm/staticllm/".concat(o,".webp")))})};if(e(eN),e(eN),null!=lt&&!(null==lt?void 0:lt[r.my0])){let e=null==eN?void 0:null===(ei=eN.result)||void 0===ei?void 0:null===(eo=ei.find(e=>(null==e?void 0:e.externalApplicationId)===ev))||void 0===eo?void 0:null===(en=eo.theme)||void 0===en?void 0:en[r.my0];e&&(lt[r.my0]=e)}}let lv=(null==eQ?void 0:eQ.success)===!0?null==eQ?void 0:null===(A=eQ.result)||void 0===A?void 0:null===(C=A.auth)||void 0===C?void 0:C.deploymentId:null,lm=(null==eQ?void 0:eQ.success)===!0&&!!(null==eQ?void 0:null===(N=eQ.result)||void 0===N?void 0:N.applicationConnectorId),lp=(null==lt?void 0:lt[r.my0])||(null==ll?void 0:ll[r.my0])||null,lh=(null==ll?void 0:ll[r.YsO])||null,[lf,lx]=(0,p.useState)(!1);(0,p.useEffect)(()=>{if(ed){let e=document.querySelector(":root");(null==e?void 0:e.style)!=null&&e.style.setProperty("--color-bw-left-blue",G.Z.redColorNumbers)}},[ed]),(0,p.useEffect)(()=>{(async()=>{var e,l,t,n,o,i,a;if((null==ey?void 0:null===(l=ey.result)||void 0===l?void 0:null===(e=l.userGroupIds)||void 0===e?void 0:e.length)===0&&!s.Z.isHostTeams(s.Z.calcHostOnly(window.location.hostname))){let e=null===(o=await (0,r.aSy)({}))||void 0===o?void 0:null===(n=o.result)||void 0===n?void 0:null===(t=n.find(e=>null==e?void 0:e.publicUserGroup))||void 0===t?void 0:t.userGroupId;if(e){let l=await (0,r.csn)({userGroupId:e});(null==l?void 0:null===(a=l.result)||void 0===a?void 0:null===(i=a.users)||void 0===i?void 0:i.length)>0&&lx(!0)}}})()},[ey]),(0,p.useEffect)(()=>{let e=async()=>{var e,l,t,n,o,i,s,a;let d=await (0,r.JMI)({}),u=!1,c=await (0,r.vHz)({deploymentId:eF}),v=null==c?void 0:null===(e=c.result)||void 0===e?void 0:e.modelVersion;if(v){let e=await (0,r.Fxw)({modelVersion:v}),c=null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.modelConfig;!1===(u=null!==(o=null==d?void 0:null===(n=d.result)||void 0===n?void 0:null===(t=n.chatLLM)||void 0===t?void 0:t.HIDE_SQL_AND_CODE)&&void 0!==o&&o)&&(u=null!==(s=null!==(i=null==c?void 0:c.HIDE_SQL_AND_CODE)&&void 0!==i?i:null==c?void 0:c.HIDE_GENERATED_SQL)&&void 0!==s&&s),eR(null!==(a=null==c?void 0:c.ENABLE_TOOL_BAR)&&void 0!==a&&a)}eI(u)};eF&&e()},[eF]);let lg=(null==ll?void 0:ll[r.VmS])||null,lb=s.Z.isHostTeams(s.Z.calcHostOnly(window.location.hostname)),ly=(0,p.useMemo)(()=>({deploymentId:eF,deploymentConversationId:eu}),[eF,eu]);return!lb||null==ea||!es||null==ea||null===(S=ea.result)||void 0===S||null===(E=S.organization)||void 0===E||!E.isSelfServe||(null==ea?void 0:null===(L=ea.result)||void 0===L?void 0:L.organizationAdmin)||(null==ea?void 0:null===(_=ea.result)||void 0===_?void 0:null===(R=_.organization)||void 0===R?void 0:null===(P=R.info)||void 0===P?void 0:null===(T=P.preferences)||void 0===T?void 0:T.payment_done)?(0,i.jsxs)("main",{className:"absolute top-0 left-0 right-0 bottom-0 bg-gradient-to-tr to-bwbackto via-bwbackvia from-bwbackfrom to-[88%] via-[73%] from-[12%] ",children:[(0,i.jsxs)("div",{className:"absolute top-0 left-0 right-0 bottom-0 text-darkcolor flex flex-col ".concat(eP?"w-[478px]":""),children:[lg&&(0,i.jsx)("div",{className:" relative ",children:(0,i.jsx)(e5,{text:lg})}),e8?(0,i.jsx)("div",{className:" relative ",children:(0,i.jsx)(e5,{classNames:"text-center text-[16px]",text:"Please authorize the e-mandate with your bank to continue your subscription."})}):null,eb&&!eg&&(0,i.jsx)("div",{className:" relative h-[60px] ",children:(0,i.jsx)(p.Suspense,{children:(0,i.jsx)(lu,{customModeForced:ls,defaultDarkMode:la,darkMode:lo,forceThemeLogo:e7,isAdmin:e4,themeObj:ll,isMobile:eC})})}),(0,i.jsx)("div",{style:ef||ev===G.Z.testAiAgentAppId?{display:"none"}:{},className:" relative h-[60px]"+(eb&&!eg?" hidden ":" ")+"".concat(eP?" w-[478px] ":""),children:(0,i.jsx)(a.Z,{paddingLeftHide:eU,showBurger:!0,isHideTopBar:ed,botIconUrl:lp,customModeForced:ls,defaultDarkMode:la,listExtApps:eN,isBotNotFound:eO,showWarningAdmin:lf,isMobile:eC,appDeployId:ev===G.Z.aiEngAppId||ev===G.Z.appLlmEndAppId?null:null==ey?void 0:null===(O=ey.result)||void 0===O?void 0:O.deploymentId,isLinkUsedDeployUsed:lm,itemsExtApps:lc,isLinkUsedDeployId:lv,isHostTeams:lb,dataInitUserInfo:ea,backToProjDashUrl:eG?"/app/deploy_detail/".concat(null==eG?void 0:null===(M=eG.result)||void 0===M?void 0:M.projectId,"/").concat(null==eG?void 0:null===(D=eG.result)||void 0===D?void 0:D.deploymentId):null,backToAgentWorkflowUrl:eD?"/app/agent_one_workflow/".concat(e3,"/").concat(null==eG?void 0:null===(Z=eG.result)||void 0===Z?void 0:Z.projectId):null,forceThemeLogo:e7,darkMode:lo,logoBase64:le,themeObj:ll,appId:ev,bots:null==eN?void 0:null===(F=eN.result)||void 0===F?void 0:F.map(e=>{var l,t,n;return{deploymentId:null==e?void 0:e.deploymentId,name:null==e?void 0:e.name,appId:null==e?void 0:e.externalApplicationId,theme:null==e?void 0:e.theme,description:null==e?void 0:e.description,isLLm:!!(null==e?void 0:null===(l=e.predictionOverrides)||void 0===l?void 0:l.llmName),isSearchLLM:!!(null==e?void 0:null===(t=e.predictionOverrides)||void 0===t?void 0:t.isSearchLlm),isSystemCreated:null==e?void 0:e.isSystemCreated,isDeprecated:null==e?void 0:e.isDeprecated,isExpensive:null==e?void 0:e.isExpensive,isVisible:null==e?void 0:e.isVisible,forComputerUse:!!(null==e?void 0:null===(n=e.predictionOverrides)||void 0===n?void 0:n.forComputerUse)}}),leftWidth:320,botName:null!==(er=eO?"-":null)&&void 0!==er?er:(null==ey?void 0:null===(B=ey.result)||void 0===B?void 0:B.name)||"ChatLLM",isAdmin:e4,showCustomChatbot:ea&&!ea.needLogin,showDesktopSidebar:!eU&&!eO,isAgent:eD})}),eU&&eO&&(0,i.jsx)("div",{className:" h-[50px] flex items-center justify-center relative ",children:(0,i.jsx)(c.Z,{forceMessage:eO?"You don't have access to the particular Chatbot, please contact your administrator":void 0,isAdmin:e4,deployId:eF})}),(0,i.jsxs)("div",{className:" flex-1 relative "+(eU?" items-center justify-center flex ":""),children:[eU&&(0,i.jsxs)("div",{className:" px-[20px] py-[15px] rounded-md bg-darkcoloro ",children:[eO&&(0,i.jsx)("div",{children:(0,i.jsx)(a.Z,{forceBotsList:!0,themeObj:ll,isHideTopBar:ed,listExtApps:eN,bots:null==eN?void 0:null===(U=eN.result)||void 0===U?void 0:U.map(e=>{var l,t;return{name:null==e?void 0:e.name,appId:null==e?void 0:e.externalApplicationId,theme:null==e?void 0:e.theme,description:null==e?void 0:e.description,isLLm:!!(null==e?void 0:null===(l=e.predictionOverrides)||void 0===l?void 0:l.llmName),isDeprecated:null==e?void 0:e.isDeprecated,isExpensive:null==e?void 0:e.isExpensive,isVisible:null==e?void 0:e.isVisible,forComputerUse:!!(null==e?void 0:null===(t=e.predictionOverrides)||void 0===t?void 0:t.forComputerUse)}}),isMobile:eC})}),!eO&&(0,i.jsx)(c.Z,{className:" mt-[5px] pl-[1px] bg-transparent",forceMessage:eO?(0,i.jsx)("div",{children:"You don't have access to the particular Chatbot, please contact your administrator"}):void 0,isAdmin:e4,deployId:eF})]}),(0,i.jsx)(e1,{initThemeData:ll}),ev&&null!=ea&&(null==ea?void 0:ea.needLogin)!==!0&&(0,i.jsx)(e2.Z,{appId:ev,initThemeData:lt,isClient:!0}),!eU&&(0,i.jsx)(e$,{leftWidth:320,dataInitUserInfo:ea,isDark:"1"===ln,isHideTopBar:ed,appIdOri:ev,isAgent:eD,isChatLLM:eZ,isBinaryEnable:!0,isMobileSSR:eC,isIOS:li,isReadyRenderUserInfo:es,isAndroid:lr,listExtApps:eN,isHostTeams:lb,isSelfServe:(null==ea?void 0:ea.success)===!0&&!!(null==ea?void 0:null===(q=ea.result)||void 0===q?void 0:null===(H=q.organization)||void 0===H?void 0:H.isSelfServe),dataInitConvosData:eH,dataInitCopilotConvosData:eJ,deploymentId:eF,agentId:e3,botName:null==ey?void 0:null===(V=ey.result)||void 0===V?void 0:V.name,extAppPredictionOverridesOri:eB,botIconUrl:lp,highlightColorHex:lh,isDeployError:eU,isInternal:(null==ea?void 0:null===(K=ea.result)||void 0===K?void 0:K.internal)===!0,dataInitChat:e9,dataInitChatParams:ly,hideCodeBlocks:ej})]})]}),eP?(0,i.jsx)(ld,{deploymentId:eF,isMobile:eC,isSelfServe:null==ea?void 0:null===(Y=ea.result)||void 0===Y?void 0:null===(Q=Y.organization)||void 0===Q?void 0:Q.isSelfServe,isInternal:(null==ea?void 0:null===(J=ea.result)||void 0===J?void 0:J.internal)===!0,isHideTopBar:ed,userInfo:ea,convoMainProps:{agentId:e3,appId:ev,botIconUrl:lp,botName:null==ey?void 0:null===(X=ey.result)||void 0===X?void 0:X.name,dataInit:e9,dataInitChatParams:ly,dataInitConvosData:eH,dataInitUserInfo:ea,deploymentId:eF,extAppPredictionOverrides:eB,hideCodeBlocks:ej,highlightColorHex:lh,isAgent:eD,isAndroid:lr,isBinaryEnable:!0,isChatLLM:eZ,isDeployError:eU,isHostTeams:lb,isInternal:(null==ea?void 0:null===($=ea.result)||void 0===$?void 0:$.internal)===!0,isIOS:li,isMobile:eC,isSelfServe:null==ea?void 0:null===(el=ea.result)||void 0===el?void 0:null===(ee=el.organization)||void 0===ee?void 0:ee.isSelfServe,listExtApps:eN}}):null]}):(0,i.jsx)("main",{className:"absolute top-0 left-0 right-0 bottom-0 bg-gradient-to-tr  to-[88%] via-[73%] from-[12%]  to-[#000b16] via-[#001a37] from-[#00060c] ",children:(0,i.jsxs)("div",{style:{backgroundImage:"url('/chatllm/staticllm/backsigninteams2.webp')",backgroundSize:"cover"},className:"absolute top-0 left-0 right-0 bottom-0 text-darkcolor ",children:[(0,i.jsx)("div",{className:"relative h-[60px]",children:(0,i.jsx)(a.Z,{dataInitUserInfo:ea,paddingLeftHide:!0,isAdminPath:!1,isProfilePath:!0,isAppsPath:!1,isHideTopBar:ed,isShowInviteTeam:!1,forceDarkmode:!0})}),(0,i.jsx)("div",{className:" flex absolute top-[60px] left-0 right-0 bottom-0 text-darkcoloro overflow-y-auto ",children:(0,i.jsx)(e6,{})})]})})}w().extend(e4()),t(72458);var lv=t(57948),lm=t(34402),lp=t(93398);function lh(e){var l,t,n,o,d,h,f,x,g,b,y,j,I,k,C,A,N,E,S;let{params:L,searchParams:T}=e,P=window.location.host,R=s.Z.calcHostOnly(P||"apps.abacus.ai"),_=s.Z.isHostTeams(R),[O,M]=(0,m.PB)("hideTopBar"),[D,Z]=(0,m.PB)("isAdd"),[F,B]=(0,m.PB)("editAppId"),U="1"===D?null:F||null;U||(U=null);let[z,W]=(0,p.useState)(!1),[H,q]=(0,m.PB)("appId"),[V,K]=(0,m.PB)("convoId"),Q=navigator.userAgent||"",Y=/iPhone|iPod|Opera Mini|Android.*Mobile|NetFront|PSP|BlackBerry|Windows Phone/i.test(Q),{data:J}=(0,m.Pc)({ignoreNeedLogin:!0}),X=s.Z.isHostTeams(s.Z.calcHostOnly(window.location.hostname)),$=(0,v.q)(null==J?void 0:J.result),ee=null!=J&&(null==J?void 0:J.needLogin)===!0;(0,p.useEffect)(()=>{var e,l,t,n,o,i,s,a,d,u,c,v;if(J&&(null==J?void 0:J.success)&&(null==J?void 0:J.needLogin)!==!0){if($){(0,r.vOe)(!0),window.location.href="/chatllm/admin/referrals/";return}if((null==J?void 0:null===(u=J.result)||void 0===u?void 0:null===(d=u.organization)||void 0===d?void 0:d.isSelfServe)===!0&&!(null==J?void 0:null===(v=J.result)||void 0===v?void 0:null===(c=v.organization)||void 0===c?void 0:c.organizationId)){(0,r.vOe)(!0),window.location.href="/chatllm/joinorg/";return}if(!0===(0,r.OJJ)(J,X)){(0,r.vOe)(!0),window.location.href="/chatllm/billing_add/";return}if((null==J?void 0:null===(e=J.result)||void 0===e?void 0:e.forceVerification)===!0&&(null==J?void 0:null===(l=J.result)||void 0===l?void 0:l.hasPendingInvite)===!0&&(null==J?void 0:null===(n=J.result)||void 0===n?void 0:null===(t=n.organization)||void 0===t?void 0:t.paymentDone)===!1){(0,r.vOe)(!0),window.location.href="/chatllm/verify_account/";return}if((null==J?void 0:null===(i=J.result)||void 0===i?void 0:null===(o=i.organization)||void 0===o?void 0:o.subscriptionEndTime)&&w()(null==J?void 0:null===(a=J.result)||void 0===a?void 0:null===(s=a.organization)||void 0===s?void 0:s.subscriptionEndTime).isBefore(w()())){(0,r.vOe)(!0),window.location.href="/chatllm/admin/profile/";return}}},[J,$,X]);let[el,et]=(0,p.useState)(null),[en,eo]=(0,p.useState)(null),[ei,er]=(0,p.useState)(null),[es,ea]=(0,p.useState)(!1),ed=!!(null==el?void 0:null===(l=el.result)||void 0===l?void 0:l.mobileRedTheme)||!0,eu="1"===O&&ed,{refetch:ec,data:ev}=(0,m.KS)({includeSearchLLM:!Y&&(null==J?void 0:null===(n=J.result)||void 0===n?void 0:null===(t=n.organization)||void 0===t?void 0:t.isSelfServe),isDesktop:!Y});(0,p.useEffect)(()=>{ee||null==J||null==ec||ec()},[ee,J]);let em=null==J,{setLastUsedBot:ep}=(0,lp.e)();(0,p.useEffect)(()=>{ee||em||((0,r._j4)({__simulate:!0}).then(e=>{et(e)}).catch(e=>{et(null)}),(0,r.Pl0)({}).then(e=>{eo(e)}).catch(e=>{eo(null)}),ea(!1),(0,r.hk3)({}).then(e=>{er(e),ea(!0),ep({loaded:!0,result:e})}).catch(e=>{er(null),ea(!0),ep({loaded:!0,result:null})}))},[ee,em]);let eh=(null==J?void 0:null===(o=J.result)||void 0===o?void 0:o.isChatOnly)!==!0,ef=(null==el?void 0:null===(d=el.result)||void 0===d?void 0:d.logo)||null,ex=(null==el?void 0:null===(h=el.result)||void 0===h?void 0:h.theme)||null,eg=null===(f=u().get(null,{path:"/"}))||void 0===f?void 0:f.isDark,eb=(0,r.BWi)(eg,ex),ey=(null==ex?void 0:ex[r.B2g])==="1",ew=null==ex?void 0:ex[r.TRi],ej=(0,p.useMemo)(()=>{var e;return null==ev?void 0:null===(e=ev.result)||void 0===e?void 0:e.map(e=>({label:null==e?void 0:e.name,value:null==e?void 0:e.externalApplicationId,deployId:null==e?void 0:e.deploymentId}))},[ev]);(0,p.useEffect)(()=>{var e,l,t;if((null==ev?void 0:null===(e=ev.result)||void 0===e?void 0:e.length)>0&&J){if(null==J?void 0:null===(t=J.result)||void 0===t?void 0:null===(l=t.organization)||void 0===l?void 0:l.isSelfServe)document.title="ChatLLM Teams";else{let e=null==ev?void 0:ev.result.find(e=>(null==e?void 0:e.externalApplicationId)===H),l="";H===G.Z.aiEngAppId?l=" - AI Engineer":H===G.Z.appLlmEndAppId&&(l=" - AppLLM Engineer"),document.title=(null==e?void 0:e.name)||"ChatLLM ".concat(l)}}},[ev,H,J]);let eI=(null==en?void 0:en.success)===!0?null==en?void 0:null===(g=en.result)||void 0===g?void 0:null===(x=g.auth)||void 0===x?void 0:x.deploymentId:null,ek=(null==en?void 0:en.success)===!0&&!!(null==en?void 0:null===(b=en.result)||void 0===b?void 0:b.applicationConnectorId),eC=null==ev?void 0:null===(y=ev.result)||void 0===y?void 0:y[0],eA=(0,p.useMemo)(()=>{if(!es)return null;let e=null==eC?void 0:eC.externalApplicationId;if(null==ei?void 0:ei.success){var l,t,n,o;if(null==ei?void 0:null===(l=ei.result)||void 0===l?void 0:l.externalApplicationId){let l=null==ev?void 0:null===(t=ev.result)||void 0===t?void 0:t.find(e=>{var l;return(null==e?void 0:e.externalApplicationId)===(null==ei?void 0:null===(l=ei.result)||void 0===l?void 0:l.externalApplicationId)}),i=null==l?void 0:null===(o=l.predictionOverrides)||void 0===o?void 0:null===(n=o.llmName)||void 0===n?void 0:n.toLowerCase();!l||(null==l?void 0:l.isExpensive)||(null==l?void 0:l.isDeprecated)||["claude_v3_7_sonnet","openai_o1"].includes(i)||(e=ei.result.externalApplicationId)}}return e},[es,ei,eC,ev]);(0,p.useEffect)(()=>{es&&null!=eA&&(!H&&(q(eA),V&&setTimeout(()=>{K(null)},0)),W(!0))},[eA]);let eN=!(null==J||!z&&!H),[eE,eS]=(0,p.useState)(!1);return((0,p.useEffect)(()=>{eS(!0)},[]),eE)?(null==J?void 0:J.success)&&(null==J?void 0:J.needLogin)!==!0?(null==J?void 0:null===(I=J.result)||void 0===I?void 0:null===(j=I.organization)||void 0===j?void 0:j.isSelfServe)&&(null==J?void 0:null===(C=J.result)||void 0===C?void 0:null===(k=C.organization)||void 0===k?void 0:k.needsMandate)===!0&&(null==J?void 0:null===(N=J.result)||void 0===N?void 0:null===(A=N.organization)||void 0===A?void 0:A.paymentDone)===!1?(0,i.jsx)("main",{className:"absolute top-0 left-0 right-0 bottom-0 bg-gradient-to-tr  to-[88%] via-[73%] from-[12%]  to-[#000b16] via-[#001a37] from-[#00060c] ",children:(0,i.jsxs)("div",{style:{backgroundImage:"url('/chatllm/staticllm/backsigninteams2.webp')",backgroundSize:"cover"},className:"absolute top-0 left-0 right-0 bottom-0 text-darkcolor ",children:[(0,i.jsx)("div",{className:"relative h-[60px]",children:(0,i.jsx)(a.Z,{dataInitUserInfo:J,paddingLeftHide:!0,isAdminPath:!1,isProfilePath:!0,isAppsPath:!1,isHideTopBar:eu,isShowInviteTeam:!1,forceDarkmode:!0})}),(0,i.jsx)("div",{className:" flex absolute top-[60px] left-0 right-0 bottom-0 text-darkcoloro overflow-y-auto ",children:(0,i.jsx)(lm.Z,{isAdmin:null==J?void 0:null===(E=J.result)||void 0===E?void 0:E.organizationAdmin,userInfo:J})})]})}):null==H&&eN?(0,i.jsx)("main",{className:"absolute top-0 left-0 right-0 bottom-0 bg-gradient-to-tr to-bwbackto via-bwbackvia from-bwbackfrom to-[88%] via-[73%] from-[12%] ",children:(0,i.jsxs)("div",{className:"absolute top-0 left-0 right-0 bottom-0 text-darkcolor flex flex-col ",children:[(0,i.jsx)("div",{style:eu?{display:"none"}:{},className:"relative h-[60px]",children:(0,i.jsx)(a.Z,{bots:null==ev?void 0:null===(S=ev.result)||void 0===S?void 0:S.map(e=>{var l;return{name:null==e?void 0:e.name,appId:null==e?void 0:e.externalApplicationId,theme:null==e?void 0:e.theme,description:null==e?void 0:e.description,isLLm:!!(null==e?void 0:null===(l=e.predictionOverrides)||void 0===l?void 0:l.llmName),isDeprecated:null==e?void 0:e.isDeprecated,isExpensive:null==e?void 0:e.isExpensive}}),forceThemeLogo:ef,isHideTopBar:eu,darkMode:eb,defaultDarkMode:ew,dataInitUserInfo:J,customModeForced:ey,isLinkUsedDeployUsed:ek,itemsExtApps:ej,isLinkUsedDeployId:eI,isAppsPath:!0,themeObj:ex,listExtApps:ev,leftWidth:320,botName:null,isAdmin:eh})}),(0,i.jsx)(c.Z,{forceMessage:(0,i.jsxs)("span",{children:["It seems that your current permissions do not grant access to any bots at the moment.",(0,i.jsx)("br",{})," If you believe you should have the necessary access, kindly contact your administrator for assistance."]})})]})}):(0,i.jsx)(lc,{isHideTopBar:eu,userInfo:J,isReadyRenderUserInfo:eN}):(0,i.jsx)(lv.F,{isReset:!1,searchParams:T,isChatApp:_,userInfoInit:J,isFromOtherPage:!0}):null}w().extend(e4())},67375:function(e,l,t){"use strict";t.d(l,{m:function(){return n}});let n=(e,l)=>{let t="codellm://abacus/signin?code=".concat(encodeURIComponent(e||""));return l?"".concat(t,"&apiKeyId=").concat(encodeURIComponent(l)):t}},98870:function(e,l,t){"use strict";t.d(l,{ZP:function(){return eJ},gw:function(){return eQ}});var n=t(57437),o=t(21652),i=t.n(o),r=t(49070),s=t(99376),a=t(3377),d=t(2265),u=t(53436),c=t(29827),v=t(16593),m=t(25614),p=t.n(m),h=t(42715),f=t.n(h),x=t(3916),g=t(14301),b=t(48547),y=t(56383),w=t(32397),j=t(14438),I=t(13237),k=t(70978),C=t(25103),A=t(86159),N=t(95951),E=t(55037),S=t.n(E),L=t(29901),T=t(62514),P=t(75292),R=t(65178),_=t(67536),O=t(56210);let M=(0,d.forwardRef)((e,l)=>{let{children:t,className:o,disabled:i,...r}=e;return(0,n.jsx)(_.Item,{ref:l,className:(0,O.cn)("mt-px overflow-hidden first:mt-0 first:rounded-t last:rounded-b focus-within:relative focus-within:z-10 hover:bg-darkcolor/[0.03] transition-colors",i&&"opacity-50 cursor-not-allowed",o),...r,children:t})});M.displayName="AccordionItem";let D=(0,d.forwardRef)((e,l)=>{let{children:o,className:i,disabled:r,...s}=e;return(0,n.jsx)(_.Header,{className:"flex",children:(0,n.jsxs)(_.Trigger,{ref:l,className:(0,O.cn)("shadow-neutral-500/[0.1] group flex flex-1 cursor-default items-center justify-between text-[15px] leading-none outline-none hover:bg-darkcolor/[0.05] transition-colors",i),...s,children:[o,!r&&(0,n.jsx)(b.G,{className:"ease-[cubic-bezier(0.87,_0,_0.13,_1)] transition-transform duration-300 rotate-180 group-data-[state=open]:rotate-0",icon:t(5185).mT})]})})});D.displayName="AccordionTrigger";let Z=(0,d.forwardRef)((e,l)=>{let{children:t,className:o,...i}=e;return(0,n.jsx)(_.Content,{ref:l,className:(0,O.cn)("data-[state=open]:animate-slideDown data-[state=closed]:animate-slideUp overflow-hidden text-[15px]",o),...i,children:(0,n.jsx)("div",{className:"p-0 flex flex-wrap justify-between gap-[12px]",children:t})})});Z.displayName="AccordionContent";var F=e=>{let[l,t]=(0,d.useState)(!1);return(0,n.jsx)(N.Z,{title:"Filters",openOverride:l,onChangeOpen:t,cancelText:"Close",className:"!min-w-[650px] !max-w-[650px] !w-[650px] !z-10",hideOkButton:!0,content:(0,n.jsx)("div",{className:"py-4 max-h-[600px] overflow-y-auto bg-white",children:(0,n.jsx)(_.Root,{type:"single",collapsible:!0,className:"space-y-2 bg-white rounded-md",children:e.content})}),children:(0,n.jsx)(g.Z,{className:" px-4 py-2 rounded-md hover:opacity-90 transition-opacity",children:(0,n.jsx)("span",{children:"See All"})})})},B=e=>{let{filtersData:l,filtersUsed:o,filtersText:i,filtersReadOnly:r,themeApp:s,isAgent:a,filterSep:u,setFiltersUsed:c,setFiltersText:v}=e,m=(0,d.useMemo)(()=>Object.keys(null!=l?l:{}),[l]),h=(0,d.useCallback)(e=>{c(l=>{let t={...null!=l?l:{}};return Object.keys(t).forEach(l=>{l.startsWith(e+u)&&delete t[l]}),t})},[u,c]),f=(0,d.useCallback)((e,l)=>{v(t=>({...t,[e]:l||""}))},[v]),y=(0,d.useCallback)((e,l,t)=>{c(n=>{let o={...null!=n?n:{}};return a&&Object.keys(o).forEach(l=>{l.startsWith(e+u)&&delete o[l]}),o[l]=t,o})},[u,a,c]),w=(0,d.useCallback)((e,l)=>{r||c(t=>{let n={...null!=t?t:{}};return a&&!n[l]&&Object.keys(n).forEach(l=>{l.startsWith(e+u)&&delete n[l]}),n[l]=!n[l],n})},[u,a,c,r]),j=(0,d.useMemo)(()=>(0,n.jsxs)("span",{className:" flex items-center mr-[8px] ",children:[(0,n.jsx)("span",{className:" mr-[5px] opacity-30 ",children:(0,n.jsx)(b.G,{icon:t(4198).G_,transform:{size:15,y:1}})}),(0,n.jsx)("span",{children:a?"Additional Parameters:":"Filters:"})]},"filters_first"),[a]),{activeFilterKey:I,selectedFilterMap:k}=(0,d.useMemo)(()=>{let e=null,t={};return m.forEach(n=>{let i=null==l?void 0:l[n];if(p()(i)&&(null==i?void 0:i.length)>0){let l=Object.keys(null!=o?o:{}).filter(e=>(null==e?void 0:e.startsWith(n+u))&&(null==o?void 0:o[e])===!0);t[n]=l,(null==l?void 0:l.length)>0&&(e=n)}}),{activeFilterKey:e,selectedFilterMap:t}},[m,l,o,u]),{filterElements:C,modalFilterElements:N}=(0,d.useMemo)(()=>{let e=[],s=[];return m.forEach((a,d)=>{let c=null==l?void 0:l[a];if(p()(c)&&(null==c?void 0:c.length)>0){var v,j,I,C,N,E,S;let l=(null==c?void 0:c.length)>10,p=null!==(j=null===(v=k[a])||void 0===v?void 0:v.length)&&void 0!==j?j:0,L=[];L.push((0,n.jsxs)("div",{className:" border-b-[1px] border-b-darkcolor/[0.1] ",children:[(0,n.jsxs)("span",{className:" cursor-pointer hover:font-semibold text-[12px] mb-[6px] flex gap-[5px] ",onClick:e=>{h(a)},children:[(0,n.jsx)("span",{children:(0,n.jsx)(b.G,{icon:t(25667).faXmark,transform:{size:14}})}),(0,n.jsx)("span",{children:"Clear all"})]}),l&&(0,n.jsx)("div",{className:" flex gap-[5px] text-[13px] mb-[12px] ",children:(0,n.jsx)(P.Z,{clearButton:!0,className:" h-auto py-[4px] px-[5px] ",value:(null==i?void 0:i[a])||"",onChange:e=>{f(a,e.target.value||"")},placeholder:"Search (".concat(null!==(I=c.length)&&void 0!==I?I:0," items)...")})})]},"clear_"+a));let _=c;if(l){let e=null==i?void 0:null===(N=i[a])||void 0===N?void 0:null===(C=N.toLowerCase())||void 0===C?void 0:C.trim();(null!==(S=null==e?void 0:null===(E=e.trim)||void 0===E?void 0:E.call(e))&&void 0!==S?S:"")!==""&&(_=null==_?void 0:_.filter(l=>{var t;return x.Z.searchIsTextInside(null===(t=String(l))||void 0===t?void 0:t.toLowerCase(),e)}))}_.forEach((e,l)=>{let t=a+u+e;L.push((0,n.jsxs)("div",{className:" text-[13px] flex py-[7px] border-b-[1px] border-b-darkcolor/[0.1]",children:[(0,n.jsx)("span",{children:(0,n.jsx)(R.Z,{disabled:r,className:" bg-darkcolor/[0.2] "+(r?" !cursor-not-allowed ":""),value:(null==o?void 0:o[t])===!0,onChange:e=>{y(a,t,e)}})}),(0,n.jsx)("span",{onClick:r?null:e=>{w(a,t)},className:" flex-1 ml-[9px] select-none break-all pr-[4px] "+(r?" !cursor-not-allowed ":""),children:e})]},"k"+a+"v"+l))});let O=e=>{var l;let t=null!==(l=String(e).split(u)[1])&&void 0!==l?l:"";return t.length>20?t.substring(0,20)+"...":t},F=(()=>{if(0===p)return"";let e=k[a];return null==e?void 0:e.map(O).join(", ")})(),B=e=>(0,n.jsx)("span",{children:(0,n.jsx)(g.Z,{noScale:r,disabled:r,className:"!bg-transparent",children:(0,n.jsxs)("span",{className:"line-clamp-1 w-max",children:[x.Z.upperFirst(a,!0),p>0&&(0,n.jsx)("span",{className:" ml-[5px] bg-bwcentercolor text-white rounded ",children:(0,n.jsx)("span",{className:" px-[5px] py-[2px] rounded bg-darkcolor/[0.4] ",children:p})})]})})});if(m.length>=4){let e=(0,n.jsxs)(M,{value:a,disabled:r,children:[(0,n.jsx)(D,{disabled:r,className:"pr-4 py-1 ",children:(0,n.jsx)(A.Z,{title:F||"NA",contentClass:"!border-gray-300 border",children:B(!0)})}),!r&&(0,n.jsx)(Z,{children:(0,n.jsx)("div",{className:"flex flex-col px-4 w-full pt-2 border-t border-darkcolor/[0.1]",children:(0,n.jsx)("div",{className:"max-h-[300px] overflow-y-auto pr-[12px] w-full",children:L})})})]},"filter_".concat(a));s.push({element:e,selectedCount:p})}d<4&&(r?e.push((0,n.jsx)(A.Z,{title:F||"NA",children:(0,n.jsx)("span",{className:" mr-[8px] "+(r?" [&_*]:!cursor-not-allowed ":" "),children:B(!1)},"filter_"+a)})):e.push((0,n.jsx)(A.Z,{content:F||"NA",children:(0,n.jsx)("span",{className:" mr-[8px] ",children:(0,n.jsx)(T.Z,{align:"start",width:300,content:(0,n.jsx)("div",{className:" text-darkcolor ",children:(0,n.jsx)("div",{className:" flex flex-col max-h-[300px] overflow-y-auto pr-[12px] ",children:L})}),children:B(!1)})},"filter_"+a)})))}}),{filterElements:e,modalFilterElements:s}},[m,l,I,u,o,r,k,i,h,f,y,w]);return(0,n.jsxs)(n.Fragment,{children:[j,C,m.length>4&&(0,n.jsx)(F,{content:N.sort((e,l)=>l.selectedCount-e.selectedCount).map(e=>e.element)})]})},U=t(90216);t(46651);var z=t(89520),G=t.n(z),W=t(10854),H=t(59128),q=t.n(H),V=t(93810),K=t.n(V),Q=t(1346),Y=t(56095),J=t(30278),X=t(63020),$=t(84318),ee=t(57391),el=t(5529),et=t(21576),en=t(82407),eo=t(57099),ei=t(21770),er=t(48958),es=t(30166);let ea=(0,es.default)(()=>Promise.all([t.e(7699),t.e(6231)]).then(t.bind(t,49089)).then(e=>e.FaExclamationCircle),{loadableGenerated:{webpack:()=>[null]}});function ed(e){var l;let{open:t,onClose:o,type:i="limit_exceeded",suggestedLlms:a=["GPT-4o Mini"],percentUsed:d,otherUsageType:c}=e,v=(0,s.useRouter)(),{data:m}=(0,r.Pc)({ignoreNeedLogin:!0}),p=!!(null==m?void 0:null===(l=m.result)||void 0===l?void 0:l.organizationAdmin),h=(0,ei.D)({mutationFn:async()=>{let e=await (0,u.Bz6)({});if(!(null==e?void 0:e.success))throw Error((null==e?void 0:e.error)||"Failed to update organization throttling.")},onError:e=>{j.Am.error((null==e?void 0:e.message)||"Failed to update organization throttling.")},onSettled:()=>{o(!1)}}),f=(null==a?void 0:a.length)?1===a.length?a[0]:a.slice(0,-1).join(", ")+", or "+a[a.length-1]:"GPT-4o Mini";return(0,n.jsx)(er.Vq,{open:t,children:(0,n.jsxs)(er.cZ,{className:"max-w-lg flex flex-col items-center gap-6",children:[(0,n.jsx)(ea,{className:(0,O.cn)("text-5xl",{"text-amber-500":["limit_exceeded","compute_point_budgeting"].includes(i),"text-red-500":"no_usage_points"===i,hidden:"limit_exceeded"===i})}),"limit_exceeded"===i&&!c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center",children:[(0,n.jsx)("div",{className:"text-center font-bold text-xl",children:"Do you want to continue to use this LLM?"}),(0,n.jsxs)("div",{className:"text-center text-sm",children:["You have exceeded our recommended daily usage for this LLM. We recommend switching to a cheaper LLM like ",f," so your compute points last the month. You may still continue using this LLM if you want."]}),p?(0,n.jsxs)("div",{className:"text-center text-sm",children:["View your current compute points usage"," ",(0,n.jsx)("span",{className:"underline font-medium text-bwleftblue cursor-pointer",onClick:()=>v.push("/admin/profile/"),children:"here"}),"."]}):null]}),(0,n.jsxs)("div",{className:"space-y-2.5 flex flex-col items-center",children:[(0,n.jsxs)(g.Z,{disabled:h.isPending,className:(0,O.cn)("rounded-full !bg-bwleftblue !text-darkcoloro dark:text-darkwhite/[0.7] !py-1.5 !px-10 !font-medium",{"grayscale !opacity-50 pointer-events-none":h.isPending}),onClick:()=>o(!0),children:["No, Switch Me to ",a?a[0]:"GPT-4o Mini"]}),(0,n.jsx)(g.Z,{disabled:h.isPending,className:(0,O.cn)("rounded-xl flex items-center text-bwleftblue !bg-transparent hover:!bg-transparent font-medium",{"grayscale !opacity-50 pointer-events-none":h.isPending}),onClick:()=>h.mutate(),children:"Yes, Continue Using This LLM"})]})]}),"no_usage_points"===i&&!c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center",children:[(0,n.jsx)("div",{className:"text-center font-bold text-xl",children:"You have run out of compute points."}),(0,n.jsxs)("div",{className:"text-center text-sm",children:["You can continue using ",f," for free."," ",p?"To use the current LLM, you must buy more compute points or wait for your monthly subscription to renew.":"To use the current LLM, please contact your organization admin to purchase more compute points or wait for your monthly subscription to renew."]})]}),(0,n.jsxs)("div",{className:"space-y-2.5 flex flex-col items-center",children:[(0,n.jsxs)(g.Z,{disabled:h.isPending,className:(0,O.cn)("rounded-full !bg-bwleftblue !text-darkcoloro dark:text-darkwhite/[0.7] !py-1.5 !px-10 !font-medium",{"grayscale !opacity-50 pointer-events-none":h.isPending}),onClick:()=>o(!0),children:["Switch to ",a?a[0]:"GPT-4o Mini"]}),(0,n.jsx)(g.Z,{className:(0,O.cn)("rounded-xl flex items-center text-bwleftblue !bg-transparent hover:!bg-transparent font-medium"),onClick:()=>v.push("/admin/profile/"),children:"Go To Billing"})]})]}),"compute_point_budgeting"===i&&!c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center",children:[(0,n.jsx)("div",{className:"text-center font-bold text-xl",children:d&&d<95?"You have used over ".concat(d,"% of your compute points and still have over ").concat(d>=75?"a week":"two weeks"," before your subscription renews."):"You are close to using up all of your compute points for the month"}),(0,n.jsxs)("div",{className:"text-center text-sm",children:["To spread your compute points throughout the month, we recommend switching to using ",f," for free. You can use this LLM when it is less than ",d>=75?"one week":"two weeks"," until you have to renew your subscription."," ",p?"Optionally, you can buy more compute points at any time to start using this LLM.":"Optionally, you can contact your organization admin to buy more compute points to start using this LLM.",(0,n.jsx)("a",{href:"https://abacus.ai/help/howTo/chatllm/faqs/billing#what-is-this-75-usage-message-im-receiving",target:"_blank",rel:"noopener noreferrer",className:"text-bwleftblue underline",children:"(Learn more)"}),(0,n.jsx)("br",{})]})]}),(0,n.jsxs)("div",{className:"space-y-2.5 flex flex-col items-center",children:[(0,n.jsxs)(g.Z,{disabled:h.isPending,className:(0,O.cn)("rounded-full !bg-bwleftblue !text-darkcoloro dark:text-darkwhite/[0.7] !py-1.5 !px-10 !font-medium",{"grayscale !opacity-50 pointer-events-none":h.isPending}),onClick:()=>o(!0),children:["Switch to ",a[0]||"GPT-4o Mini"]}),(0,n.jsx)(g.Z,{className:(0,O.cn)("rounded-xl flex items-center text-bwleftblue !bg-transparent hover:!bg-transparent font-medium"),onClick:()=>v.push("/admin/profile/"),children:"Go To Billing"})]})]}),c&&(0,n.jsxs)(n.Fragment,{children:["no_usage_points"===i&&(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center",children:[(0,n.jsx)("div",{className:"text-center font-bold text-xl",children:"You have run out of compute points."}),(0,n.jsx)("div",{className:"text-center text-sm mb-4",children:p?"To continue using ".concat(c," generation, you must buy more compute points or wait for your monthly subscription to renew."):"To continue using ".concat(c," generation, please contact your organization admin to purchase more compute points or wait for your monthly subscription to renew.")})]}),"compute_point_budgeting"===i&&(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center",children:[(0,n.jsx)("div",{className:"text-center font-bold text-xl",children:d&&d<95?"You have used more than ".concat(d,"% of your compute points way too quickly, and your subscription is still more than ").concat(d>=75?"a week":"two weeks"," away from renewing."):"You are close to using up all of your compute points for the month"}),(0,n.jsxs)("div",{className:"text-center text-sm mb-4",children:[p?"You can purchase more compute points or wait until you are ".concat(d>=75?"a week":"two weeks"," away from renewing to use the remainder of your compute points for ").concat(c," generation."):"Please contact your organization admin to purchase more compute points or wait until you are ".concat(d>=75?"a week":"two weeks"," away from renewing to use the remainder of your compute points for ").concat(c," generation. "),(0,n.jsx)("a",{href:"https://abacus.ai/help/howTo/chatllm/faqs/billing#what-is-this-75-usage-message-im-receiving",target:"_blank",rel:"noopener noreferrer",className:"text-bwleftblue underline",children:"(Learn more)"}),(0,n.jsx)("br",{})]})]}),(0,n.jsxs)("div",{className:"space-y-2.5 flex flex-col items-center",children:[(0,n.jsx)(g.Z,{className:(0,O.cn)("rounded-full !bg-bwleftblue !text-darkcoloro dark:text-darkwhite/[0.7] !py-1.5 !px-10 !font-medium"),onClick:()=>o(!1,!0,!0),children:"Ok"}),(0,n.jsx)(g.Z,{className:(0,O.cn)("rounded-xl flex items-center text-bwleftblue !bg-transparent hover:!bg-transparent font-medium"),onClick:()=>v.push("/admin/profile/"),children:"Go To Billing"})]})]})]})})}var eu=t(53335),ec=t(36275),ev=t(56120),em=t(25415);function ep(e){let{sideBySideWW:l,isMobile:o,canSideBySide:i,data:s,dataScoreOpen:a,deploymentId:u,isWorkflowAgentFormInterface:c=!1,forceWidthDiff:v,widthDiffChanged:m,highlightColorHex:p,deploymentConversationId:h,scoreIndex:f,setScoreIndex:x}=e,[y,w]=(0,d.useState)(!1),j=(0,d.useRef)(null),[I,k]=(0,r.PB)("sidebar"),[C,A]=(0,r.PB)("sideBySideTimestamp"),[N,E]=(0,r.PB)("sideBySide"),{isSearchLLM:S,csvMsgInfo:L,showArtifactInfo:P}=(0,el.b)(e=>({isSearchLLM:e.isSearchLLM,csvMsgInfo:e.csvMsgInfo,showArtifactInfo:e.showArtifactInfo})),R="1"===N||"showArtifact"===P||S&&!o&&h||(null==L?void 0:L.content),_=(null==s?void 0:s.role)==="BOT",O=i&&"1"===N&&!!C&&C===encodeURIComponent((null==s?void 0:s.timestamp)||"")&&_,[M,D]=(0,d.useState)(!1),Z=(0,d.useRef)(null),[F,B]=(0,em.Z)("__cllm_highlightcolor_new",null),[U,z]=(0,d.useState)(p||null),G=(0,d.useMemo)(()=>F||U||"#FFDF9A",[F,U,p]);(0,d.useEffect)(()=>{z(G)},[G]);let W=(0,d.useMemo)(()=>{var e,l;return(null==s?void 0:null===(e=s.highlights)||void 0===e?void 0:e.results)||(null==s?void 0:null===(l=s.searchResults)||void 0===l?void 0:l.results)},[s]);return(0,d.useEffect)(()=>{let e=null==W?void 0:W.some(e=>!0===e.is_realtime_synced_dataset_source);D(e),x(e?null:f)},[f,W]),(0,n.jsxs)("div",{className:"sidebar-right",children:[O&&R&&(0,n.jsx)(J.E.div,{dragElastic:0,dragMomentum:!1,onDragStart:(e,l)=>{w(!0),j.current=l.point.x+(null!=v?v:0)},onDrag:(e,l)=>{let t=j.current-l.point.x;null==m||m(t)},onDragEnd:(e,l)=>{let t=j.current-l.point.x;null==m||m(t),w(!1),j.current=null},drag:"x",initial:{x:-(null!=v?v:0)},style:{right:l-3+"px"},className:" absolute w-[6px] bg-blue-600 top-0 bottom-0 z-[5] hover:opacity-60 opacity-0 cursor-ew-resize "+(y?" !opacity-60 ":" ")}),!c&&(0,n.jsx)(J.E.div,{className:" z-[5] absolute top-0 bottom-0 right-0 ",animate:{display:R&&O?"block":"none",width:l+(R&&null!=v?v:0)},children:O&&(0,n.jsxs)("div",{className:" bg-darkcoloro text-darkcolor text-[13px] font-[200] flex flex-col absolute top-0 bottom-0 right-0 left-0 border-l-[2px] border-b-2 border-darkcolor/[0.1] rounded-tl rounded-bl ",children:[M&&(0,n.jsx)("span",{className:"absolute font-bold left-2 top-2",children:"All sources"}),(0,n.jsx)("div",{className:(0,eu.m6)("z-[1] relative w-[95px]",M&&"flex self-end"),children:(0,n.jsx)("div",{className:" ",children:(0,n.jsxs)(g.Z,{className:" m-[3px] ",noScale:!0,onClick:e=>{k(localStorage.getItem("isSidebar")),E(null),A(null)},children:[(0,n.jsx)("span",{className:" mr-[7px] opacity-60 ",children:(0,n.jsx)(b.G,{icon:t(13199).Y5,transform:{size:16,flipX:!0}})}),(0,n.jsx)("span",{children:"Hide"})]})})}),!M&&(0,n.jsx)("div",{className:(0,eu.m6)(" z-[1] flex w-[115px] absolute -right-[8px] top-0 ",M&&"right-[90px]"),children:(0,n.jsx)("div",{className:" ",children:(0,n.jsx)(T.Z,{ref:Z,align:"end",width:315,content:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:(0,n.jsx)(ec.Z,{color:U||"#FFDF9A",onChangeColor:e=>{z(e)}})}),(0,n.jsxs)("div",{className:" flex items-center justify-center mt-[15px] text-[13px] gap-[10px] ",children:[p&&(0,n.jsx)(g.Z,{className:" mr-[15px] ",onClick:e=>{var l,t;z(e=>(B(null),p)),null===(t=Z.current)||void 0===t||null===(l=t.close)||void 0===l||l.call(t)},children:"Reset"}),(0,n.jsx)(g.Z,{onClick:e=>{var l,t;null===(t=Z.current)||void 0===t||null===(l=t.close)||void 0===l||l.call(t)},children:"Cancel"}),(0,n.jsx)(g.Z,{useAccentColor:!0,onClick:e=>{var l,t;z(e=>(B(e),e)),null===(t=Z.current)||void 0===t||null===(l=t.close)||void 0===l||l.call(t)},children:"Use Color"})]})]}),children:(0,n.jsx)("span",{children:(0,n.jsxs)(g.Z,{className:" m-[3px] ",noScale:!0,children:[(0,n.jsx)("span",{style:{color:G},className:" mr-[7px] opacity-60 ",children:(0,n.jsx)(b.G,{icon:t(34287).TX,transform:{size:16}})}),(0,n.jsx)("span",{children:"Highlight"})]})})})})}),(0,n.jsx)("div",{className:" flex-1 relative",children:(0,n.jsx)(ev.Z,{deploymentId:u,deploymentConversationId:h,color:G,data:s,isRealtimeSource:M,allSources:W,dataScoreOpen:a,scoreIndex:f,setScoreIndex:x,isFull:!0})})]})})]})}var eh=t(97742),ef=t(71096),ex=t.n(ef),eg=t(67375),eb=t(75372),ey=t(23888),ew=t(68532),ej=t(89884);let eI=(0,d.forwardRef)((e,l)=>{var o;let i=(0,d.useRef)(null),[r,s]=(0,d.useState)(!1),a=(0,d.useCallback)(()=>{if(null!=i.current){var e,l;ej.Z.isSafari()?(0,ew.Z)(null!==(e=i.current.scrollHeight)&&void 0!==e?e:0,{elementToScroll:i.current}):i.current.scrollTo({top:null!==(l=i.current.scrollHeight)&&void 0!==l?l:0,behavior:"smooth"})}},[i]);(0,d.useImperativeHandle)(l,()=>({scrollToBottom:()=>{a()},forceSetAlreadyStopped:e=>{}}),[a]);let u=(0,d.useCallback)(e=>{a()},[a]),c=(0,d.useCallback)(()=>{if(null!=i.current){let e=i.current.scrollTop,l=i.current.scrollHeight;s(e+i.current.clientHeight>=l-15)}},[i]),v=(0,d.useCallback)(e=>{c()},[c]);return(0,d.useEffect)(()=>{c()},[e.children]),(0,n.jsxs)("div",{className:" absolute inset-0 overflow-y-auto ",ref:i,onScroll:v,children:[e.children,!r&&(0,n.jsx)("div",{className:" sticky bottom-0 left-0 right-0 ",children:(0,n.jsx)("button",{className:(null!==(o=e.stopClassName)&&void 0!==o?o:" ")+" ",onClick:u,type:"button",children:(0,n.jsx)(b.G,{icon:t(87087).r5,transform:{size:17}})})})]})});var ek=t(79057),eC=t(83113),eA=t(591),eN=t(81447);let eE=(0,es.default)(()=>Promise.all([t.e(6051),t.e(9075)]).then(t.bind(t,22744)).then(e=>e.MdOutlineDataUsage)),eS=(0,es.default)(()=>Promise.all([t.e(9212),t.e(4620)]).then(t.bind(t,45202)).then(e=>e.LuRefreshCw),{loadableGenerated:{webpack:()=>[null]}}),eL=(0,es.default)(()=>Promise.all([t.e(9212),t.e(4620)]).then(t.bind(t,45202)).then(e=>e.LuClipboardCheck),{loadableGenerated:{webpack:()=>[null]}}),eT=(0,es.default)(()=>Promise.all([t.e(9212),t.e(4620)]).then(t.bind(t,45202)).then(e=>e.LuMoreVertical),{loadableGenerated:{webpack:()=>[null]}}),eP=(0,es.default)(()=>Promise.all([t.e(9212),t.e(4620)]).then(t.bind(t,45202)).then(e=>e.LuPencil),{loadableGenerated:{webpack:()=>[null]}}),eR=(0,es.default)(()=>Promise.all([t.e(9212),t.e(4620)]).then(t.bind(t,45202)).then(e=>e.LuTrash),{loadableGenerated:{webpack:()=>[null]}}),e_=(0,es.default)(()=>Promise.all([t.e(7240),t.e(9866)]).then(t.bind(t,61273)).then(e=>e.FaRegCirclePlay),{loadableGenerated:{webpack:()=>[null]}}),eO=(0,es.default)(()=>Promise.all([t.e(7240),t.e(9866)]).then(t.bind(t,61273)).then(e=>e.FaRegCirclePause),{loadableGenerated:{webpack:()=>[null]}});function eM(e){var l,t,o;let{taskId:i,noData:a,centered:m=!1}=e,[p,h]=(0,d.useState)(!1),{data:f}=(0,r.Pc)({ignoreNeedLogin:!0}),x=(null==f?void 0:null===(l=f.result)||void 0===l?void 0:l.isChatOnly)!==!0,{data:g,isError:b}=(0,v.a)({queryKey:["task-individual",i],queryFn:async e=>{let{queryKey:[l,t]}=e,n=await (0,u.LIi)({chatllmTaskId:t});if(!(null==n?void 0:n.success))throw Error((null==n?void 0:n.error)||"Failed to fetch task");return n},retry:!1,select:e=>e.result});(0,r.Aw)({convoId:null==g?void 0:g.deploymentConversationId,taskId:i});let y=a&&(null==g?void 0:null===(t=g.scheduleInfo)||void 0===t?void 0:t.nextRunTime)&&2>=Math.abs(ex()().diff(ex()(1e3*g.scheduleInfo.nextRunTime),"minute")),w=(0,s.useRouter)(),I=(0,c.NL)(),k=(0,ei.D)({mutationFn:async e=>{let l=await (0,u.GC5)({payload:{...e,chatllmTaskId:null==g?void 0:g.chatllmTaskId}});if(!(null==l?void 0:l.success))throw Error((null==l?void 0:l.error)||"Failed to update task.");return l},onSuccess:()=>{I.invalidateQueries({queryKey:["tasks"]}),I.invalidateQueries({queryKey:["task",null==g?void 0:g.chatllmTaskId]}),I.invalidateQueries({queryKey:["task-form-data",null==g?void 0:g.chatllmTaskId]}),h(!1),j.Am.success("Task updated successfully")},onError:e=>{j.Am.error((null==e?void 0:e.message)||"Failed to update task")}}),C=(0,ei.D)({mutationFn:async e=>{let l=await (0,u.UMi)({payload:{...e,chatllmTaskId:null==g?void 0:g.chatllmTaskId}});if(!(null==l?void 0:l.success))throw Error((null==l?void 0:l.error)||"Failed to update task.");return e},onSuccess:e=>{e.delete&&h(!1),I.invalidateQueries({queryKey:["tasks"]}),I.invalidateQueries({queryKey:["task",null==g?void 0:g.chatllmTaskId]}),I.invalidateQueries({queryKey:["task-form-data",null==g?void 0:g.chatllmTaskId]}),j.Am.success({pause:"Task paused successfully",resume:"Task resumed successfully",delete:"Task deleted successfully"}[e.pause?"pause":e.resume?"resume":"delete"])},onError:e=>{j.Am.error((null==e?void 0:e.message)||"Failed to update task.")}});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,O.cn)("flex p-2",{"rounded-lg border border-gray-200 dark:border-gray-600 overflow-hidden shadow-md":!m,"items-center":m}),children:[(0,n.jsxs)("div",{className:"flex flex-col grow gap-0.5",children:[m?null:(0,n.jsx)("div",{className:"flex items-center gap-1.5",children:(0,n.jsx)("div",{className:"text-sm font-medium line-clamp-1",children:b?"Deleted Task":(null==g?void 0:g.name)||"Task"})}),b||m?null:(0,n.jsx)("div",{className:"text-xs opacity-60 line-clamp-1",children:(0,eC.c)(null==g?void 0:g.scheduleInfo,!0)}),!b&&(null==g?void 0:null===(o=g.scheduleInfo)||void 0===o?void 0:o.nextRunTime)?(0,n.jsx)(n.Fragment,{children:y?(0,n.jsx)("div",{className:"text-xs opacity-60 whitespace-nowrap mr-1",children:"Task running now"}):(0,n.jsxs)("div",{className:"text-xs opacity-60 whitespace-nowrap",children:["Next run at"," ",ex()((null==g?void 0:g.scheduleInfo.nextRunTime)*1e3).format("h:mma, D/MM/YY")]})}):null,!b&&!m&&(null==g?void 0:g.computePointsUsed)?(0,n.jsx)(A.Z,{delayDuration:0,title:"".concat(null==g?void 0:g.computePointsUsed," compute points used for all task runs"),children:(0,n.jsxs)("span",{className:"mt-1 cursor-default group flex items-center gap-px text-xs group opacity-60",children:[(0,n.jsx)(eE,{className:"text-xs"}),(0,n.jsxs)("span",{className:"mt-px",children:[null==g?void 0:g.computePointsUsed," compute points used"]})]})}):null]}),y?(0,n.jsx)(eS,{className:"text-lg text-bwleftblue animate-spin"}):b?null:(0,n.jsxs)(eA.h_,{children:[(0,n.jsx)(eA.$F,{asChild:!0,children:(0,n.jsx)(eN.z,{size:"icon-xs",variant:"ghost",children:(0,n.jsx)(eT,{})})}),(0,n.jsxs)(eA.AW,{align:"start",className:"w-32",children:[(null==g?void 0:g.lifecycle)==="COMPLETED"?(0,n.jsxs)(eA.Xi,{className:"gap-1.5 cursor-pointer",onClick:()=>C.mutateAsync({delete:!0}),children:[(0,n.jsx)(eR,{}),(0,n.jsx)("span",{children:"Delete"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(eA.Xi,{className:(0,O.cn)("gap-1.5 cursor-pointer",{"pointer-events-none":k.isPending}),onClick:()=>{(null==g?void 0:g.lifecycle)==="ACTIVE"?C.mutateAsync({pause:!0}):C.mutateAsync({resume:!0})},children:[(null==g?void 0:g.lifecycle)==="ACTIVE"?(0,n.jsx)(eO,{}):(0,n.jsx)(e_,{}),(0,n.jsx)("span",{children:(null==g?void 0:g.lifecycle)==="ACTIVE"?"Pause":"Resume"})]}),(0,n.jsxs)(eA.Xi,{className:"gap-1.5 cursor-pointer",onClick:()=>h(!0),children:[(0,n.jsx)(eP,{}),(0,n.jsx)("span",{children:"Edit"})]})]}),(0,n.jsxs)(eA.Xi,{className:"gap-1.5 cursor-pointer whitespace-nowrap",onClick:()=>{w.push(x?"/admin/tasks":"/tasks")},children:[(0,n.jsx)(eL,{}),(0,n.jsx)("span",{children:"See All Tasks"})]})]})]})]}),(0,n.jsx)(ek.Z,{taskId:null==g?void 0:g.chatllmTaskId,open:p,onClose:()=>h(!1),onEdit:k.mutateAsync,onLifecycle:C.mutateAsync,disabled:k.isPending||C.isPending})]})}var eD=t(93398);let eZ=e=>{var l;let{isTasks:t=!1,initialLastUsedBot:n}=e,{data:o}=(0,v.a)({enabled:!n,queryKey:["lastUsedBot"],queryFn:()=>(0,u.hk3)({}),select:e=>{var l;return null===(l=e.result)||void 0===l?void 0:l.externalApplicationId}}),i=null!==(l=null==n?void 0:n.externalApplicationId)&&void 0!==l?l:o,[s,a]=(0,r.PB)("appId"),{data:c}=(0,r.KS)({}),m=(0,d.useMemo)(()=>(null==c?void 0:c.result)||[],[c]),p=(0,d.useMemo)(()=>{var e;return null===(e=m.find(e=>{var l;return null===(l=e.predictionOverrides)||void 0===l?void 0:l.forTaskRuns}))||void 0===e?void 0:e.externalApplicationId},[m]),h=(0,d.useMemo)(()=>s===p,[s,p]);return(0,d.useEffect)(()=>{t?h||a(p):h&&i&&a(i)},[t,i,h,a,p]),null},eF=e=>{let{isTasks:l=!1}=e,{lastUsedBot:t}=(0,eD.e)();return(null==t?void 0:t.loaded)?(0,n.jsx)(eZ,{isTasks:l,initialLastUsedBot:t.result}):null};function eB(e){let{onSuccess:l,userCode:t}=e,[o,i]=(0,d.useState)(Array(6).fill("")),[r,s]=(0,d.useState)(""),[a,c]=(0,d.useState)(!1),[v,m]=(0,d.useState)(!1),p=(0,d.useRef)(!1),h=(0,d.useCallback)((e,l)=>{let t=l.replace(/[^A-Z0-9]/gi,"").toUpperCase();if(t.length>1){let l=[...o];for(let n=0;n<Math.min(t.length,6-e);n++)l[e+n]=t[n];i(l);let n=l.findIndex((l,t)=>t>e&&!l);setTimeout(()=>{let e=document.querySelector('input[data-index="'.concat(-1!==n?n:5,'"]'));e&&e.focus()},0)}else{let l=t.slice(-1);i(t=>{let n=[...t];return n[e]=l,n}),l&&e<5&&setTimeout(()=>{let l=document.querySelector('input[data-index="'.concat(e+1,'"]'));l&&l.focus()},0)}},[o]),f=(0,d.useCallback)((e,l)=>{if("Backspace"===l.key)l.preventDefault(),i(l=>{let t=[...l];return t[e]="",t}),e>0&&setTimeout(()=>{let l=document.querySelector('input[data-index="'.concat(e-1,'"]'));l&&(l.focus(),l.select())},0);else if("ArrowLeft"===l.key&&e>0){let l=document.querySelector('input[data-index="'.concat(e-1,'"]'));l&&l.focus()}else if("ArrowRight"===l.key&&e<5){let l=document.querySelector('input[data-index="'.concat(e+1,'"]'));l&&l.focus()}},[]),x=(0,d.useCallback)(async()=>{let e=o.join("");if(6!==e.length){s("Please enter a valid 6-digit code");return}if(!v&&!p.current)try{m(!0);let t=await (0,u.prz)({userCode:e});if(null==t?void 0:t.success)c(!0),p.current=!0,s("Device successfully authenticated!\nYou may close this window now"),l&&l();else throw Error((null==t?void 0:t.error)||"Failed to verify code")}catch(e){p.current||s(e.message)}finally{m(!1)}},[o,l,v]);return(0,d.useEffect)(()=>{if((null==t?void 0:t.length)!==6||p.current){if(!t){let e=document.querySelector('input[data-index="0"]');e&&e.focus()}}else{i(t.split(""));let e=setTimeout(()=>{p.current||x()},500);return()=>clearTimeout(e)}},[t,x]),(0,n.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[80vh]",children:(0,n.jsxs)("div",{className:"text-center max-w-[600px]",children:[(0,n.jsx)("div",{className:"font-matter text-[50px] font-light leading-[1.2] mb-5 text-gray-900 dark:text-white",children:"Device Authentication"}),!a&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"font-ibm-plex-sans text-[20px] leading-[1.35] tracking-[1.07px] text-gray-700 dark:text-gray-200 mb-10",children:"Please enter the 6-digit code shown in your CodeLLM application"}),(0,n.jsx)("div",{className:"flex justify-center gap-3 mb-5",children:o.map((e,l)=>(0,n.jsx)("input",{"data-index":l,type:"text",maxLength:1,value:e,onChange:e=>h(l,e.target.value),onKeyDown:e=>f(l,e),className:"bg-white dark:bg-gray-800 border-2 border-[#3391ED] rounded-xl text-gray-900 dark:text-gray-100 font-mono text-2xl w-[50px] h-[60px] text-center outline-none uppercase focus:border-[#4CAF50] transition-colors duration-200"},l))}),(0,n.jsx)("button",{onClick:x,className:"bg-gradient-to-r from-[#0ccfe4] via-[#3391ed] to-[#8c54ff] border-none rounded-[25px] text-white cursor-pointer font-matter text-xl font-light px-10 py-3.5 mt-5 hover:opacity-90 transition-opacity duration-200",children:"Verify Code"})]}),(0,n.jsx)("div",{className:"font-ibm-plex-sans text-base mt-5 min-h-[20px]\n          ".concat(a?"text-green-500 dark:text-green-400":"text-red-500 dark:text-red-400"),children:r})]})})}var eU=t(13894);let ez=e=>{let{segmentInfo:l,sInd:o,activitySegments:i,botIconUrl:r,llmBotIcon:s}=e,{isSpinny:a,temp:d,segment:u,activityType:c,metadata:v,type:m,isResearchDone:p}=l;return a&&d?o===(null==i?void 0:i.length)-1?(0,n.jsx)("div",{"data-gramm":"false",className:"".concat("shimmer dark:shimmerDark pointer-events-none temp !m-0 !p-0"),children:u}):null:u?"deep_research"===m&&p?(0,n.jsxs)("div",{className:"flex gap-0.25 items-center text-neutral-500/[0.8]",children:[(0,n.jsx)("div",{className:"w-[24px] h-[24px]",children:(0,n.jsx)(b.G,{icon:t(23995).fV,transform:{size:18}})}),(0,n.jsx)("div",{children:"Research completed"})]}):(0,n.jsxs)("div",{className:"flex gap-3",children:["web_search"===c?(0,n.jsx)("div",{className:"mt-[8px] w-[24px] h-[24px]",children:(0,n.jsx)(b.G,{icon:t(79100).wn,transform:{size:18}})}):"web_search_result"===c?(0,n.jsx)("img",{referrerPolicy:"no-referrer",className:"rounded-full w-[24px] h-[24px] mt-[8px] border-[1px] border-darkcolor/[0.15]",src:"".concat((null==v?void 0:v.faviconUrl)||(null==v?void 0:v.favicon_url))}):"text"===m?(0,n.jsx)(eG,{botIconUrl:r,llmBotIcon:s}):null,(0,n.jsx)(eb.ZP,{text:u,noAnim:!0})]}):void 0},eG=e=>{let{botIconUrl:l,llmBotIcon:t}=e,o=(0,d.useMemo)(()=>(t?"/chatllm/staticllm/".concat(t):l)||(0,eU.B)("hp_chat_llm.webp"),[l,t]);return(0,n.jsx)("img",{referrerPolicy:"no-referrer",alt:"",src:o||"",className:" rounded-xl w-[24px] h-[24px] mt-[5px] border-[1px] border-darkcolor/[0.15] "})};var eW=e=>{let{botSegments:l=[],isProcessing:o,botIconUrl:i,llmBotIcon:r,isLastResponse:s}=e,{setDeepResearchMsgInfo:a}=(0,el.b)(e=>({setDeepResearchMsgInfo:e.setDeepResearchMsgInfo})),[u,c]=(0,d.useState)("activity"),v=(0,d.useRef)(null),[m,p]=(0,d.useState)(!1),h=(0,d.useMemo)(()=>{let e=[],t=-1;for(let i=0;i<l.length;i++){var n,o;if(null===(n=l[i])||void 0===n?void 0:n.isResearchDone){e.push(l[i]);break}t>-1?(null===(o=l[i])||void 0===o?void 0:o.isStreamingDeepResearch)&&e.push(l[i]):l[i].isRunningResearch&&(t=i)}return e},[l,o]),f=(0,d.useMemo)(()=>{if("sources"===u)return h.filter(e=>"web_search_result"===e.activityType).reduce((e,l)=>{let{metadata:t}=l;if(null==e?void 0:e[null==t?void 0:t.hostname])e[null==t?void 0:t.hostname].count+=1;else if(null==t?void 0:t.url){let l=new URL(t.url);e[null==t?void 0:t.hostname]={faviconUrl:t.faviconUrl||t.favicon_url,count:1,url:l.origin}}return e},{})},[h,u]),x=(0,d.useCallback)(()=>{let e=v.current;return e.scrollHeight-e.scrollTop===e.clientHeight},[]),g=(0,d.useCallback)(()=>{let e=v.current;e.scrollTop=e.scrollHeight},[]),y=(0,d.useCallback)(()=>{x()?p(!1):p(!0)},[]);return(0,d.useEffect)(()=>{!m&&o&&g()},[l,m,o]),(0,n.jsxs)("div",{"data-gramm":"false",className:"prose0 prose dark:prose-invert bg-darkcoloro text-darkcolor flex flex-col absolute top-0 bottom-0 right-0 left-0 shadow-lg mr-[-16px] rounded-r-[10px] overflow-hidden",style:{fontFamily:'ui-sans-serif, -apple-system, system-ui, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"'},children:[(0,n.jsxs)("div",{className:"h-[62px] flex justify-center px-6 py-3 sticky top-0 markdown",children:[(0,n.jsxs)("div",{className:"flex items-center rounded-full border-[4px] border-neutral-200 bg-neutral-200 dark:border-bwcentercolor dark:bg-bwcentercolor transition-all h-[44px]",children:[(0,n.jsx)("button",{className:"!min-h-[36px] min-w-[100px] select-none rounded-full px-2 py-1 text-token-text-primary ".concat("activity"===u?"bg-neutral-50 shadow dark:bg-darkcoloro":""),onClick:()=>{c("activity")},children:"Activity"}),(0,n.jsx)("button",{className:"!min-h-[36px] min-w-[100px] select-none rounded-full px-2 py-1 text-token-text-primary ".concat("sources"===u?"bg-neutral-50 shadow dark:bg-darkcoloro":""),onClick:()=>{c("sources")},children:"Sources"})]}),(0,n.jsx)("div",{className:"absolute top-[24px] right-[14px] cursor-pointer",onClick:()=>{a(null)},children:(0,n.jsx)(b.G,{icon:t(19173).EO,transform:{size:14}})})]}),(0,n.jsx)("div",{ref:v,onScroll:y,className:"overflow-auto markdown",children:"activity"===u?(0,n.jsx)("div",{className:"p-4 flex w-full flex-col gap-4",children:h.map((e,l)=>(0,n.jsx)(ez,{segmentInfo:e,sInd:l,activitySegments:h,botIconUrl:i,llmBotIcon:r},l))}):(0,n.jsx)("div",{className:"p-4 flex w-full flex-col gap-4",children:(0,n.jsx)("div",{className:"flex flex-col gap-2.5",children:Object.entries(f||{}).length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-base font-medium !text-[14px]",children:"All Sources"}),(0,n.jsx)("div",{className:"ml-[-12px] flex flex-wrap",children:Object.entries(f).map((e,l)=>{let[t,o]=e;return(0,n.jsxs)("a",{href:o.url,target:"_blank",className:"group flex items-center gap-0.5 rounded-xl px-3 py-2.5 hover:bg-neutral-300/[0.2] cursor-pointer no-underline dark:text-darkwhite",children:[(0,n.jsxs)("div",{className:"line-clamp-1 flex h-6 items-center gap-2 text-xs",children:[(0,n.jsx)("img",{src:o.faviconUrl,className:"icon-sm rounded-full bg-token-main-surface-primary object-cover w-[24px] h-[24px]"}),t.split(".")[1]]}),(0,n.jsx)("div",{className:"flex h-4 items-center justify-end pl-1",children:(0,n.jsx)("div",{className:"flex h-4 min-w-4 items-center justify-center rounded-full bg-neutral-300/[0.2] text-[8px] group-hover:bg-neutral-50 group-hover:dark:bg-darkcoloro",children:o.count})})]},l)})})]}):(0,n.jsx)(n.Fragment,{children:o&&s?(0,n.jsx)("div",{"data-gramm":"false",className:"shimmer dark:shimmerDark pointer-events-none temp !mx-0",children:"Compiling Sources"}):(0,n.jsx)("div",{className:"flex items-center justify-center h-[20rem]",children:"No sources available."})})})})})]})},eH=t(65308),eq=t(3426),eV=t(66888),eK=t(51517);let eQ=e=>new Promise(l=>setTimeout(l,e)),{useAgentsWS:eY}=eo.featureFlags||{};function eJ(e){var l,o,m,h,E,P,R,_,M,D,Z,F,z,H,V;let{deploymentId:ei,dataInit:er,dataInitConvosData:es,appIdOri:ea,agentId:eu,isAgent:ec,botNameOri:ev,isSelfServe:em,isAutonomousAgent:ef,isChatLLM:ew,botIconUrlOri:ej,isBinaryEnable:ek,dataInitChatParams:eC,orgHost:eA,listExtApps:eN,isHideTopBarParam:eE,hideCodeBlocksInit:eS,highlightColorHex:eL,isInternal:eT,isDeployError:eP,isWorkflowAgent:eR,isMobile:e_,isIOS:eO,isHostTeams:eD,isAndroid:eZ,workflowGraph:eU,extAppPredictionOverrides:ez,validAppConnectors:eG,agentInfo:eJ,dataInitUserInfo:e$,isWorkflowAgentChatInterface:e0}=e,e1=eY||!eR?u.$kl:u.J7i,[e2]=(0,r.PB)("preselectedTool"),e5=(0,s.useSearchParams)(),e6=(0,s.useRouter)(),e3=(0,d.useRef)(null),e4=(0,d.useRef)(null),e8=(0,d.useRef)(null),e9=(0,d.useRef)(null),e7=(0,d.useRef)(!1),[le,ll]=(0,d.useState)(!1),[lt,ln]=(0,d.useState)(null),[lo,li]=(0,C.N)(),[lr,ls]=(0,r.PB)("hostedAppContainerId"),la=(0,r.z0)(),ld=(0,r.br)(),{setIsProcessingMessage:lu,setWaitForName:lc,setIsProcessingFirstTime:lv,setConvoHistory:lm,setForceUpdateConvo:lp,setSegmentsToPreview:lh}=(0,eV.W)(e=>({setForceUpdateConvo:e.setForceUpdateConvo,setSegmentsToPreview:e.setSegmentsToPreview,setConvoHistory:e.setConvoHistory,setIsProcessingFirstTime:e.setIsProcessingFirstTime,setIsProcessingMessage:e.setIsProcessingMessage,setWaitForName:e.setWaitForName})),[lf,lx]=(0,r.PB)("hostedAppId"),[lg,lb]=(0,r.PB)("convoId"),[ly,lw]=(0,d.useState)(),lj=eX(lg),lI=(0,d.useRef)(!1),lk=(0,c.NL)(),{selectedFilesFromPersistence:lC,setSelectedFilesFromPersistence:lA,isDeletedFilesFromPersistence:lN,setDeletedFilesFromPersistence:lE,setSelectedGithubMetadataFiles:lS}=(0,W.G)(),[lL,lT]=(0,r.PB)("aiAssistedEditAgentAppId"),[lP,lR]=(0,r.PB)("assistedAgentProjectId"),[l_,lO]=(0,r.PB)("assistedChatbotProjectId"),[lM,lD]=(0,r.PB)("agentPreviewMode"),[lZ,lF]=(0,d.useState)(null),[lB,lU]=(0,d.useState)(null),[lz,lG]=(0,d.useState)(!1),[lW,{y:lH,width:lq,height:lV}]=(0,y.Z)(),{isDark:lK,themeApp:lQ}=(0,U.J)(),lY=!!(null==lQ?void 0:lQ[u.LPr]),lJ=(0,d.useMemo)(()=>((null==lQ?void 0:lQ[u.y$g])||[]).filter(e=>!!e.text),[null==lQ?void 0:lQ[u.y$g]]),[lX,l$]=(0,d.useState)(!0===eS),[l0,l1]=(0,d.useState)({}),l2="__##__",[l5,l6]=(0,d.useState)(100),[l3,l4]=(0,d.useState)(null),[l8,l9]=(0,d.useState)(null),[l7,te]=(0,d.useState)(null),[tl,tt]=(0,d.useState)(null),[tn,to]=(0,d.useState)(null),[ti,tr]=(0,d.useState)(null),[ts,ta]=(0,d.useState)(!1),[td,tu]=(0,d.useState)(null),[tc,tv]=(0,d.useState)(null),[tm,tp]=(0,d.useState)(null),[th,tf]=(0,d.useState)(!1),[tx,tg]=(0,d.useState)(!1),[tb,ty]=(0,d.useState)(null),[tw,tj]=(0,d.useState)(null),[tI,tk]=(0,d.useState)({}),[tC,tA]=(0,d.useState)(!1),tN=(0,d.useRef)(!0),tE=(0,d.useRef)(!1),[tS,tL]=(0,d.useState)(null),tT=(0,d.useRef)(!0),[tP,tR]=(0,d.useState)(!1),[t_,tO]=(0,d.useState)({}),tM=(0,d.useRef)(!1),tD=(0,d.useRef)({}),[tZ,tF]=(0,w.Z)(),{selectedArtifactMsgId:tB,setSelectedArtifactMsgId:tU,streamingArtifactInfo:tz,setListOfArtifacts:tG,listOfArtifacts:tW}=(0,X.P)(e=>({selectedArtifactMsgId:e.selectedArtifactMsgId,setSelectedArtifactMsgId:e.setSelectedArtifactMsgId,streamingArtifactInfo:e.streamingArtifactInfo,setListOfArtifacts:e.setListOfArtifacts,listOfArtifacts:e.listOfArtifacts})),{selectedImage:tH,setSelectedImage:tq,editedImageMode:tV,currentImage:tK}=(0,eq.H)(e=>({selectedImage:e.selectedImage,setSelectedImage:e.setSelectedImage,editedImageMode:e.editedImageMode,setEditedImageMode:e.setEditedImageMode,currentImage:e.currentImage})),[tQ,tY]=(0,d.useState)(!1),[tJ,tX]=(0,r.PB)("sidebar"),[t$,t0]=(0,d.useState)(null),[t1,t2]=(0,d.useState)(null),[t5,t6]=(0,d.useState)([]),[t3,t4]=(0,d.useState)([]),{ignoreDeploymentUpdate:t8}=(0,U.J)(),{setSharedDocInfos:t9}=(0,Q.F)(),t7=(0,d.useRef)({}),ne=(0,d.useRef)([]),nl=(0,d.useRef)({}),{metadataUpdate:nt,setMetadataUpdate:nn,isAIEngOldFlow:no,isSearchLLM:ni,updatedHumanizeInstructions:nr,selectedToolbar:ns,setUpdatedHumanizeInstructions:na,prependMessage:nd,setRefetchListExtAppForAIEng:nu,isComputerAgent:nc,isNewChatClicked:nv,setIsNewChatClicked:nm,isComputerAgentInfoProcessing:np,setIsComputerAgentInfoProcessing:nh,setIsCentredChatInfo:nf,computerAgentInfo:nx,setComputerAgentInfo:ng,isCentredChatInfo:nb,isComputerAgentOldConvo:ny,setIsComputerAgentOldConvo:nw,isAiEngineerWorkflowPreview:nj,setIsAiEngineerWorkflowPreview:nI,dashboardEndpoint:nk,deepResearchMsgInfo:nC,setDeepResearchMsgInfo:nA,isThinkSelected:nN,computerBrowserType:nE,computerModel:nS,setPrependMessage:nL,enabledPowerPointGen:nT,csvMsgInfo:nP,setCsvMsgInfo:nR,csvDataMap:n_,setCsvDataMap:nO,showRightSidePanel:nM,setShowRightSidePanel:nD,isProcessing:nZ,setIsProcessing:nF,isRegenerateProcessing:nB,setIsRegenerateProcessing:nU,showArtifactInfo:nz,setShowArtifactInfo:nG,setLastBotResponseHadAgentUpdateNotification:nW}=(0,el.b)(e=>({metadataUpdate:e.metadataUpdate,setMetadataUpdate:e.setMetadataUpdate,isAIEngOldFlow:e.isAIEngOldFlow,isSearchLLM:e.isSearchLLM,updatedHumanizeInstructions:e.updatedHumanizeInstructions,selectedToolbar:e.selectedToolbar,setUpdatedHumanizeInstructions:e.setUpdatedHumanizeInstructions,prependMessage:e.prependMessage,setRefetchListExtAppForAIEng:e.setRefetchListExtAppForAIEng,isComputerAgent:e.isComputerAgent,isNewChatClicked:e.isNewChatClicked,setIsNewChatClicked:e.setIsNewChatClicked,isComputerAgentInfoProcessing:e.isComputerAgentInfoProcessing,setIsComputerAgentInfoProcessing:e.setIsComputerAgentInfoProcessing,setIsCentredChatInfo:e.setIsCentredChatInfo,computerAgentInfo:e.computerAgentInfo,setComputerAgentInfo:e.setComputerAgentInfo,isCentredChatInfo:e.isCentredChatInfo,isComputerAgentOldConvo:e.isComputerAgentOldConvo,setIsComputerAgentOldConvo:e.setIsComputerAgentOldConvo,isAiEngineerWorkflowPreview:e.isAiEngineerWorkflowPreview,setIsAiEngineerWorkflowPreview:e.setIsAiEngineerWorkflowPreview,dashboardEndpoint:e.dashboardEndpoint,deepResearchMsgInfo:e.deepResearchMsgInfo,setDeepResearchMsgInfo:e.setDeepResearchMsgInfo,isThinkSelected:e.isThinkSelected,computerBrowserType:e.computerBrowserType,computerModel:e.computerModel,setPrependMessage:e.setPrependMessage,enabledPowerPointGen:e.enabledPowerPointGen,csvMsgInfo:e.csvMsgInfo,setCsvMsgInfo:e.setCsvMsgInfo,csvDataMap:e.csvDataMap,setCsvDataMap:e.setCsvDataMap,showRightSidePanel:e.showRightSidePanel,setShowRightSidePanel:e.setShowRightSidePanel,isProcessing:e.isProcessing,setIsProcessing:e.setIsProcessing,isRegenerateProcessing:e.isRegenerateProcessing,setIsRegenerateProcessing:e.setIsRegenerateProcessing,showArtifactInfo:e.showArtifactInfo,setShowArtifactInfo:e.setShowArtifactInfo,setLastBotResponseHadAgentUpdateNotification:e.setLastBotResponseHadAgentUpdateNotification})),{isProcessingExecuteCode:nH,setIsProcessing:nq}=(0,ey.g)(e=>({isProcessingExecuteCode:e.isProcessingExecuteCode,setIsProcessing:e.setIsProcessing})),[nV,nK]=(0,d.useState)(null),[nQ,nY]=(0,d.useState)(null),[nJ,nX]=(0,d.useState)(!1);(0,d.useEffect)(()=>{nq(nZ)},[nZ]);let[n$,n0]=(0,r.PB)("appId"),{isDownloadPptProcessing:n1,setDownloadPptCompleted:n2,downloadPptCompleted:n5}=(0,eK.hj)(e=>({isDownloadPptProcessing:e.isDownloadPptProcessing,setDownloadPptCompleted:e.setDownloadPptCompleted,downloadPptCompleted:e.downloadPptCompleted})),[n6,n3]=(0,d.useState)(null),[n4,n8]=(0,d.useState)(),[n9,n7]=(0,d.useState)(null),[oe,ol]=(0,d.useState)(null),[ot,on]=(0,d.useState)(null),[oo,oi]=(0,d.useState)(!1),[or,os]=(0,d.useState)(!1),[oa,od]=(0,d.useState)(0),[ou,oc]=(0,r.PB)("isConversationChanged"),ov=eR&&!e0&&!ef,[om,op]=(0,d.useState)(window.innerWidth);(0,d.useEffect)(()=>{n5&&(oJ(!0),n2(!1))},[n5]),(0,d.useEffect)(()=>{nF(n1)},[n1]),(0,d.useEffect)(()=>{let e=document.getElementById("hljs-theme");e||((e=document.createElement("link")).id="hljs-theme",e.rel="stylesheet",document.head.appendChild(e)),e.href=lK?"/chatllm/staticllm/github-dark.css":"/chatllm/staticllm/github.css"},[lK]),(0,d.useEffect)(()=>{let e=e=>{op(window.innerWidth)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]);let[oh,{width:of}]=(0,y.Z)(),[ox,og]=(0,r.PB)("sideBySide"),ob="1"===ox||"showArtifact"===nz||ni&&!e_||nC||(null==nP?void 0:nP.content),[oy,ow]=(0,r.PB)("CodeLLM"),[oj,oI]=(0,r.PB)("AppLLM"),ok=eE||"1"===oj||"1"===oy||"2"===oy||la||nj,[oC,oA]=(0,d.useState)(null),oN=(0,d.useMemo)(()=>{let e=Math.min(650,Math.trunc(.4*of));return nz||tH||(null==nP?void 0:nP.content)?tB||(null==nP?void 0:nP.content)?e:e>220?e-120:e:e>400?e:null},[of,ob,tB,nz,tH,nP]),oE=(0,d.useMemo)(()=>ob&&null!=oN?oN:0,[oN,of,ob]),[oS,{width:oL}]=(0,y.Z)(),oT=(0,d.useRef)({}),[oP,{width:oR}]=(0,y.Z)(),o_=(0,d.useMemo)(()=>{let e=oR;return((e<=0||null==e)&&(e=99999),e_?ni||nC?e-=om/12*7:e-=80:nz||tH||nc||nj||(null==nP?void 0:nP.content)?e-=(oL-607<330?330:oL-607)+(600-(nc||nj?415:360)):"1"===tJ?e-=oE+310:nC?om<=1545&&om>1280?e-=500:om<=1280&&om>1120?e-=600:om<=1120&&om>980?e-=500:om<=980&&(e-=600):ni?om<=1545&&om>1280?e-=440:om<=1280&&om>1120?e-=550:om<=1120&&om>980?e-=440:om<=980&&(e-=500):la?e-=120:om<1280?e-=200:e-=320,om<1250)?Math.min(e,640):Math.min(e,735)},[om,la,oR,tH,tJ,e_,oL,607,nz,oE,oC,ni,nc,nC,nP]),oO=n$||ea,oM=ef&&lM,oD=oO===x.Z.testAiAgentAppId||oM,oZ=n$?null==eN?void 0:null===(o=eN.result)||void 0===o?void 0:null===(l=o.find(e=>(null==e?void 0:e.externalApplicationId)===n$))||void 0===l?void 0:l.name:ev,oF=(0,d.useMemo)(()=>{if(n$){var e,l,t;let n=null==eN?void 0:null===(t=eN.result)||void 0===t?void 0:null===(l=t.find(e=>(null==e?void 0:e.externalApplicationId)===n$))||void 0===l?void 0:null===(e=l.theme)||void 0===e?void 0:e[u.my0];if(n)return n}return ej},[eN,n$,ej]),oB=(0,d.useCallback)(async e=>{if(void 0==nl.current.refreshRequired||nl.current.refreshRequired){try{let e=await (0,u.l8r)({}),l=null==e?void 0:e.result,t=null==l?void 0:l.endpoint;if(!l||!t)return;nl.current={endpoint:t,token:null==l?void 0:l.token,refreshRequired:!1}}catch(e){return}setTimeout(()=>{nl.current.refreshRequired=!0,nl.current.sessionId=null},27e4)}if(!nl.current.sessionId){var l,t,n,o,i;let r=await (0,u.YpH)({method:"".concat(nl.current.endpoint,"/ensurePykernelserver"),isMethodFull:!0,extraHeaders:{Authorization:"Bearer ".concat(nl.current.token||"")},ignoreNeedLogin:!0});if(!(null==r?void 0:r.success))return;let s=null==r?void 0:null===(l=r.result)||void 0===l?void 0:l.status,a=null==r?void 0:null===(t=r.result)||void 0===t?void 0:t.sessionId;for(;"ACTIVE"!==s&&"FAILED"!==s;){await new Promise(e=>setTimeout(e,1e3));let e=await (0,u.YpH)({method:"".concat(nl.current.endpoint,"/ensurePykernelserver"),isMethodFull:!0,extraHeaders:{Authorization:"Bearer ".concat(nl.current.token||"")},ignoreNeedLogin:!0});s=null==e?void 0:null===(i=e.result)||void 0===i?void 0:i.status}if("FAILED"===s){j.Am.error("Failed to start pykernel server");return}let d=JSON.stringify(e),c=await (0,u.YpH)({method:"".concat(nl.current.endpoint,"/requestKernelSession?packageRequirements=").concat(d),isMethodFull:!0,extraHeaders:{Authorization:"Bearer ".concat(nl.current.token||"")},ignoreNeedLogin:!0});if(!(null==c?void 0:c.success)){j.Am.error("Failed to request kernel session");return}a=null==c?void 0:null===(n=c.result)||void 0===n?void 0:n.session_id;let v=null==c?void 0:null===(o=c.result)||void 0===o?void 0:o.status;for(;"active"!==v;){await new Promise(e=>setTimeout(e,1e3));let e=await (0,u.YpH)({method:"".concat(nl.current.endpoint,"/getKernelStatus?sessionId=").concat(a),isMethodFull:!0,extraHeaders:{Authorization:"Bearer ".concat(nl.current.token||"")}});v=null==e?void 0:e.result}if("FAILED"===v){j.Am.error("Failed to start kernel session");return}nl.current.sessionId=a}},[]),oU=e=>null==e?"":"object"==typeof e?JSON.stringify(e):String(e),oz=async()=>{let{unConfiguredConnectors:e,unConfiguredOrgLevelConnectors:l}=await (0,Y.Bn)(eJ);t6(e),t4(l),os(!1)};(0,d.useEffect)(()=>{var e;let l=null==eJ?void 0:null===(e=eJ.agentConfig)||void 0===e?void 0:e.AGENT_CONNECTORS,t=[];((null==l?void 0:l.hasOwnProperty("USER_LEVEL_CONNECTORS"))||(null==l?void 0:l.hasOwnProperty("ORG_LEVEL_CONNECTORS")))&&(t=null==l?void 0:l.ORG_LEVEL_CONNECTORS,l=null==l?void 0:l.USER_LEVEL_CONNECTORS),eR&&!ef&&(Object.keys(l||{}).length||(t||[]).length)&&(os(!0),oz())},[eG,eJ,eR]);let oG=e=>{let l={...e},t="";return(null==l?void 0:l.token)&&((null==l?void 0:l.streamType)==="message"||(null==l?void 0:l.isAgentReturnToken)===!0)&&(t=Array.isArray(l.token)&&l.isAgentResponseObject?l.token.reduce((e,l)=>("text"===l.type&&(e+=l.segment||""),e),oU(null==l?void 0:l.streamedData)):oU(null==l?void 0:l.streamedData)+oU(null==l?void 0:l.token)),{value:t,attachments:null}},oW=(0,r.I_)({isSelfServe:em&&oO===x.Z.aiEngAppId}),oH=(0,r.FG)({deploymentId:ei,isEnabled:ei&&oO!==x.Z.aiEngAppId&&oO!==x.Z.appLlmEndAppId}),{data:oq,isLoading:oV}=(0,d.useMemo)(()=>oO===x.Z.appLlmEndAppId?{data:null,isLoading:!1}:oO===x.Z.aiEngAppId?oW:oH,[oO,oW,oH]),oK=(0,d.useRef)(null),oQ=(0,d.useRef)(null);(0,d.useEffect)(()=>(t0(Intl.DateTimeFormat().resolvedOptions().timeZone),sessionStorage.removeItem("isCopilotProcessing"),t2(navigator.language),rV("1"===new URLSearchParams(window.location.search).get("verify-device")),()=>{nD(!1)}),[]),(0,d.useEffect)(()=>{if(nc){var e,l,t;nw(lg&&(null==oq?void 0:null===(l=oq.result)||void 0===l?void 0:null===(e=l[0])||void 0===e?void 0:e.deploymentConversationId)!==lg&&(null==oq?void 0:null===(t=oq.result)||void 0===t?void 0:t.find(e=>(null==e?void 0:e.deploymentConversationId)===lg)))}return()=>{nw(!1)}},[oq,lg,nc]),(0,d.useEffect)(()=>{let e={deploymentId:ei||null,agentId:eu||null},l=i()(e,oQ.current);null==oK.current&&(null==oQ.current||l)||(ll(!1),ln(null),tf(!1),tg(!1),tu(null),tv(null)),oQ.current={...e},oK.current=lg,ei&&!ec?(em||(0,u.RyY)({deploymentId:ei}).then(e=>{var l,t;let n=null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.filterKeyValueOptions;ll(Object.keys(null!=n?n:{}).length>0),ln(e=>{let l=null!=n?n:null;return i()(e,l)||(e=l),e}),tg((null==e?void 0:null===(t=e.result)||void 0===t?void 0:t.supportsIgnoreDocuments)==!0)}).catch(e=>{}),tf(!0)):ec&&eu&&(0,u.T80)({agentId:eu}).then(e=>{var l;let t=null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.agentExecutionConfig;ll(Object.keys(null!=t?t:{}).length>0),ln(e=>{let l=null!=t?t:null;return i()(e,l)||(e=l),e})}).catch(e=>{})},[ei,t8,ec,eu,lg,em]);let[oY,oJ]=(0,d.useState)(!1),{data:oX,error:o$,isLoading:o0,isRefetching:o1,isFetching:o2,refetch:o5,dataUpdatedAt:o6,isFetched:o3}=(0,r.Yi)({deploymentId:ei||x.Z.DummyDeploymentId,deploymentConversationId:lg,getUnusedDocumentUploads:lj!==lg&&null!=lg&&oO!==x.Z.aiEngAppId&&oO!==x.Z.appLlmEndAppId&&!ni,...eR?{filterIntermediateConversationEvents:!1}:{},refetchInterval:!!oY&&5e3}),o4=(0,d.useMemo)(()=>!lg||o3,[lg,o3]),o8=(oO===x.Z.aiEngAppId||oO===x.Z.appLlmEndAppId||oD||ei)&&lg?oX:null,[o9,o7]=(0,d.useState)([]),ie=(0,d.useRef)(!1),il=(0,d.useRef)(!1),it=(0,d.useRef)(null);(0,d.useEffect)(()=>{lg?null==lp||lp(()=>{null!=it.current&&(clearTimeout(it.current),it.current=null),oJ(!0),setTimeout(()=>{null==lk||lk.invalidateQueries({queryKey:["listConvoOne",ei||x.Z.DummyDeploymentId,lg]})},100),it.current=setTimeout(()=>{oJ(!1)},6e4)}):null==lp||lp(null)},[lk,o5,ei,lg]);let io=(0,d.useCallback)((e,l)=>{l===x.Z.aiEngAppId&&x.Z.isAIEngineerHasInfoToPreview(e,e_)?(nI(!0),nD(!0)):nI(!1)},[e_,nI]);(0,d.useEffect)(()=>{var e,l,t,n,o,i,r,s,a;(null==oX?void 0:null===(l=oX.result)||void 0===l?void 0:null===(e=l.history)||void 0===e?void 0:e.length)>0&&(oJ(!1),(null==oX?void 0:null===(r=oX.result)||void 0===r?void 0:r.chatllmTaskId)&&lk.invalidateQueries({queryKey:["task-individual",null==oX?void 0:null===(s=oX.result)||void 0===s?void 0:s.chatllmTaskId]})),ie.current=(null==oX?void 0:null===(n=oX.result)||void 0===n?void 0:null===(t=n.conversationType)||void 0===t?void 0:t.toUpperCase())==="COPILOT"||oO===x.Z.aiEngAppId,(null==oX?void 0:null===(o=oX.result)||void 0===o?void 0:o.metadata)!=null?nn((null==oX?void 0:null===(a=oX.result)||void 0===a?void 0:a.metadata)||null):nn(null),io(null==oX?void 0:null===(i=oX.result)||void 0===i?void 0:i.metadata,oO)},[oX,oO]);let ii=(0,d.useMemo)(()=>{var e;return(null==eN?void 0:null===(e=eN.result)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.externalApplicationId)===oO))!=null||oO===x.Z.aiEngAppId||oO===x.Z.appLlmEndAppId},[eN]),ir=(0,d.useMemo)(()=>{var e,l,t;return(null==eN?void 0:eN.result)!=null&&(null==eN?void 0:null===(e=eN.result)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.externalApplicationId)===oO))!=null&&!!(null==eN?void 0:null===(t=eN.result)||void 0===t?void 0:null===(l=t.find(e=>(null==e?void 0:e.externalApplicationId)===oO))||void 0===l?void 0:l.isSystemCreated)},[eN,oO]),is=(0,d.useMemo)(()=>{var e,l;return(null==eN?void 0:null===(l=eN.result)||void 0===l?void 0:null===(e=l.find(e=>(null==e?void 0:e.externalApplicationId)===oO))||void 0===e?void 0:e.description)||null},[eN,oO]),ia=(0,d.useMemo)(()=>{var e,l;return(null==eN?void 0:null===(l=eN.result)||void 0===l?void 0:null===(e=l.find(e=>(null==e?void 0:e.externalApplicationId)===oO))||void 0===e?void 0:e.onlyImageGenEnabled)||!1},[eN,oO]),{extAppName:id,hasThinkingOption:iu}=(0,d.useMemo)(()=>{var e,l,t;let n=null==eN?void 0:null===(e=eN.result)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.externalApplicationId)===oO);return{extAppName:(null==eN?void 0:null===(t=eN.result)||void 0===t?void 0:null===(l=t.find(e=>(null==e?void 0:e.externalApplicationId)===oO))||void 0===l?void 0:l.name)||null,hasThinkingOption:null==n?void 0:n.hasThinkingOption}},[eN,oO]),ic=(0,d.useRef)({}),iv=(0,d.useRef)({}),im=(0,d.useRef)({}),ip=(0,d.useRef)({});(0,d.useEffect)(()=>{(null==o8?void 0:o8.success)===!1&&(j.Am.error("Conversation Not Found!"),lb(null))},[o8]);let[ih,ix]=(0,r.PB)("isSignUp"),[ig,ib]=(0,d.useState)([]),[iy,iw]=(0,r.PB)("sideBySideTimestamp"),ij=o2&&!o8&&(!!ei||"ai_engineer"===oO)&&!!lg,iI=eX(o2&&!o8&&!!ei&&!!lg),ik=eR&&!em&&!ij&&((null==t5?void 0:t5.length)||(null==t3?void 0:t3.length));(0,d.useEffect)(()=>{(iI===(o2&&!o8&&!!ei&&!!lg)||o2&&!o8&&ei&&lg)&&lj===lg||rh()},[o2,o8,ei,lg,iI,lj,lg]);let iC=(0,d.useRef)(!1);(0,d.useEffect)(()=>{(0,eb.Uj)(10),nK(null),ic.current={},iv.current={},im.current={},ip.current={}},[oO,lg]);let iA=(0,d.useMemo)(()=>{var e;return null==oq?void 0:null===(e=oq.result)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.deploymentConversationId)===lg)},[lg,oq]),iN=(0,d.useMemo)(()=>(null==iA?void 0:iA.hasHistory)>0,[iA]),iE=(0,d.useRef)(!0),[iS,iL]=(0,d.useState)(!0),iT=(0,d.useRef)(null);(0,d.useEffect)(()=>{iT.current=lg},[lg]),(0,d.useEffect)(()=>{!nT&&(null==nd?void 0:nd.id)==="pptgen"&&(lj||ou)&&nL(null)},[lg,ou,nT]);let iP=(0,d.useRef)(null),iR=(0,d.useRef)(null);(0,d.useEffect)(()=>{iL(!1),lg!==iR.current&&null!=iR.current&&(iE.current=!0,lG(!1),ln(null),lF(null),lU(null),iP.current=null),iR.current=lg||null},[lg]);let i_=(0,d.useCallback)((e,l,t,n)=>{l9(o=>{if(o===e&&null!=l){let o={role:"BOT",text:l,uiRequestId:e};if(eD){var i;o.llmDisplayName=oZ;let e=null==oF?void 0:oF.split("/");o.llmBotIcon=e?""+(null==e?void 0:e[(null!==(i=null==e?void 0:e.length)&&void 0!==i?i:0)-1]):null}tt(o),iq("BOT",t,null!=lg?lg:n)}return o})},[eD,oZ,oF,lg]),iO=(0,d.useRef)(null),iM=(0,d.useRef)(null);(0,d.useEffect)(()=>{iM.current=lg},[lg]),(0,d.useEffect)(()=>{let e=()=>{null!=iO.current&&(clearTimeout(iO.current),iO.current=null),to(null),tt(null),l9(null),te(null),tr(null),eR&&tk({})};return e(),()=>{e()}},[lg,eR]);let iD=(0,d.useMemo)(()=>{var e,l,t;let n=null==o8?void 0:null===(e=o8.result)||void 0===e?void 0:e.history,o=null!==(t=null==n?void 0:n.length)&&void 0!==t?t:0;return null==n||0===o||(null==n?void 0:null===(l=n[o-1])||void 0===l?void 0:l.role)!=="BOT"},[o8]),iZ=(0,d.useMemo)(()=>{var e,l,t;return null!==(t=null==o8?void 0:null===(l=o8.result)||void 0===l?void 0:null===(e=l.history)||void 0===e?void 0:e.length)&&void 0!==t?t:0},[o8]),iF=(0,d.useRef)(null),iB=(0,d.useCallback)((e,l,t,o,i)=>new Promise(i=>{let r=!1;if((null==lQ?void 0:lQ[u.sWo])&&(e?(null==lQ?void 0:lQ[u.uT8])&&(r=!0):(null==lQ?void 0:lQ[u.lYl])&&(r=!0),!o&&r)){j.Am.error("Feedback Required!"),i(!1);return}(0,u.e2b)({deploymentConversationId:lg,feedback:l,isUseful:!0===e,isNotUseful:!1===e,messageIndex:t,feedbackType:o}).then(e=>{if(null==e?void 0:e.success){i(!0);let e=null==lQ?void 0:lQ[u.Pet];if(null!=e){var l,t,o;e=null!=(e=null==e?void 0:null===(l=e.trim)||void 0===l?void 0:l.call(e))&&(null==e?void 0:e.length)>0?null==e?void 0:null===(o=e.split)||void 0===o?void 0:null===(t=o.call(e,"\n"))||void 0===t?void 0:t.map((e,l)=>(0,n.jsx)("div",{children:e},"succ_line_"+l)):null}j.Am.success(e||"Feedback saved!"),null==lk||lk.invalidateQueries({queryKey:["listConvoOne",ei,lg]})}else i(!1),j.Am.error((null==e?void 0:e.error)||x.Z.errorDefault)}).catch(e=>{i(!1),j.Am.error(x.Z.isNullOrEmpty(e)?x.Z.errorDefault:""+e)})}),[lg,ei,lQ]),iU=(0,d.useCallback)(e=>{e&&(tp(l=>l=(l=[...null!=l?l:[]]).concat([e])),tv(l=>{let t=null==l?void 0:l.findIndex(l=>l===e);return t>-1&&((l=[...null!=l?l:[]]).splice(t,1),tu(e=>(e=[...null!=e?e:[]],(lg||ly)&&(0,u.FPe)({deploymentConversationId:lg||ly,docIds:[e[t].document_upload_id]}).then(K()).catch(K()),null==e||e.splice(t,1),e))),l}))},[lg,ly]),[iz,iG]=(0,r.PB)("projectId"),{mutate:iW}=(0,eH.CN)({projectId:iz}),iH=(0,d.useCallback)(async(e,l,t,n,o)=>new Promise(async(i,s)=>{try{var a,d,c,v,m,p,h;let f,x;let g=[];if(null==e||e.some(e=>{g.push(I.Z())}),l&&g.push(I.Z()),null==n||n(g),ec)f=await (0,u.kwv)({deploymentId:ei,selectedFiles:e,cbProgressUpload:e=>{null==t||t(e)}});else{let n=lg;if(!n){let e=async()=>{var e,l;if(ly)return ly;let t=await (0,u.syY)({deploymentId:ei,name:r.nS,externalApplicationId:oO});return iz&&iW({conversationId:null==t?void 0:null===(l=t.result)||void 0===l?void 0:l.deploymentConversationId}),(null==t?void 0:null===(e=t.result)||void 0===e?void 0:e.deploymentConversationId)||null};n=await e(),lw(n)}f=await (0,u.saE)({deploymentConversationId:n,deploymentId:ei,selectedFiles:e,connectorContext:l,cbProgressUpload:e=>{null==t||t(e)}})}let b=null;if(null==f?void 0:f.request_id){let e=999;do{if((null==(x=ec?await (0,u.dIr)({request_id:null==f?void 0:f.request_id}):await (0,u.LsV)({request_id:null==f?void 0:f.request_id}))?void 0:x.error)||null==x||(null==x?void 0:null===(m=x.result)||void 0===m?void 0:m.error)){b=(null==x?void 0:null===(p=x.result)||void 0===p?void 0:p.error)||null,x=null;break}await eQ(1e3),e--}while(e>0&&(null==x?void 0:x.status)!=="COMPLETED"&&(null==x?void 0:x.status)!=="CANCELED"&&(null==x?void 0:x.status)!=="SUCCESS"&&(null==x?void 0:x.status)!=="FAILED")}let y=null!==(h=null==x?void 0:null===(d=x.result)||void 0===d?void 0:null===(a=d.result)||void 0===a?void 0:a.docInfos)&&void 0!==h?h:null==x?void 0:null===(v=x.result)||void 0===v?void 0:null===(c=v.result)||void 0===c?void 0:c.docInfos;if(y){tp(e=>{let l=[...null!=g?g:[]];return null==g||g.some(t=>{(null==e?void 0:e.includes(t))&&(l=null==l?void 0:l.filter(e=>e!==t))}),(null==l?void 0:l.length)>0&&(tu(e=>e=(e=[...null!=e?e:[]]).concat(null!=y?y:[])),tv(e=>e=(e=[...null!=e?e:[]]).concat(null!=g?g:[]))),e}),i(!0);return}null==o||o(b),s()}catch(e){s()}}),[lg,ly,ei,iW,iz,ec,oO]);(0,d.useEffect)(()=>{t9(td)},[td]);let iq=(0,d.useCallback)(function(e,l,t,n){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];o?tk(e=>{var l,n,o;let i=null==e?void 0:null===(n=e[t])||void 0===n?void 0:n[(null==e?void 0:null===(l=e[t])||void 0===l?void 0:l.length)-1];return null!=i&&(null==i?void 0:null===(o=i.bot)||void 0===o?void 0:o.length)>0&&(i.bot=[]),e}):n?tk(e=>{var l;return e[t]=[...null!==(l=null==e?void 0:e[t])&&void 0!==l?l:[],{bot:[]}],e}):"USER"===e?tk(e=>{var n;return e[t]=[...null!==(n=null==e?void 0:e[t])&&void 0!==n?n:[],{user:l,bot:[]}],e}):l&&tk(e=>{var n,o,i,r,s;let a=null==e?void 0:null===(o=e[t])||void 0===o?void 0:o[(null==e?void 0:null===(n=e[t])||void 0===n?void 0:n.length)-1];return a?(null==a?void 0:null===(i=a.bot)||void 0===i?void 0:i.length)>0?null==a||null===(r=a.bot)||void 0===r||r.push(l):a.bot=[l]:eR&&(e[t]=[...null!==(s=null==e?void 0:e[t])&&void 0!==s?s:[],{bot:[l]}]),e})},[eR]),iV=e=>{let l=new URL(window.location.href),t=new URLSearchParams(l.search);if(t.has(e)){t.delete(e);let n="".concat(l.pathname,"?").concat(t.toString());window.history.replaceState({},"",n)}},iK=(0,d.useRef)(null),iQ=(0,d.useCallback)(()=>{let e=iK.current;iK.current=null,null==e||e.some(e=>{null!=e&&(e.style.minHeight="0px")})},[iK]),iY=(0,d.useRef)(null),iJ=(0,d.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||iQ();let l=document.querySelectorAll('[data-msg-last-prompt="1"]'),t=null,n=null;if(null==l||l.forEach(e=>{null==t&&(t=e,n=e);let l=null==e?void 0:e.getAttribute("data-msg-isbot");"0"===l&&(n=e),"1"===l&&(t=e)}),null==n&&null!=t&&(n=t),null!=t&&t instanceof HTMLElement&&(null==t?void 0:t.style)!=null){var o,i,r,s,a,d;let l=null==t?void 0:null===(o=t.getBoundingClientRect)||void 0===o?void 0:o.call(t),u=null==n?void 0:null===(i=n.getBoundingClientRect)||void 0===i?void 0:i.call(n);if(null!=l.top&&(null==l?void 0:l.height)!=null){e||null===(s=e4.current)||void 0===s||null===(r=s.scrollToBottom)||void 0===r||r.call(s);let l=0;if(t!==n){let e=null==u?void 0:u.height;null!=e&&(l=e)}e||(null!==(d=iK.current)&&void 0!==d||(iK.current=[]),(null===(a=iK.current)||void 0===a?void 0:a.includes(t))||iK.current.push(t)),t.style.minHeight=""+(lV-l-10)+"px",e||(setTimeout(()=>{var e,l;null===(l=e4.current)||void 0===l||null===(e=l.scrollToBottom)||void 0===e||e.call(l)},0),setTimeout(()=>{var e,l;null===(l=e4.current)||void 0===l||null===(e=l.scrollToBottom)||void 0===e||e.call(l)},300))}}},[lV,lH,e4,iQ,iY]),iX=(0,d.useRef)(iJ);(0,d.useEffect)(()=>{iX.current=iJ},[iJ]),(0,d.useEffect)(()=>{let e=iK.current;if((null==e?void 0:e.length)===1&&null!=(null==e?void 0:e[0])){var l;null===(l=iX.current)||void 0===l||l.call(iX,!0)}},[lV]);let i$=(0,d.useRef)(null),i0=(null==lQ?void 0:lQ[u.KjN+"table"])==="1",i1=(0,d.useCallback)((e,l,t,n,o,i,s,a,d,c,v,m,h,g,b,y,w,k,C,A,N,E,S,L,T,P)=>{var R,_,O;let M=null==rS?null:null!==(_=null==rS?void 0:rS.length)&&void 0!==_?_:0;return l&&M--,null!=M&&(null==rS?void 0:null===(O=rS[M])||void 0===O?void 0:O.role)==="BOT"&&M--,M<0&&(M=null),i$.current=M,null===(R=e4.current)||void 0===R||R.scrollToBottom(),document.querySelector(".messages-container")&&setTimeout(()=>{var e;null===(e=e3.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})},800),new Promise(R=>{var _;let O=!!l;e=null==e?void 0:e.trim();let M=!1,D=null;if(ec){if(eR){if(s)D={keywordArgs:a,agentWorkflowNodeId:d,actionLabel:L};else{let{keywordArgs:l,agentWorkflowNodeId:n}=Y.ri.getKeywordArgsFromUserInput(eU,{text:e,docInfos:O?t:td,nodeName:null});D={keywordArgs:l,agentWorkflowNodeId:n}}}let l=O?t:td;null==l||(null==l?void 0:l.length)===0||(M=!0)}let Z=sessionStorage.getItem("projectId"),F=sessionStorage.getItem("whiteboard"),B="1"===sessionStorage.getItem("whiteboardNoData");if(!e&&!M&&!o&&!s&&!Z&&oO!==x.Z.testAiAgentAppId&&!oM){j.Am.error("Text can't be empty!"),R(!1);return}let U=null!=T?T:lg,z=!U;tr(null);let G=e=>{null==lk||lk.invalidateQueries({queryKey:["listConvoOne",ei||x.Z.DummyDeploymentId,U]}).then(()=>{e&&tk(e=>(e[U]=[],e))})},W=l=>{if((!o||iD)&&(!0===iD||z)&&(r.nS===(null==iA?void 0:iA.name)||r.be===(null==iA?void 0:iA.name)||z)){var t,n;let l=null==e?void 0:null===(n=e.replace(/"/g,"'"))||void 0===n?void 0:null===(t=n.replace(/[\r\n\t]/g,". "))||void 0===t?void 0:t.slice(0,200);(0,u.uuw)({deploymentConversationId:U,userMessage:ov?JSON.stringify(a||{}):l||null}).then(e=>{(null==e?void 0:e.success)?(null==lk||lk.invalidateQueries({queryKey:["listConvos",ei]}),ew&&lk.invalidateQueries({queryKey:["listCopilotConvos"]}),iz&&(null==lk||lk.invalidateQueries({queryKey:["project-conversations",iz]}))):j.Am.error((null==e?void 0:e.error)||x.Z.errorDefault)}).catch(e=>{j.Am.error(x.Z.isNullOrEmpty(e)?x.Z.errorDefault:""+e)})}},H=e=>{if(eR){let l=x.Z.tryJsonParse(e);if((null==l?void 0:l.ping)!=null)return{value:null};if((null==l?void 0:l.request_retry)===!0||(null==l?void 0:l.requestRetry)===!0)return{isRetry:!0};if((null==l?void 0:l.type)==="code"&&(null==l?void 0:l.artifactMetadata)&&setTimeout(()=>{tY(!0)},250),(null==l?void 0:l.end)===!0)return(null==l?void 0:l.success)===!1&&(null==l?void 0:l.error)?{value:null,end:!0,error:null==l?void 0:l.error,message:l}:{value:null,end:!0};if((null==l?void 0:l.success)===!1)return{error:(null==l?void 0:l.error)||"Error"};let{value:t,attachments:n}=oG(x.Z.tryJsonParse(e));return{value:t,attachments:n,message:l}}if(null==e)return{value:""};{let a=x.Z.tryJsonParse(e);if(null!=a){var l,t,n,o,i,r,s;if((null==a?void 0:a.ping)!=null)return{value:null};if((null==a?void 0:a.type)==="limit_exceeded"||(null==a?void 0:a.type)==="no_usage_points"||(null==a?void 0:a.type)==="compute_point_budgeting")return{value:"",messageId:null==a?void 0:a.messageId,limitType:null==a?void 0:a.type,suggestedLlms:null==a?void 0:a.suggestedLlms,percentUsed:null==a?void 0:a.percentUsed,otherUsageType:null==a?void 0:a.otherUsageType};if(["saved_instance","file_write","terminal_command"].includes(null==a?void 0:a.type))return{value:"",message:a,messageId:null==a?void 0:a.messageId};if((null==a?void 0:a.type)==="image_gen")return{value:"",imageGen:!0,messageId:null==a?void 0:a.messageId};if((null==a?void 0:a.isRunningResearch)&&!e_&&(nA({segmentMsgId:(null==a?void 0:a.message_id)||(null==a?void 0:a.messageId),botMsgId:iZ+1}),nG(""),nR(null),tU(null),tY(!1),tq(null),nD(!1)),(null==a?void 0:a.type)==="code"&&(null==a?void 0:a.artifactMetadata)&&setTimeout(()=>{tU((null==a?void 0:a.message_id)||(null==a?void 0:a.messageId)),tY(!0),nA(null),nR(null),tq(null),nD(!0)},250),null==a?void 0:a.request_switch)return{isRequestSwitch:!0,newAppId:a.new_application_id,value:null==a?void 0:a.error};if((null==a?void 0:a.request_retry)===!0||(null==a?void 0:a.requestRetry)===!0)return{isRetry:!0};let e=null!==(l=x.Z.tryParseFloat(null==a?void 0:a.responseVersion))&&void 0!==l?l:null;if((a.isGeneratingImage||a.isExecutingCode)&&tj({isGeneratingImage:a.isGeneratingImage,isRegenerate:O,isExecutingCode:a.isExecutingCode,genImageBtnText:"Redo without image generation",executeCodeBtnText:"Stop code execution"}),(null==a?void 0:a.type)==="metadata_update"&&nn(a.updates),"refresh_external_apps"===a.type&&nu(!0),(null==a?void 0:a.segment)!=null||(null==a?void 0:a.type)==="table")return{value:(null==a?void 0:a.type)==="table"?null==a?void 0:a.text:null==a?void 0:a.segment,message:a,messageId:null==a?void 0:a.messageId};if((null==a?void 0:a.type)==="attachments"){let e=null==a?void 0:a.attachments,l=null==e?void 0:e.find(e=>{var l,t;return"text/csv"===e.mime_type&&(null==e?void 0:null===(t=e.filename)||void 0===t?void 0:null===(l=t.toLowerCase())||void 0===l?void 0:l.includes(".csv"))});return l&&(nR({isStreaming:!0,attachmentInfo:l,attachmentId:null==l?void 0:l.attachment_id}),nD(!0)),{value:"attachment",message:a,messageId:null==a?void 0:a.messageId}}if((null==a?void 0:a.token)!=null){if(e>=2){if(f()(null==a?void 0:a.token))return{value:(null==a?void 0:a.token)||"",messageId:null==a?void 0:a.messageId};{let e=null==a?void 0:a.token,l=(null==a?void 0:a.streamed_data)||"",o=p()(e)?null==e?void 0:e.filter(e=>(null==e?void 0:e.type)==="text"):null,i=null!==(n=null==a?void 0:a.attachments)&&void 0!==n?n:null;return{value:(l+=null==o?void 0:null===(t=o.map(e=>null==e?void 0:e.contents))||void 0===t?void 0:t.join(""))||"",attachments:i,messageId:null==a?void 0:a.messageId}}}return(null==a?void 0:null===(o=a.token)||void 0===o?void 0:o.attachments)!=null?{value:(null==a?void 0:null===(i=a.token)||void 0===i?void 0:i.message)||"",attachments:null!==(s=null==a?void 0:null===(r=a.token)||void 0===r?void 0:r.attachments)&&void 0!==s?s:null,messageId:null==a?void 0:a.messageId}:{value:(null==a?void 0:a.token)||"",messageId:null==a?void 0:a.messageId}}if((null==a?void 0:a.end)===!0)return(null==a?void 0:a.success)===!1&&(null==a?void 0:a.error)?{value:null,end:!0,error:null==a?void 0:a.error,message:a,messageId:null==a?void 0:a.messageId}:{value:null,end:!0,messageId:null==a?void 0:a.messageId};if((null==a?void 0:a.success)===!1)return{error:(null==a?void 0:a.error)||"Error",message:a,messageId:null==a?void 0:a.messageId}}return{value:""}}},q=(e,l)=>{let t={type:e,from:"EMBEDDED_CHATWEB",to:"PLATFORM",...l};window.parent.postMessage(t,"*")},V=async function(n,r){var a,p,f;let L=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T={doStop:null};iF.current=T;let _=iM.current,M=I.Z();if(l9(M),o||s){if(o){if(O){let e=null==tI?void 0:tI[lg];(null==e?void 0:null===(a=e[(null==e?void 0:e.length)-1])||void 0===a?void 0:a.bot)?(tI[lg][(null==e?void 0:e.length)-1].bot=[],tk(tI)):tk(e=>{var l;return e[lg]=[...null!==(l=null==e?void 0:e[lg])&&void 0!==l?l:[],{bot:[]}],e})}else to({role:"USER",text:e,uiRequestId:M+"_read",docInfos:td||null,isClickable:!1}),iq("USER",{role:"USER",text:e,uiRequestId:M+"_read",docInfos:td||null,isClickable:!1,...eR?{keywordArguments:null==D?void 0:D.keywordArgs,agentWorkflowNodeId:null==D?void 0:D.agentWorkflowNodeId}:{}},U,O)}}else to({role:"USER",text:e,uiRequestId:M+"_read",docInfos:td||null,isClickable:!1}),iq("USER",{role:"USER",text:e,uiRequestId:M+"_read",docInfos:td||null,isClickable:!1,...eR?{keywordArguments:null==D?void 0:D.keywordArgs,agentWorkflowNodeId:null==D?void 0:D.agentWorkflowNodeId}:{}},U,O);setTimeout(()=>{var e;null===(e=iX.current)||void 0===e||e.call(iX)},0);let z=null,K=!0,Q=!1,Y=e=>{Q=!0,iF.current=null,!0!==e&&(l9(null),tt(null),to(null),te(null)),null!=e&&(tu(null),tv(null),setTimeout(()=>{null==r||r(e),R(e)},30))},J=!1;if(setTimeout(()=>{setTimeout(()=>{J||Q||null==i_||i_(M," ",null)},300)},300),ec){let l=e1,i=null;oD&&(l=u.Y2Y,q("CURRENT_AGENT_NODE",{agentUserMessageInfo:D}),await oB(null==eJ?void 0:null===(f=eJ.agentConfig)||void 0===f?void 0:f.packageRequirements),i=nl.current.sessionId),l({deploymentConversationId:U,deploymentId:ei,...oD?{agentId:null==eJ?void 0:eJ.agentId,workflowGraph:null==eJ?void 0:eJ.workflowGraph,agentInterface:null==eJ?void 0:null===(p=eJ.agentConfig)||void 0===p?void 0:p.AGENT_INTERFACE,pykernelSessionId:i,agentWorkflowNodeId:d}:{},...eR?{keyword_arguments:null==D?void 0:D.keywordArgs,agentWorkflowNodeId:null==D?void 0:D.agentWorkflowNodeId,actionLabel:null==D?void 0:D.actionLabel}:{message:e,docInfos:O?t:td},regenerate:O,isRetry:L,filterKeyValues:n,forceRequestIt:o,cbStop:T,isComplexAgent:eR,orgHost:eA,cbProgress:e=>{var l,t,i;if(Q)return;K&&(K=!1),setTimeout(()=>{var e;null===(e=iX.current)||void 0===e||e.call(iX)},30);let s=H(null==e?void 0:e.data);if(oD&&(null==s?void 0:s.message)&&q("AGENT_PROGRESS",{message:null==s?void 0:s.message}),null==s?void 0:s.isRequestSwitch){(null==s?void 0:s.value)&&j.Am.success(null==s?void 0:s.value),tL(s.newAppId),null==T||null===(l=T.doStop)||void 0===l||l.call(T);return}if((null==s?void 0:s.isRetry)&&!L){o=I.Z(),O=!0,iC.current=!0,to(null),tt(null),l9(null),te(null),V(n,r,!0);return}if(null==s?void 0:s.error){tr(""+et.O+(null==s?void 0:s.error)),iq("BOT",s.message,U),null==T||null===(t=T.doStop)||void 0===t||t.call(T),eR&&(null==lk||lk.invalidateQueries({queryKey:["listConvos",ei]}).finally(()=>{te(null)}),G(!0));return}(null==s?void 0:s.value)!=null&&(null!=z||(z=""),z+=null!==(i=null==s?void 0:s.value)&&void 0!==i?i:""),(null==s?void 0:s.end)===!0&&(null==s?void 0:s.value)==null?(to(null),tt(null),l9(null),null==lk||lk.invalidateQueries({queryKey:["listConvos",ei]}).finally(()=>{te(null)}),iz&&(null==lk||lk.invalidateQueries({queryKey:["project-conversations",iz]})),G(),tA(!0)):(J=!0,null==i_||i_(M,null!=z?z:"",s.message,U))},cbFinish:e=>{l9(null),e&&(G(),tA(!0))}}).then(e=>{_===iM.current&&(Q=!0,q("EXECUTION_FINISHED",{}),J&&null!=z||(iC.current=!0,to(null),tt(null),l9(null),te(null)),null==r||r(!0),Y(!0),W(null!=z?z:""))}).catch(e=>{_===iM.current&&(Q=!0,q("EXECUTION_FINISHED",{}),null==lk||lk.invalidateQueries({queryKey:["listConvos",ei]}),iz&&(null==lk||lk.invalidateQueries({queryKey:["project-conversations",iz]})),G(),tA(!0),tk({}),j.Am.error(x.Z.isNullOrEmpty(e)?x.Z.errorDefault:""+e),null==r||r(!1),Y(!1))})}else{let s=null;if(i0&&(null!=s||(s={}),s["HIDE_DATA_TABLES".toLowerCase()]=!0),(null==td?void 0:td.length)>0){let e=td.filter(e=>e.isPersistenceFile).map(e=>e.document_upload_id);(null==e?void 0:e.length)>0&&!e7.current?(0,u.omf)({deploymentConversationId:U,docIds:e}).then(e=>{e7.current=!0,(null==e?void 0:e.success)&&(0,u.E1K)({deploymentConversationId:U}).then(e=>{})}):(0,u.E1K)({deploymentConversationId:U}).then(e=>{})}if(!lg&&(null==tb?void 0:tb.length)>0){let e=tb.map(e=>e.document_upload_id);e&&(0,u.omf)({deploymentConversationId:U,docIds:e}).then(e=>{(null==e?void 0:e.success)&&(0,u.E1K)({deploymentConversationId:U}).then(e=>{})})}t$&&(null!=s||(s={}),s.timezone=t$),t1&&(null!=s||(s={}),s.language=t1);let a=!1,d=!1;(0,u.lEE)({externalApplicationId:oO,deploymentConversationId:U,message:e,chatConfig:s,docInfos:O?t:tb?[...null!=td?td:[],...tb]:td,filterKeyValues:n,extAppPredictionOverrides:ez,regenerate:O,allowSwitch:y,isRetry:L,cbStop:T,orgHost:eA,forceRequestIt:o,disableImageGeneration:i,aiAssistedEditAgentAppId:E,aiAssistedAgentProjectId:w,aiAssistedChatbotProjectId:S,regenerateLLM:k,cbProgress:t=>{var i,s,u,c,v,m,p;if(Q)return;K&&(K=!1,O&&te(l));let h=H(null==t?void 0:t.data);if((null==h?void 0:h.limitType)&&em&&(a=!0,n3(h.limitType),n7(null==h?void 0:h.suggestedLlms),ol(null==h?void 0:h.percentUsed),on(null==h?void 0:h.otherUsageType)),(null==h?void 0:h.imageGen)&&(d=!0,n8(e),oi(!0)),null==h?void 0:h.isRequestSwitch){if(a)return;!y&&(null==h?void 0:h.value)&&j.Am.success(null==h?void 0:h.value),tL(h.newAppId),null==T||null===(s=T.doStop)||void 0===s||s.call(T);return}if((null==h?void 0:h.isRetry)&&!L){o=I.Z(),O=!0,iC.current=!0,to(null),tt(null),l9(null),te(null),V(n,r,!0);return}if(null==h?void 0:h.error){if(d&&(null==h?void 0:null===(c=h.error)||void 0===c?void 0:null===(u=c.toLowerCase())||void 0===u?void 0:u.includes("image"))||a&&(null==h?void 0:null===(v=h.error)||void 0===v?void 0:v.includes("switch")))return;tr(""+et.O+(null==h?void 0:h.error)),iq("BOT",h.message,U),null==T||null===(m=T.doStop)||void 0===m||m.call(T);return}(null==h?void 0:h.value)!=null&&(null!=z||(z=""),((null==z?void 0:z.includes('className="shimmer dark:shimmerDark pointer-events-none"'))||(null==z?void 0:z.includes('className="shimmer dark:shimmerDark pointer-events-none temp"')))&&(null==(z=z.replace('className="shimmer dark:shimmerDark pointer-events-none"',""))?void 0:z.includes('className="shimmer dark:shimmerDark pointer-events-none temp"'))&&(z=""),z+=null!==(p=null==h?void 0:h.value)&&void 0!==p?p:""),(null==h?void 0:null===(i=h.message)||void 0===i?void 0:i.message_id)&&!il.current&&(ew&&lk.invalidateQueries({queryKey:["listCopilotConvos"]}),il.current=!0),(null==h?void 0:h.end)===!0&&(null==h?void 0:h.value)==null?(tT.current&&to(null),tt(null),l9(null),null==lk||lk.invalidateQueries({queryKey:["listConvos",ei]}),iz&&(null==lk||lk.invalidateQueries({queryKey:["project-conversations",iz]})),ew&&lk.invalidateQueries({queryKey:["listCopilotConvos"]}),il.current=!1,G(),tA(!0)):(J=!0,null==i_||i_(M,null!=z?z:"",h.message,U))},cbFinish:e=>{l9(null),e&&(G(),tA(!0))},humanizeInstructions:c||((null==nd?void 0:nd.id)==="humanize"?null==nr?void 0:nr.humanizeInstructions:null),saveHumanizeInstructionsToConversation:v||((null==nd?void 0:nd.id)==="humanize"?null==nr?void 0:nr.saveHumanizeInstructionsToConversation:null),editPrompt:m,whiteboard:F,projectId:Z,isCopilot:no?ie.current:oO===x.Z.aiEngAppId,isCopilotNoData:B,isFormResponse:h,formResponse:g,videoGenFormInfo:b,imageGenFormInfo:C,forceRoutingAction:C?"IMAGE_GEN":O?A:ns,isDesktop:!e_,computerId:nc?null==nx?void 0:nx.computerId:null,verifyResponse:!!N||null,useThinking:nN,browserType:nc?nE:null,computerModel:nc?eT?nS:"v3.7":null,reconnect:!!P||null}).then(e=>{_===iM.current&&(Q=!0,J&&null!=z||(iC.current=!0,tT.current&&to(null),tt(null),l9(null),te(null)),null==r||r(!0),Y(!0),W(null!=z?z:""))}).catch(e=>{_===iM.current&&(en.Tb(e),Q=!0,null==lk||lk.invalidateQueries({queryKey:["listConvos",ei]}),iz&&(null==lk||lk.invalidateQueries({queryKey:["project-conversations",iz]})),ew&&lk.invalidateQueries({queryKey:["listCopilotConvos"]}),il.current=!1,G(),tA(!0),tk({}),iF.current&&(null==rl||rl()),j.Am.error(x.Z.isNullOrEmpty(e)?x.Z.errorDefault:""+e),null==r||r(!1),Y(!1))}).finally(()=>{sessionStorage.removeItem("projectId"),sessionStorage.removeItem("aiEngInitialPrompt"),sessionStorage.removeItem("whiteboard"),sessionStorage.removeItem("hotkeyMessage"),sessionStorage.removeItem("whiteboardNoData"),iV("aiAssistedEditAgentAppId"),iV("assistedAgentProjectId"),iV("assistedChatbotProjectId")})}};_=e=>{if(ec&&e&&Object.keys(null!=e?e:{}).some(l=>{let t=null==e?void 0:e[l];null!=t&&(null==t?void 0:t.length)>0&&p()(t)&&(e[l]=t[0])}),U)null==n||n(),V(e);else{if(o)return;(async()=>{var e,l;if(ly)return lw(void 0),ly;let t=await (0,u.syY)({deploymentId:ei,name:nc?r.be:r.nS,externalApplicationId:oO,...oD?{conversationType:"WORKFLOW_AGENT"}:ec&&lM&&eo.featureFlags.allowTestAgentConversationType?{conversationType:x.Z.testAgentConversationType}:{}});return iz&&iW({conversationId:null==t?void 0:null===(l=t.result)||void 0===l?void 0:l.deploymentConversationId}),(null==t?void 0:null===(e=t.result)||void 0===e?void 0:e.deploymentConversationId)||null})().then(l=>{if(U=l){if((null==td?void 0:td.length)>0){let e=td.filter(e=>!e.isPersistenceFile).map(e=>e.document_upload_id);(null==e?void 0:e.length)>0&&(0,u.omf)({deploymentConversationId:U,docIds:e}).then(K()).catch(K())}lb(U),setTimeout(()=>{null==n||n()},200),setTimeout(()=>{V(e,e=>{})},100)}}).catch(e=>{j.Am.error(x.Z.isNullOrEmpty(e)?x.Z.errorDefault:""+e)})}},lF(e=>{let l=Object.keys(null!=e?e:{}),t=null;return l.some(l=>{if((null==e?void 0:e[l])===!0){let e=null==l?void 0:l.split(l2);if((null==e?void 0:e.length)>=2){null!=t||(t={});let l=t[e[0]];null==l?t[e[0]]=[e[1]]:l.push(e[1])}}}),_(t),e})})},[lg,iq,e4,ez,i0,ec,lk,iA,i_,iD,ei,td,eU,e3.current,tI,tb,eR,ie.current,no,nr,em,ns,ly,nd,lP,l_,ov,nx,nc,iZ,lL,nN,nE,nS,iz,iW,lM]),i2=(0,d.useRef)(!1);(0,d.useEffect)(()=>{if(!i2.current&&oD&&ef){var e;i2.current=!0,null===(e=i1("",null,null,()=>{nF(!0)},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null))||void 0===e||e.finally(()=>{nF(!1)})}},[oD,ef,i1]),(0,d.useEffect)(()=>{if(lL&&!lI.current&&!lg){var e;lI.current=!0,null===(e=i1(x.Z.AIAssistedEditAgentPrompt,null,null,()=>{nF(!0)},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,lL))||void 0===e||e.finally(()=>{nF(!1)})}},[lL,lg]),(0,d.useEffect)(()=>{if(lP&&!lI.current&&!lg){var e;lI.current=!0,null===(e=i1(x.Z.AIAssistedAgentPrompt,null,null,()=>{nF(!0)},null,null,null,null,null,null,null,null,null,null,null,null,lP))||void 0===e||e.finally(()=>{nF(!1)})}},[lP,lg]),(0,d.useEffect)(()=>{if(l_&&!lI.current&&!lg){var e;lI.current=!0,null===(e=i1(x.Z.AIAssistedChatbotPrompt,null,null,()=>{nF(!0)},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,l_))||void 0===e||e.finally(()=>{nF(!1)})}},[l_,lg]);let i5=e=>{let l=(null==tI?void 0:tI[lg])||[],t=[];return l.forEach((l,n)=>{let{bot:o,user:i}=l;if(i){if(Object.keys((null==i?void 0:i.keywordArguments)||{}).length>0)t.push(Y.ri.convertKeywordArgsToUserInputs(i,eU,e0)||{});else if((null==i?void 0:i.type)==="agent_form"){let l=(0,Y.Pw)((null==i?void 0:i.nodeInfo)||{},e);i.formData=l||{},t.push(i)}}if((null==o?void 0:o.length)>0){let e=Y.ri.convertWSMessagesToConversationHistoryObject(q()(o),eU);t.push(e)}else tM.current||t.push({role:"BOT",text:" ",uiRequestId:null!=l8?l8:-1})}),t},i6=(0,d.useCallback)(e=>{var l;null==tI||null===(l=tI[lg])||void 0===l||l.forEach(l=>{let{bot:t,user:n}=l;if(n&&e.push({role:"USER",...n||{}}),t){let l=[],n=null;for(let e=0;e<(null==t?void 0:t.length);e++){let x=q()(t[e]);if(null!=x){if(0===e){if(l.push(x),(null==x?void 0:x.error)&&(null==x?void 0:x.success)===!1){n=x;break}}else{var o,i,r,s,a,d,u,c,v,m,p,h;let e=!!(null===(o=l[l.length-1])||void 0===o?void 0:o.messageId)&&!!(null==x?void 0:x.messageId)&&(null===(i=l[l.length-1])||void 0===i?void 0:i.messageId)===(null==x?void 0:x.messageId);(null===(r=l[l.length-1])||void 0===r?void 0:r.messageId)||(null==x?void 0:x.messageId)||(e=!0);let t=!(null===(s=l[l.length-1])||void 0===s?void 0:s.isSpinny)&&(null===(d=l[l.length-1])||void 0===d?void 0:null===(a=d.segment)||void 0===a?void 0:a.type)==="text"&&(null===(u=l[l.length-1])||void 0===u?void 0:u.type)==="collapsible_component"&&(null==x?void 0:x.type)==="text"&&!(null==x?void 0:x.isSpinny),g=(null===(c=l[l.length-1])||void 0===c?void 0:c.type)==="text"&&!(null===(v=l[l.length-1])||void 0===v?void 0:v.isSpinny)&&"text"===x.type&&!(null==x?void 0:x.isSpinny);if(t&&e)(null==l?void 0:null===(m=l[l.length-1])||void 0===m?void 0:m.segment)!=null&&(null!==(h=(p=l[l.length-1].segment).segment)&&void 0!==h||(p.segment=""),f()(null==x?void 0:x.segment)&&(l[l.length-1].segment.segment+=x.segment));else if(g&&e)f()(null==x?void 0:x.segment)&&(l[l.length-1].segment+=x.segment);else if((null==x?void 0:x.error)&&(null==x?void 0:x.success)===!1){n=x;break}else l.push(x)}}}n?e.push({role:"BOT",text:et.O+(n.error||"Error")}):e.push({role:"BOT",segments:l,text:t.length>0?"   ":null,uiRequestId:null!=l8?l8:-1})}})},[tI,l8,lg]);(0,d.useEffect)(()=>{tC&&!o1&&(te(null),tA(!1),tk({}),tN.current=!1,setTimeout(()=>{tN.current=!0,tE.current=!1},250))},[tC,o8,o1,lg,eR]);let i3=(0,d.useMemo)(()=>{var e;return(null==o8?void 0:null===(e=o8.result)||void 0===e?void 0:e.humanizeInstructions)||{}},[o8]);(0,d.useEffect)(()=>{var e;na({humanizeInstructions:(null==o8?void 0:null===(e=o8.result)||void 0===e?void 0:e.humanizeInstructions)||{},saveHumanizeInstructionsToConversation:!0})},[o8]);let i4=(0,d.useRef)(null),i8=Object.keys(tI||{}).length>0;(0,d.useEffect)(()=>{var e,l,t;if(eR&&(null==o8?void 0:null===(l=o8.result)||void 0===l?void 0:null===(e=l.history)||void 0===e?void 0:e.length)>0){let{shouldRefreshConversation:e}=Y.ri.handleConversationBasedOnWorkflowStatus(eU,null==o8?void 0:null===(t=o8.result)||void 0===t?void 0:t.history);e&&(nF(!0),setTimeout(()=>{o5().finally(()=>{nF(!1)})},1500))}},[eR,o8,o5,o6]),(0,d.useEffect)(()=>{var e,l,t,n,o;let r=null!==(l=q()(null==o8?void 0:null===(e=o8.result)||void 0===e?void 0:e.history))&&void 0!==l?l:[],s={};if(eR){r=Y.ri.addRunContextId(r,eU),ne.current=r;let e=Y.ri.getLastWorkflowRunFromConversationHistory(r,eU);s=(0,Y.Z6)(e,eU,e0),tD.current=s;let{hasFrom:l,formConfig:t}=function(e){let{nextAgentWorkflowNodeId:l,runContextId:t}=(null==e?void 0:e[(null==e?void 0:e.length)-1])||{};if(!eR||ef||"string"!=typeof l||""===l)return{hasFrom:!1};{var n,o,i,r;let e=null==eU?void 0:eU.nodes,s=(0,Y.Lw)(e,l),a=(null==s?void 0:null===(n=s.input_schema)||void 0===n?void 0:n.json_schema)||{};return(null==s?void 0:null===(o=s.input_schema)||void 0===o?void 0:o.runtime_schema)||(null===(i=Object.keys((null==a?void 0:a.properties)||{}))||void 0===i?void 0:i.length)!==0?{hasFrom:!0,formConfig:{type:"agent_form",agentWorkflowNodeId:l,runContextId:t,nodeInfo:s,json_schema:a,ui_schema:(null==s?void 0:null===(r=s.input_schema)||void 0===r?void 0:r.ui_schema)||{},role:"USER",messageId:l+"_"+Y.lQ}}:{hasForm:!1}}}(r);if(r=Y.ri.segregateBotResponsesByUserQuery(r,eU,e0),l&&!l7){let e=(0,Y.Pw)((null==t?void 0:t.nodeInfo)||{},s);t.formData=e||{},r.push(t)}}else null!=r&&(r=[...null!=r?r:[]],(nZ||tC)&&(null==r?void 0:r.length)>0&&(null==r?void 0:null===(t=r[r.length-1])||void 0===t?void 0:t.role)==="USER"&&r.splice(r.length-1,1),r=r.map((e,l)=>{var t,n,o,i;if(e={...e},(null!==(t=x.Z.tryParseFloat(null==e?void 0:e.responseVersion))&&void 0!==t?t:null)>=2){let l=x.Z.tryJsonParse(null==e?void 0:e.text);if(e.text="",null!=l&&(null==l?void 0:l.streamed_data)!=null&&f()(null==l?void 0:l.streamed_data)&&(null==l?void 0:null===(n=l.streamed_data)||void 0===n?void 0:n.length)>0&&(e.text+=(null==l?void 0:l.streamed_data)||""),null!=l&&(null==l?void 0:l.result)!=null&&f()(null==l?void 0:l.result)&&(e.text+=(null==l?void 0:l.result)||""),null!=l&&(null==l?void 0:l.result)!=null&&p()(null==l?void 0:l.result)){let t=null==l?void 0:null===(o=l.result)||void 0===o?void 0:o.filter(e=>(null==e?void 0:e.type)==="text"),n=null==t?void 0:null===(i=t.map(e=>(null==e?void 0:e.contents)||""))||void 0===i?void 0:i.join("");e.text+=n||""}}return e}));if(iC.current&&(iC.current=!1,null==r||r.splice((null!==(n=null==r?void 0:r.length)&&void 0!==n?n:0)-1,1),setTimeout(()=>{var e;null===(e=iX.current)||void 0===e||e.call(iX)},200)),l7){if(eR&&ov){let e=null==r?void 0:r.findIndex(e=>(null==e?void 0:e.timestamp)===l7&&(null==e?void 0:e.role)==="BOT");e>-1&&(null==r||r.splice(e))}else r=null==r?void 0:r.filter(e=>(null==e?void 0:e.timestamp)!==l7)}if(i8&&tN.current){if(eR){let e=i5(s);e.length>0&&(null==r||r.push(...e))}else i6(r)}if(null==r)i4.current=null;else if(null!=r||(r=[]),null==i4.current)i4.current=r;else if((null==r?void 0:r.length)===0)i4.current=r;else{let e=!1;null==r||r.some((l,t)=>{var n,o,s;if(t>=(null===(n=i4.current)||void 0===n?void 0:n.length))return e=!0,!0;i()(l,null===(o=i4.current)||void 0===o?void 0:o[t])?r[t]=null===(s=i4.current)||void 0===s?void 0:s[t]:e=!0}),null!=r&&null!=i4.current&&(null==r?void 0:r.length)<(null===(o=i4.current)||void 0===o?void 0:o.length)&&(e=!0),e?i4.current=r:r=i4.current}o7(i4.current)},[o8,ti,tl,tn,l7,iC.current,i8,tC,o1,eU,tN.current,nZ]),(0,d.useEffect)(()=>{la&&(null==lm||lm(o9))},[o9,lm,la]),(0,d.useEffect)(()=>{la&&lu(nZ)},[la,nZ]);let i9=(0,d.useCallback)(()=>{let e=Y.ri.getFormConfigObjectFromNodeName(eU,null==eU?void 0:eU.primary_start_node,null);(null==e?void 0:e.hasFrom)?(e.formConfig.formData={},i4.current=[null==e?void 0:e.formConfig],o7(i4.current)):j.Am.error("No form config found for primary start node: ".concat(null==eU?void 0:eU.primary_start_node))},[eU]),i7=null==i4.current;(0,d.useEffect)(()=>{if(o3&&0===Object.keys(tI).length){var e,l,t,n;let o=null==oX?void 0:null===(n=oX.result)||void 0===n?void 0:null===(t=n.history)||void 0===t?void 0:t[(null==oX?void 0:null===(l=oX.result)||void 0===l?void 0:null===(e=l.history)||void 0===e?void 0:e.length)-1];o&&(0,u.R59)({deploymentConversationId:lg}).then(e=>{var l;(null==e?void 0:e.success)&&(null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.requestId)&&((null==o?void 0:o.role)==="BOT"&&(te(null==o?void 0:o.timestamp),nU(!0)),nF(!0),i1((null==o?void 0:o.role)==="USER"?null==o?void 0:o.text:null,(null==o?void 0:o.role)==="BOT"?null==o?void 0:o.timestamp:null,void 0,void 0,e.result.requestId,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0).then(()=>{nF(!1),nU(!1)}).catch(()=>{nF(!1),nU(!1)}))})}},[lg,o3]),(0,d.useEffect)(()=>{!i7&&(o2||nZ||!lg||!ov||(null==o9?void 0:o9.length)!==0||or||i9())},[lg,i7,ov,o9,o2,nZ,or]),(0,d.useEffect)(()=>{!i7&&(lg||!ov||or||i9())},[ov,i7,lg,or]);let re=(0,d.useMemo)(()=>{let e=null==o9?null:[];return null==o9||o9.some((l,t)=>{if(null!=l&&(null==l?void 0:l.error)&&!(null==l?void 0:l.uiRequestId)){if(null==l?void 0:l.text){e.push(l),e.push({role:"BOT",text:et.O+((null==l?void 0:l.error)||"Error")});return}l.text=et.O+(l.error||"Error"),e.push(l);return}e.push(l)}),e},[o9,ti]);(0,d.useEffect)(()=>{var e,l,t;let n=null!==(l=null==re?void 0:null===(e=re.filter(e=>(null==e?void 0:e.role)==="BOT"))||void 0===e?void 0:e.reduce((e,l)=>((null==l?void 0:l.segments)&&e.push(...l.segments),e),[]))&&void 0!==l?l:[];tG(null!==(t=null==n?void 0:n.filter(e=>null==e?void 0:e.artifactMetadata))&&void 0!==t?t:[])},[re]);let rl=(0,d.useCallback)(async e=>{var l,t,n;if(await (null===(t=iF.current)||void 0===t?void 0:null===(l=t.doStop)||void 0===l?void 0:l.call(t)),iC.current=!0,il.current=!1,tt(null),to(null),te(null),null==e?void 0:e.isGeneratingImage){l9(null);let e=null==tI?void 0:tI[lg];(null==e?void 0:null===(n=e[(null==e?void 0:e.length)-1])||void 0===n?void 0:n.bot)&&!ie.current&&(delete tI[lg][(null==e?void 0:e.length)-1].bot,tk(tI)),tj(null),setTimeout(()=>{ro(!0)},250)}else e&&tj(null)},[re,tI,ie.current]),rt=(0,d.useCallback)(e=>{l4(e)},[]);(0,d.useEffect)(()=>{if(ec&&eu&&(null==re?void 0:re.length)>0){let e=null==re?void 0:re.find(e=>(null==e?void 0:e.keywordArguments)!=null);if(null!=e){if(iP.current&&iP.current===lg)return;iP.current=lg;let l={},t=null==e?void 0:e.keywordArguments;Object.keys(null!=t?t:{}).some(e=>{let n=null==t?void 0:t[e];null!=n&&("string"==typeof n?x.Z.isNullOrEmpty(n)||(l[e+l2+n]=!0):p()(n)&&(null==n?void 0:n.length)>0&&(null==n||n.some(t=>{t&&(l[e+l2+t]=!0)})))}),Object.keys(null!=l?l:{}).length>0&&(lF(l),lG(!0))}}},[lg,re]),(0,d.useEffect)(()=>{(lg||lN)&&oO!==x.Z.aiEngAppId&&oO!==x.Z.appLlmEndAppId&&!ni&&(0,u.E1K)({deploymentConversationId:lg}).then(e=>{var l;(null==e?void 0:e.success)&&(null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.docInfos)&&lE(!1)})},[lg,lN,oO,ni]);let rn=(e,l)=>{if(null==re||(null==re?void 0:re.length)===0){j.Am.error("Chat is empty!");return}(async()=>{let l=(0,u.RdB)({deploymentConversationId:lg,fileType:e?"pdf":"docx"});try{let t=await (0,u.EZn)({url:l,isGet:!0,isBlob:!0}),n=document.createElement("a"),o=URL.createObjectURL(t);n.href=o,n.download="conversation."+(e?"pdf":"docx"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)}catch(e){console.error(e),j.Am.error(x.Z.isNullOrEmpty(e)?""+e:x.Z.errorDefault)}})()},ro=(0,d.useCallback)((e,l,t,n,o)=>{let i=null==re?void 0:re.findLast(e=>"USER"===e.role),r=null==i?-1:null==re?void 0:re.indexOf(i),s=r<0?null:null==re?void 0:re[r+1];if(o&&i){let{nodeResponseObject:e,updatedFormData:l}=o,t=null==e?void 0:e.messageIndex,n=null==re?void 0:re.findIndex(e=>"USER"===e.role&&e.messageIndex===t);(i=null==re?void 0:re[n]).keywordArguments=l,s=null==re?void 0:re[n+1]}if(i){if(te(null==s?void 0:s.timestamp),nU(!0),eR&&(null==i?void 0:i.keywordArguments))nF(!0),i1(null,(null==s?void 0:s.timestamp)||"1234",null==i?void 0:i.docInfos,null,null,e,!0,null==i?void 0:i.keywordArguments,null==i?void 0:i.agentWorkflowNodeId,void 0,void 0,void 0,void 0,void 0,void 0,l).then(e=>{nU(!1),nF(!1)}).catch(e=>{nU(!1),nF(!1)});else{var a;i1(null!=t?t:i.text,(null==s?void 0:s.timestamp)||"1234",i.docInfos,null,null,e,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,l,void 0,void 0,n,null==s?void 0:null===(a=s.inputParams)||void 0===a?void 0:a.forceRoutingType).then(e=>{nU(!1)}).catch(e=>{nU(!1)})}}},[i1,re,eR]),ri=(0,d.useCallback)(async e=>{nX(!0);try{let t=await (0,u.OUg)({deploymentConversationId:lg,conversationSequenceNumber:e});if(null==t?void 0:t.request_id)nY(null==t?void 0:t.request_id);else{var l;j.Am.error("Failed to verify response: "+(null==t?void 0:null===(l=t.error)||void 0===l?void 0:l.toString())),nY(null),nX(!1)}}catch(e){j.Am.error("Failed to verify response: "+((null==e?void 0:e.message)||"Unknown error")),nY(null),nX(!1)}},[lg]);(0,d.useEffect)(()=>{if(!nQ)return;let e=Date.now(),l=setInterval(async()=>{try{if(Date.now()-e>6e5){clearInterval(l),nY(null),j.Am.error("Verification timed out after 10 minutes");return}let t=await (0,u.$pc)({requestId:nQ});(null==t?void 0:t.status)!=="PENDING"&&(await o5(),nY(null))}catch(e){clearInterval(l),nY(null),j.Am.error("Failed to verify response: "+((null==e?void 0:e.toString())||"Unknown error"))}},1e3);return()=>{clearInterval(l)}},[nQ,o5]);let rr=(0,d.useCallback)(e=>{let{humanizeInstructions:l,saveHumanizeInstructionsToConversation:t,disableImageGeneration:n}=e,o=null==re?void 0:re.findLast(e=>"USER"===e.role),i=null==o?-1:null==re?void 0:re.indexOf(o),r=i<0?null:null==re?void 0:re[i+1];o&&(te(null==r?void 0:r.timestamp),nU(!0),eR&&(null==o?void 0:o.keywordArguments)?i1(null,(null==r?void 0:r.timestamp)||"1234",null==o?void 0:o.docInfos,()=>{},null,n,!0,null==o?void 0:o.keywordArguments,null==o?void 0:o.agentWorkflowNodeId,l,t).then(e=>{nU(!1)}).catch(e=>{nU(!1)}):i1(o.text,(null==r?void 0:r.timestamp)||"1234",o.docInfos,null,null,n,void 0,void 0,void 0,l,t).then(e=>{nU(!1)}).catch(e=>{nU(!1)}))},[i1,re]),rs=(0,d.useCallback)(e=>{let l=null==re?void 0:re.findLast(e=>"USER"===e.role),t=null==l?-1:null==re?void 0:re.indexOf(l),n=t<0?null:null==re?void 0:re[t+1];l&&(te(null==n?void 0:n.timestamp),nU(!0),i1(l.text,(null==n?void 0:n.timestamp)||"1234",l.docInfos,null,null,void 0,void 0,void 0,void 0,i3,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e).then(()=>{nU(!1)}).catch(()=>{nU(!1)}))},[i1,re]),ra=(0,d.useCallback)(e=>{let{text:l}=e,t=null==re?void 0:re.findLast(e=>"USER"===e.role),n=null==t?-1:null==re?void 0:re.indexOf(t),o=n<0?null:null==re?void 0:re[n+1];t&&(te(null==o?void 0:o.timestamp),nU(!0),i1(l,(null==o?void 0:o.timestamp)||"1234",t.docInfos,null,null,void 0,void 0,void 0,void 0,void 0,void 0,!0).then(e=>{nU(!1)}).catch(e=>{nU(!1)}))},[i1,re]),rd=(0,d.useCallback)(e=>i1(e,null,null,()=>{setTimeout(()=>{nF(!0)},0)}).finally(()=>{nF(!1)}),[i1]),ru=(0,d.useCallback)(e=>{oA(e)},[]);(0,d.useEffect)(()=>{(null==re?void 0:re.length)>0&&iE.current&&(iE.current=!1)},[re]);let rc=(0,d.useMemo)(()=>null==re?void 0:re.find(e=>{var l,t;return(null==e?void 0:null===(l=e.text)||void 0===l?void 0:l.includes(a.gY))&&(null==e?void 0:null===(t=e.text)||void 0===t?void 0:t.includes(a.qZ))}),[re]);(0,d.useCallback)(e=>{l$(e),S().set(null,"__ab_hideCodeBlocksInit",e?"1":"0",{maxAge:31536e3,path:"/"})},[]);let rv=(0,d.useCallback)((e,l)=>{l1(t=>((t={...null!=t?t:{}})[e]=l?"1":"0",S().set(null,"__ab_hideBlocksInit",JSON.stringify(t),{maxAge:31536e3,path:"/"}),t))},[]),[rm,rp]=(0,d.useState)(!0);(0,d.useEffect)(()=>{!ij&&rm&&(rp(!1),setTimeout(()=>{var e,l;null===(l=e4.current)||void 0===l||null===(e=l.scrollToBottom)||void 0===e||e.call(l)},0),setTimeout(()=>{var e,l;null===(l=e4.current)||void 0===l||null===(e=l.scrollToBottom)||void 0===e||e.call(l)},330))},[ij]),(0,d.useEffect)(()=>{if((null==lC?void 0:lC.length)>0){e7.current=!1;let e=[];if(null==lC||lC.some(l=>{e.push(l.document_upload_id)}),tp(l=>{let t=[...null!=e?e:[]];return null==e||e.some(e=>{(null==l?void 0:l.includes(e))&&(t=null==t?void 0:t.filter(l=>l!==e))}),(null==t?void 0:t.length)>0&&(tu(e=>e=(e=[...null!=e?e:[]]).concat(null!=lC?lC:[])),tv(l=>l=(l=[...null!=l?l:[]]).concat(null!=e?e:[]))),l}),lg&&!e7.current){t9([...null!=td?td:[],...lC]);let e=lC.map(e=>e.document_upload_id);(0,u.omf)({deploymentConversationId:lg,docIds:e}).then(e=>{e7.current=!0}).catch(K())}lA(null)}},[lC,lg,e7.current]),(0,d.useEffect)(()=>{(lj!==lg||x.Z.isNullOrEmpty(lg))&&lS(null)},[lj,lg]);let rh=(0,d.useCallback)(()=>{var e;let l=document.querySelector(".messages-container");l&&setTimeout(()=>{l.scrollTop=l.scrollHeight}),null===(e=e4.current)||void 0===e||e.scrollToBottom(),setTimeout(()=>{var e;null===(e=e4.current)||void 0===e||e.scrollToBottom()},0)},[e4.current,re]),rf=(0,d.useCallback)((e,l)=>{let t=(null==e?void 0:e.auxiliaryWorkflowNodeId)||(null==e?void 0:e.auxiliary_workflow_node_id);if(t&&(null==e?void 0:e.type)==="agent_flow_button"){let{hasFrom:n,formConfig:o}=Y.ri.getFormConfigObjectFromNodeName(eU,t,l);n?(tM.current=!0,tk(e=>({...e,[lg]:[...(null==e?void 0:e[lg])||[],{user:o}]})),setTimeout(()=>{var e;null===(e=e3.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})},100)):(tk({}),i1(null,null,null,()=>{nF(!0)},null,!0,!0,{},t,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null==e?void 0:e.label).then(e=>{nF(!1)}).catch(e=>{nF(!1)}))}},[i1,eU,lg,tI]),rx=(0,d.useCallback)((e,l,t)=>{let n=!1;nF((n=nZ,!lg||nZ)),n?j.Am.error("Please wait for the current query to complete."):(tE.current=!0,tM.current=!1,eR?t?ro(null,null,null,null,{nodeResponseObject:e,updatedFormData:l}):i1(null,null,null,()=>{nF(!0)},null,!0,!0,l,null==e?void 0:e.agentWorkflowNodeId).then(e=>{nF(!1)}).catch(e=>{nF(!1)}):(l&&nK(e=>{let t={formResponse:l};return i()(t,e)||(e=t),e}),i1("Form Submitted",null,null,()=>{nF(!0)},null,null,null,null,null,null,null,null,!0,JSON.stringify(null!=l?l:"")).then(e=>{nF(!1)}).catch(e=>{nF(!1)}).finally(()=>{setTimeout(()=>{nK(null)},250)})))},[i1,tE,tM,eR,ro,lg]);(0,d.useEffect)(()=>{nZ||!tw||nB||tj(null)},[nZ,tw,nB]),(0,d.useEffect)(()=>{ie.current&&(nZ?sessionStorage.setItem("isCopilotProcessing","true"):sessionStorage.removeItem("isCopilotProcessing"))},[nZ,ie.current]),(0,d.useEffect)(()=>{if(tS){let e=new URLSearchParams(e5.toString());e.set("appId",tS),e.set("convoId",lg),e.has("aiAssistedEditAgentAppId")&&e.delete("aiAssistedEditAgentAppId"),e.has("assistedAgentProjectId")&&e.delete("assistedAgentProjectId"),e.has("assistedChatbotProjectId")&&e.delete("assistedChatbotProjectId"),setTimeout(()=>{tT.current=!1,tR(!0)},250),window.history.pushState(null,"","/chatllm/?".concat(e.toString()))}},[tS,lg]),(0,d.useEffect)(()=>{if(!o1&&!tT.current&&o8){var e;tT.current=!0,tR(!1),tL(null);let l=null==tI?void 0:tI[lg];(null==l?void 0:null===(e=l[(null==l?void 0:l.length)-1])||void 0===e?void 0:e.bot)&&(delete tI[lg][(null==l?void 0:l.length)-1].bot,tk(tI)),ro()}},[o1,o8,tT.current,tP]),(0,d.useEffect)(()=>{var e,l;(null==o8?void 0:null===(e=o8.result)||void 0===e?void 0:e.conversationWarning)&&lg&&!t_[lg]&&(t_[lg]=null==o8?void 0:null===(l=o8.result)||void 0===l?void 0:l.conversationWarning,tO(t_))},[o8,lg]);let{data:rg}=(0,v.a)({queryKey:["extApp",ea],queryFn:e=>{let{queryKey:l}=e;return(0,u.BO1)({externalApplicationId:l[1]})},enabled:!!((null==e$?void 0:null===(h=e$.result)||void 0===h?void 0:null===(m=h.organization)||void 0===m?void 0:m.isSelfServe)===!1&&ea&&ea!==x.Z.appLlmEndAppId&&null!=e$&&(null==e$?void 0:e$.needLogin)!==!0),select:e=>null==e?void 0:e.result}),rb=!!em||null!==(V=null==rg?void 0:rg.allowUserConfiguration)&&void 0!==V&&V;(0,d.useEffect)(()=>{l$(eS)},[eS]);let ry=(0,d.useCallback)(e=>{l$(e),(0,u.ilV)({preferences:{chatLLM:{HIDE_SQL_AND_CODE:e}}})},[em,e4]),rw=(0,d.useCallback)(e=>{oz()},[]),rj=(0,d.useCallback)(e=>{l6(e)},[]),rI=(0,d.useRef)(i1);(0,d.useEffect)(()=>{rI.current=i1},[i1]);let rk=(0,d.useCallback)((e,l)=>{let t=5,n=()=>{(0,u.J4l)({hostedAppId:e}).then(e=>{var o,i;let r=null==e?void 0:e.result,s=null==r?void 0:null===(i=r.find(e=>!!(null==e?void 0:e.isDev)))||void 0===i?void 0:null===(o=i.status)||void 0===o?void 0:o.toLowerCase();if((null==e?void 0:e.success)&&"active"===s)l(!0);else{if(null==e?void 0:e.success);else if(--t<=0){j.Am.error("Error starting app"),l(!1);return}setTimeout(()=>{n()},3e3)}}).catch(e=>{if(--t<=0){j.Am.error("Error starting app"),l(!1);return}setTimeout(()=>{n()},300)})};n()},[]),rC=(0,d.useCallback)((e,l,t,n,o,i,r)=>new Promise((s,a)=>{let d=d=>{lb(d),setTimeout(()=>{var u;let c=n,v=!1;null==c&&(v=!0,c=()=>{null==n||n(),nF(!0)}),null===(u=rI.current)||void 0===u||u.call(rI,e,l,t,c,o,null,null,null,null,null,null,null,null,null,i,void 0,void 0,void 0,r,null,null,null,null,null,d).then(()=>{s(!0),v&&nF(!1)}).catch(e=>{a(!1),v&&nF(!1)})},300)},c=(e,l)=>{setTimeout(()=>{d(l)},100),lv(!0),rk(e,l=>{if(lv(!1),!l){j.Am.error("Error starting app");return}setTimeout(()=>{(0,u.J4l)({hostedAppId:e}).then(e=>{var l,t,n;let o=null==e?void 0:e.result;lc((null==e?void 0:null===(t=e.result)||void 0===t?void 0:null===(l=t.find(e=>!!(null==e?void 0:e.isDev)))||void 0===l?void 0:l.name)||"new".concat(Math.random())),ls(""+(null==o?void 0:null===(n=o.find(e=>!!(null==e?void 0:e.isDev)))||void 0===n?void 0:n.hostedAppContainerId)||null)}).catch(e=>{})},100)})};(e=>{(0,u.FV$)({name:e}).then(e=>{var l,t;let n=null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.hostedAppId,o=null==e?void 0:null===(t=e.result)||void 0===t?void 0:t.deploymentConversationId;(null==e?void 0:e.success)&&n&&o?(lx(n),c(n,o)):j.Am.error("Failed to create app")}).catch(e=>{j.Am.error("Error Creating App")})})("New App "+Math.trunc(999999*Math.random()))}),[i1]),rA=(0,d.useCallback)((e,l,t,n,o,i,r)=>new Promise((s,a)=>{i1(e,l,t,n,o,null,null,null,null,null,null,null,null,null,i,void 0,void 0,void 0,r).then(()=>{s(!0)}).catch(e=>{a(!1)})}),[i1]),rN=(0,d.useCallback)((e,l,t,n,o,i,r)=>new Promise((s,a)=>{i1(e,l,t,n,o,null,null,null,null,null,null,null,null,null,i,void 0,void 0,void 0,r).then(()=>{s(!0)}).catch(e=>{a(!1)})}),[i1]),rE=(0,d.useRef)(null);(0,d.useEffect)(()=>{if(la){if(nZ){let l=[],t=null==re?void 0:re[(null==re?void 0:re.length)-1];if(null==t?void 0:t.uiRequestId){var e;let n=null;null==t||null===(e=t.segments)||void 0===e||e.some((e,t)=>{(null==e?void 0:e.type)==="saved_instance"&&(n=e),["file_write"].includes(null==e?void 0:e.type)&&l.push(e)}),null!=n&&(l=[n])}(null==l?void 0:l.length)===0&&(l=null),null!=rE.current&&i()(rE.current,l)?l=rE.current:rE.current=l,lh(l)}else lh(null)}},[nZ,la,re]);let rS=(0,d.useMemo)(()=>re,[re]);(0,d.useEffect)(()=>{var e,l,t;let n=rS[rS.length-1];tH&&(null==tH?void 0:tH.messageId)===(null==tK?void 0:tK.messageId)&&tV&&(null==n?void 0:n.role)==="BOT"&&(null==n?void 0:null===(e=n.segments[1])||void 0===e?void 0:e.segment)&&!(null==n?void 0:null===(t=n.segments[1])||void 0===t?void 0:null===(l=t.generationParams)||void 0===l?void 0:l.mask)&&tq(null==n?void 0:n.segments[1])},[rS]),(0,d.useEffect)(()=>{(null==ig?void 0:ig.length)>0&&(ib([]),null==ig||ig.some((e,l)=>{try{null==e||e()}catch(e){}}),lo())},[ig]);let rL=(0,d.useMemo)(()=>{if(!iy)return null;{let e=decodeURIComponent(iy);return null==re?void 0:re.find(l=>(null==l?void 0:l.timestamp)===e)}},[rS,iy]);(0,d.useEffect)(()=>{var e,l;if(!(null==o9?void 0:o9.length))return;let t=[...o9].reverse().find(e=>(null==e?void 0:e.role)==="USER");if(!(null==t?void 0:null===(e=t.inputParams)||void 0===e?void 0:e.filterKeyValues)||Object.keys((null==t?void 0:null===(l=t.inputParams)||void 0===l?void 0:l.filterKeyValues)||{}).some(e=>!(null==lt?void 0:lt[e])))return;let n={};Object.entries(t.inputParams.filterKeyValues).forEach(e=>{let[l,t]=e;Array.isArray(t)&&t.forEach(e=>{n["".concat(l).concat(l2).concat(e)]=!0})}),lF(n)},[o9,lt]);let rT=(0,d.useMemo)(()=>!eR||!!ef||(null==t5?void 0:t5.length)===0&&((null==t3?void 0:t3.length)===0||(null==t3?void 0:t3.length)===void 0)&&!or,[t5,t3,or,eR,ef]),rP=(0,d.useMemo)(()=>{var e;return(null==o8?void 0:null===(e=o8.result)||void 0===e?void 0:e.conversationType)==="CHAT_LLM_TASK"},[null==o8?void 0:o8.result]),{data:rR}=(0,eH.Z0)(),r_=(0,d.useMemo)(()=>{var e,l;return(null==o8?void 0:null===(e=o8.result)||void 0===e?void 0:e.chatllmProjectId)?null==rR?void 0:null===(l=rR.find(e=>{var l;return e.chatllmProjectId===(null==o8?void 0:null===(l=o8.result)||void 0===l?void 0:l.chatllmProjectId)}))||void 0===l?void 0:l.name:""},[rR,null==o8?void 0:o8.result]),rO=(0,d.useMemo)(()=>{var e;return null==o8?void 0:null===(e=o8.result)||void 0===e?void 0:e.chatllmTaskId},[null==o8?void 0:o8.result]),rM=eX(rP);(0,d.useEffect)(()=>{var e,l,t,n,o;let i=(!rM&&rP||ef)&&!(null==oX?void 0:null===(l=oX.result)||void 0===l?void 0:null===(e=l.history)||void 0===e?void 0:e.length);if(ef&&(null==oX?void 0:null===(n=oX.result)||void 0===n?void 0:null===(t=n.history)||void 0===t?void 0:t.length)){let{shouldRefreshConversation:e}=Y.ri.handleConversationBasedOnWorkflowStatus(eU,null==oX?void 0:null===(o=oX.result)||void 0===o?void 0:o.history);i=i||e}i&&(oJ(!0),setTimeout(()=>{oJ(!1)},6e4))},[rP,rM,ef,null==oX?void 0:null===(E=oX.result)||void 0===E?void 0:E.history]);let rD=(0,d.useMemo)(()=>!ef&&!rP&&!iN&&(null==re||!re.length)&&!or||!ef&&!rP&&ii&&!ij&&!(null==re?void 0:re.length)&&!ov&&!ef&&!or,[rP,ij,ii,re,ov,ef,iN,oO,nZ,nB,or]),rZ=(0,d.useMemo)(()=>{var e,l;return rP&&o4&&oX&&!(null==oX?void 0:null===(l=oX.result)||void 0===l?void 0:null===(e=l.history)||void 0===e?void 0:e.length)},[rP,o4,null==oX?void 0:null===(P=oX.result)||void 0===P?void 0:P.history]);(0,d.useEffect)(()=>{nf(rD)},[rD]),(0,d.useEffect)(()=>{if(nc){nh(!0);let e=async()=>{try{let t=await (0,u.nYK)({externalApplicationId:oO,browserType:nE});if(null==t?void 0:t.success){var l;(null==t?void 0:null===(l=t.result)||void 0===l?void 0:l.computerStarted)?(ng(null==t?void 0:t.result),nh(!1)):setTimeout(e,5e3)}else ng(null),nh(!1)}catch(e){ng(null),nh(!1)}};e()}return()=>{nh(!1),ng(null)}},[nc,oO,nE]);let rF=!eR||(null===(R=t5||[])||void 0===R?void 0:R.length)===0&&(null===(_=t3||[])||void 0===_?void 0:_.length)===0,rB=!ov&&rF;(0,d.useEffect)(()=>{let e=()=>{nc&&(nv||nZ||nB)&&rl()};return nv&&nm(!1),window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e),e()}},[nc,nZ,nB,lg,lj,nv]),(0,d.useEffect)(()=>{if(oO!==x.Z.aiEngAppId&&oO!==x.Z.appLlmEndAppId&&oX&&ou&&!ni&&o3&&em&&!nc){var e,l,t,n;let o=null==oX?void 0:null===(l=oX.result)||void 0===l?void 0:null===(e=l.history)||void 0===e?void 0:e.findLast(e=>"BOT"===e.role);if(o&&(null==o?void 0:null===(t=o.llmDisplayName)||void 0===t?void 0:t.toLowerCase())!==(null==oZ?void 0:oZ.toLowerCase())){let e=null==eN?void 0:null===(n=eN.result)||void 0===n?void 0:n.find(e=>{var l,t;return(null==e?void 0:null===(l=e.name)||void 0===l?void 0:l.toLowerCase())===(null==o?void 0:null===(t=o.llmDisplayName)||void 0===t?void 0:t.toLowerCase())});if(e){let l=new URLSearchParams(e5.toString());l.set("appId",(null==e?void 0:e.externalApplicationId)||""),window.history.pushState(null,"","/chatllm/?".concat(l.toString()))}}oc(null)}},[o3,oO,ou,ni,oZ,em,oX,eN,e5,nc]);let rU=(0,d.useRef)(null);(0,d.useEffect)(()=>{lg&&oy&&(null!=rU.current&&(clearTimeout(rU.current),rU.current=null),rU.current=setTimeout(()=>{rU.current=null,ow(null)},100))},[lg]);let rz=(0,d.useCallback)(()=>{let e=async()=>{var e,l,t,n;let o=null,i=null,r=null===(e=navigator.userAgent)||void 0===e?void 0:e.toLowerCase();if((null==r?void 0:r.includes("mac"))||(null==r?void 0:r.includes("darwin"))?o="darwin":(null==r?void 0:r.includes("win"))?o="windows":(null==r?void 0:r.includes("linux"))&&(o="linux"),"darwin"===o)i=(null==r?void 0:r.includes("mac"))&&/macintosh.*mac.*os.*x.*version.*\d+.*\d+.*\d+.*arm64/i.test(r)?"arm64":"x64";else try{if(navigator.userAgentData){let e=await (null===(t=navigator)||void 0===t?void 0:null===(l=t.userAgentData)||void 0===l?void 0:l.getHighEntropyValues(["architecture"])),o=null==e?void 0:null===(n=e.architecture)||void 0===n?void 0:n.toLowerCase();i=(null==o?void 0:o.includes("arm"))?"arm64":(null==o?void 0:o.includes("64"))?"x64":"ia32"}else i=(null==r?void 0:r.includes("arm"))?"arm64":(null==r?void 0:r.includes("x64"))||(null==r?void 0:r.includes("x86_64"))?"x64":"ia32"}catch(e){i="x64"}return"darwin"===o&&(i="arm64"),{platform:"".concat(o,"-").concat(i)}};return(async()=>{let l=await e(),t="https://static.abacus.ai/codellm/releases";if(!l)return null;l.quality="stable";try{var n;let e=await fetch("https://abacus.ai/api/_getCodeLlmVersion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),o=await e.json();if(null==o?void 0:null===(n=o.result)||void 0===n?void 0:n.url){let e=o.result.url;if(e.endsWith(".tar.gz")&&l.platform.startsWith("linux")){let l=o.result.name;e="".concat(t,"/").concat(l,"/codellm_").concat(l,"_amd64.deb"),o.result.url=e}if(e.endsWith(".zip")&&l.platform.startsWith("darwin")){let n=l.platform.split("-")[1],i=o.result.name;e="".concat(t,"/").concat(i,"/CodeLLM.").concat(n,".").concat(i,".dmg"),o.result.url=e}if(e.endsWith(".zip")&&l.platform.startsWith("win")){let l=o.result.name;e="".concat(t,"/").concat(l,"/CodeLLMSetup-x64-").concat(l,".exe"),o.result.url=e}}return o}catch(e){return console.error("Error fetching code LLM version:",e),null}})()},[]),rG=(0,d.useRef)(!1);(0,d.useEffect)(()=>{"1"!==oy||ih||rG.current||(rG.current=!0,j.Am.info("Preparing..."),(0,u.afj)({expiresAt:ex()().add(6,"months").toISOString()}).then(e=>{var l,t;let n=null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.apiKey,o=null==e?void 0:null===(t=e.result)||void 0===t?void 0:t.apiKeyId;if(n){let e=(0,eg.m)(n,o);e&&(0,u.ptG)({isInstalled:!0}).then(l=>{window.location.href=e}).catch(l=>{console.error("Error: "+l),window.location.href=e})}else j.Am.error("Failed to create code")}).catch(e=>{j.Am.error("Error: "+e)}))},[oy,ih]);let rW=(0,d.useMemo)(()=>nj&&!!(null==nt?void 0:nt.agentId),[nj,nt]),rH=(0,d.useMemo)(()=>{let e=null==rS?void 0:rS.map((e,l)=>{var t,o,i,r,s,d,u,c,v,m,p;let h=null==rS?void 0:rS[l-1],f=null==rS?void 0:rS[l+1],g=null==f?void 0:null===(i=f.segments)||void 0===i?void 0:null===(o=i[1])||void 0===o?void 0:null===(t=o.generationParams)||void 0===t?void 0:t.imageId,b=null==rS?void 0:rS.findLast((e,l)=>{if((null==e?void 0:e.role)==="BOT")return!0}),y=null==b?void 0:null===(s=b.segments)||void 0===s?void 0:null===(r=s.find(e=>(null==e?void 0:e.type)==="image_url"))||void 0===r?void 0:r.messageId,w=e;if(g&&(null==e?void 0:null===(d=e.inputParams)||void 0===d?void 0:d.forceRoutingType)==="IMAGE_GEN"&&(null==e?void 0:e.role)==="USER"){let l=null==rS?void 0:rS.find(e=>{var l,t;return(null==e?void 0:null===(t=e.segments)||void 0===t?void 0:null===(l=t[1])||void 0===l?void 0:l.messageId)===g&&(null==e?void 0:e.role)==="BOT"});w={...e,repaintedImage:l}}return(0,n.jsx)(a.ZP,{data:w,textwithTableWidth0:o_,onVerifyResponse:ri,isHideTopBar:eE,requestCodeExecutionMutationCache:oT,onClickSaveFeedback:iB,sideBySideWW:oE,isVerifyLoading:nJ,verifyRequestId:nQ,setIsVerifyLoading:nX,cacheFormDataAgents:ic,cacheFormDataAgentsUISchema:iv,cacheFormDataAgentsJsonSchema:im,cacheFormDataAgentsFormChangeRef:ip,widthDiffChanged:ru,forceWidthDiff:oC,themeApp:lQ,highlightColorHex:eL,botIconUrl:oF,hideCodeBlocks:lX,setHideCodeBlocks:ry,hideBlocks:l0,setHideBlocks:rv,isDark:lK,isInternal:eT,botName:oZ,deploymentId:ei,deploymentConversationId:lg,canSideBySide:oN>0,showHeader:!0,isProcessing:nZ,isProcessingUpload:ts,isRegenerateProcessing:nB,isLast:l===rS.length-1,isLastPrompt:(l===re.length-1||l===re.length-2)&&(null==e?void 0:e.role)==="USER",isLastQueryPrompt:l===re.length-1||l===re.length-2&&(null==e?void 0:e.role)==="USER"&&(null==re?void 0:null===(u=re[re.length-1])||void 0===u?void 0:u.role)!=="USER",isLastResponse:l===re.length-1&&(null==e?void 0:e.role)==="BOT",isDeployError:eP,messageIndex:eR?null==e?void 0:e.messageIndex:l,messageIndexReal:null==e?void 0:e.messageIndex,messageIndexOrder:l,keyText:""+l,isMessageIndexSameAsBeforeOne:(eR?null==e?void 0:e.messageIndex:l)===(eR?null==h?void 0:h.messageIndex:l-1),isMessageIndexSameAsAfterOne:(eR?null==e?void 0:e.messageIndex:l)===(eR?null==f?void 0:f.messageIndex:l-1),onRegenerate:ro,humanizeInstructions:i3,onHumanize:rr,onRegenUsingLLM:rs,onPromptSave:ra,doStop:rl,isAgent:ec,isShowRegenerate:(ec||ew)&&!nB&&!x.Z.isNullOrEmpty(lg)&&(null==rS?void 0:rS.length)>0&&(null==rS?void 0:null===(c=rS[(null!==(p=null==rS?void 0:rS.length)&&void 0!==p?p:0)-1])||void 0===c?void 0:c.role)==="BOT"&&!nZ&&!ts,isShowHumanize:rb,doHideAnyScore:rt,dataScoreOpen:l3,isSelfServe:em,isMobile:e_,actionSegment:tw,onResponseAction:rf,orgHost:eA,onUserFormSubmit:rx,workflowGraph:eU,appId:oO,isWorkflowAgent:eR,isWorkflowAgentFormInterface:ov,availableRuntimeSchemas:t7.current,isRefetchingChat:o1,isCopilot:ie.current||oO===x.Z.aiEngAppId,agentConversationHistoryWithContextId:ne.current,nextNodeData:(null==rS?void 0:null===(v=rS[l+1])||void 0===v?void 0:v.formResponse)?null==rS?void 0:rS[l+1]:nV,searchSuggestions:null==oX?void 0:null===(m=oX.result)||void 0===m?void 0:m.searchSuggestions,onSend:rA,setIsProcessing:nF,scoreIndex:oa,setScoreIndex:od,isTaskConversation:rP,projectName:r_,isFilesExistInConversation:rP,showAgentWorkflowPreview:rW,doAnimateLeaveEmptySpaceScrollRef:iX,listExtApps:eN,lastBotMessageImageId:y},"chatOne"+l)});if((null==rS?void 0:rS.length)>0&&nZ){var l;if((null==rS?void 0:null===(l=rS[(null==rS?void 0:rS.length)-1])||void 0===l?void 0:l.role)==="BOT"){let l=null==rS?void 0:rS.findLastIndex((e,l)=>{if((null==e?void 0:e.role)==="USER"&&(null==e?void 0:e.uiRequestId))return!0});if(l>=0){let t=(0,n.jsx)("div",{style:{height:"1px"},className:" bg-black/[0] ",ref:e9},"anchor1");null==e||e.splice(l,0,t)}}}return e},[re,rS,o_,ld,ov,ic,iv,im,iB,oE,ru,oC,lQ,eL,oF,lX,ry,l0,rv,lK,eT,oZ,ei,oN,nZ,ts,eP,eR,ro,i3,rr,ra,rl,ec,ew,nB,lg,oT,rb,rt,l3,em,e_,tw,rf,eA,rx,eU,oO,t7.current,o1,ie.current,ne.current,nV,rA,nJ,rP,rW,iX]),[rq,rV]=(0,d.useState)(!1);if((0,d.useEffect)(()=>{nA(null),nR(null),nD(!1)},[lg]),(0,d.useEffect)(()=>{(null==nP?void 0:nP.isStreaming)&&(null==nP?void 0:nP.attachmentInfo)&&(async()=>{try{var e,l,t,n,o,i,r,s,a,d,c,v;let m=null==nP?void 0:null===(e=nP.attachmentInfo)||void 0===e?void 0:e.attachment_id;if(!(null===(l=n_[m])||void 0===l?void 0:l.isLoading)&&!(null===(t=n_[m])||void 0===t?void 0:t.content)){nO({...n_,[m]:{isLoading:!0,metadata:{filename:null==nP?void 0:null===(n=nP.attachmentInfo)||void 0===n?void 0:n.filename}}});let e=await (0,u.zcA)({attachmentId:m,deploymentId:ei});nA(null),nG(""),tq(null),tX(""),nR({content:null==e?void 0:null===(o=e.result)||void 0===o?void 0:o.content,metadata:{filename:null==nP?void 0:null===(i=nP.attachmentInfo)||void 0===i?void 0:i.filename},attachmentId:m,areColumnsTruncated:null==e?void 0:null===(r=e.result)||void 0===r?void 0:r.areColumnsTruncated,areRowsTruncated:null==e?void 0:null===(s=e.result)||void 0===s?void 0:s.areRowsTruncated,error:null==e?void 0:e.error}),setTimeout(()=>{nD(!0)},10),nO({...n_,[m]:{content:null==e?void 0:null===(a=e.result)||void 0===a?void 0:a.content,metadata:{filename:null==nP?void 0:null===(d=nP.attachmentInfo)||void 0===d?void 0:d.filename},isLoading:!1,areColumnsTruncated:null==e?void 0:null===(c=e.result)||void 0===c?void 0:c.areColumnsTruncated,areRowsTruncated:null==e?void 0:null===(v=e.result)||void 0===v?void 0:v.areRowsTruncated,error:null==e?void 0:e.error}})}}catch(e){console.log(e)}})()},[nP,ei,nZ,n_]),(0,d.useEffect)(()=>{if(rW){var e,l;let t=null==rS?void 0:rS.findLast((e,l)=>{if((null==e?void 0:e.role)==="BOT")return!0});nW((null==t?void 0:null===(l=t.segments)||void 0===l?void 0:null===(e=l.filter(e=>(null==e?void 0:e.type)==="agent_notification"&&(null==e?void 0:e.txn)==="edit"))||void 0===e?void 0:e.length)>0)}},[rS,rW]),rq){let e=new URLSearchParams(window.location.search).get("user-code");return(0,n.jsx)("div",{className:"absolute inset-0 overflow-hidden",children:(0,n.jsx)(eB,{userCode:e,onSuccess:()=>{window.close()}})})}return(0,n.jsxs)("div",{className:(0,O.cn)("absolute inset-0 !overflow-x-hidden ",{invisible:iS,"overflow-y-auto":!!lg&&!ov,"overflow-y-hidden":ov}),ref:oS,children:[em&&(0,n.jsx)(eF,{isTasks:rP}),(0,n.jsx)(ed,{open:!!n6,type:n6,suggestedLlms:n9,percentUsed:oe,otherUsageType:ot,onClose:(e,l,t)=>{n3(null),n7(null),ol(null),on(null),t||ro(l,e)}}),n4?(0,n.jsx)(eh.Z,{prompt:n4,onSend:e=>{n8(void 0),oi(!1),ro(void 0,void 0,e.prompt,e)},onCancel:()=>{n8(void 0),oo&&ro(!0,void 0,n4,void 0),oi(!1)},onClose:()=>{n8(void 0),oi(!1)},deploymentId:ei}):null,(0,n.jsxs)("div",{className:" flex flex-col h-full transition-all duration-300 "+(rm?" invisible ":""),children:[le&&!eP&&(0,n.jsx)("div",{className:" [@media(max-width:1100px)]:!hidden left-[10px] absolute top-[5px] flex items-center justify-center text-[13px] gap-[10px] md:gap-[0] pt-[10px]",children:null==lt||0===Object.keys(null!=lt?lt:{}).length||(null==lQ?void 0:lQ.ForceHideFiltersKeyS)==="1"?null:(0,n.jsx)(B,{filtersData:lt,filtersUsed:lZ,filtersText:lB,filtersReadOnly:lz,themeApp:lQ,filterSep:l2,isAgent:ec,setFiltersUsed:lF,setFiltersText:lU})}),ef&&lM&&(0,n.jsxs)("span",{className:"ml-[20px] mt-[15px] cursor-pointer text-bwleftblue",onClick:()=>lb(null),children:[(0,n.jsx)(b.G,{icon:t(96665).A3,style:{marginRight:"5px"}}),"Control Panel"]}),!eP&&em&&!la&&("1"===oj||"2"===oj)&&!e_&&(0,n.jsx)("div",{className:" h-[60px] ",children:(0,n.jsxs)("div",{style:{fontFamily:"Roboto",background:"url(/chatllm/staticllm/black_banner_appllm2.webp) no-repeat left center, black",backgroundSize:"contain"},className:" bg-black rounded-lg mx-[10px] mt-[10px] h-[50px] text-white font-semibold flex items-center justify-center text-[16px] ",children:[(0,n.jsx)("span",{className:" ",children:"Prompt, run, edit, and deploy full-stack websites"}),(0,n.jsxs)("div",{className:" flex items-center gap-[10px] absolute right-[21px] top-[20px] font-normal text-[13px] ",children:[(0,n.jsx)(g.Z,{onClick:e=>{n0(x.Z.appLlmEndAppId),setTimeout(()=>{oI(null)},100)},className:" bg-white/[0.2] ",children:"Try now!"}),(0,n.jsx)(g.Z,{onClick:()=>oI(null),className:"w-[32px] h-[32px] !p-0 flex items-center justify-center",children:(0,n.jsx)(b.G,{icon:t(25667).faXmark,transform:{size:16}})})]})]})}),!eP&&em&&("1"===oy||"2"===oy)&&!e_&&(0,n.jsx)("div",{className:" h-[60px] ",children:(0,n.jsxs)("div",{style:{fontFamily:"Roboto",background:"url(/chatllm/staticllm/black_banner_codellm2.webp) no-repeat left center, black",backgroundSize:"contain"},className:" bg-black rounded-lg mx-[10px] mt-[10px] h-[50px] text-white font-semibold flex items-center justify-center text-[16px] ",children:[(0,n.jsx)("span",{children:"Our brand new code editor based on VSCode"}),(0,n.jsxs)("div",{className:" flex items-center gap-[10px] absolute right-[21px] top-[20px] font-normal text-[13px] ",children:[(0,n.jsx)(g.Z,{onClick:e=>{j.Am.info("Preparing..."),rz().then(e=>{var l,t;if(null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.url){let l=null==e?void 0:null===(t=e.result)||void 0===t?void 0:t.url;(0,u.ptG)({isInstalled:!0}).then(e=>{window.location.href=l}).catch(e=>{console.error("Error: "+e),window.location.href=l})}else j.Am.error("Error fetching code LLM version")}).catch(e=>{console.error("Error: ",e),j.Am.error("Error fetching code LLM version. Please try again later.")})},className:" bg-white/[0.2] ",children:"Download"}),(0,n.jsx)(g.Z,{onClick:e=>{j.Am.info("Preparing..."),(0,u.afj)({expiresAt:ex()().add(6,"months").toISOString()}).then(e=>{var l,t;let n=null==e?void 0:null===(l=e.result)||void 0===l?void 0:l.apiKey,o=null==e?void 0:null===(t=e.result)||void 0===t?void 0:t.apiKeyId;if(n){let e=(0,eg.m)(n,o);e&&((0,u.YG9)({apiKeyId:o,keepCount:2}).catch(e=>{console.error("Failed to delete other API keys:",e)}),(0,u.ptG)({isInstalled:!0}).then(l=>{window.location.href=e}).catch(l=>{console.error("Error: "+l),window.location.href=e}))}else j.Am.error("Failed to create code")}).catch(e=>{j.Am.error("Error: "+e)})},className:" bg-white/[0.2] ",children:"Open CodeLLM"}),(0,n.jsx)(g.Z,{onClick:()=>ow(null),className:"w-[32px] h-[32px] !p-0 flex items-center justify-center",children:(0,n.jsx)(b.G,{icon:t(25667).faXmark,transform:{size:16}})})]})]})}),!eP&&!ok&&!nc&&!nM&&(0,n.jsxs)("div",{className:" ".concat(eO||eZ?"h-[52px]":"h-[40px]"," border-b-0 ").concat(e_?"bg-darkcoloro":"bg-bwcentercolor"," rounded-tl-sm rounded-tr-sm border-b-darkcolor/[0.1] flex items-center justify-center sm:justify-end sm:pr-[20px] text-[13px] gap-[10px] md:gap-[0] ").concat(e_||ec||rc||lY||le?" ":" absolute right-0 z-[1]"),children:[!ec&&rc&&!lY&&(0,n.jsxs)("div",{className:" flex items-center gap-[5px] !cursor-pointer relative pt-[16px]",children:[(0,n.jsx)(A.Z,{title:"Hide SQL & Code",children:(0,n.jsx)("span",{children:(0,n.jsx)(k.Z,{value:!!lX,onChange:ry,className:" mt-[3px] "})})}),(0,n.jsx)(A.Z,{title:"Hide SQL & Code",children:(0,n.jsx)("span",{onClick:()=>ry(!lX),className:"dark:!text-darkcolor/[0.6]",children:(0,n.jsx)("span",{children:(0,n.jsx)(b.G,{icon:t(95051).t5,transform:{size:16}})})})}),(0,n.jsx)(L.Z,{text:"Omit displaying queries and code blocks that are included in each message of the conversation."})]}),!ec&&rc&&!lY&&(0,n.jsx)("div",{className:" mx-[9px] md:block hidden  pt-[16px]",children:"-"}),em&&e_&&(0,n.jsxs)("div",{className:" text-[12px] text-center mr-[10px] ".concat(eO||eZ?"flex-1":""),children:["Go to https://chatllm.abacus.ai ",(0,n.jsx)("br",{}),"on desktop for a better experience"]}),e_&&em?(0,n.jsx)("div",{onClick:()=>{e6.push("/?appId=".concat(oO))},className:" !px-[0px] !py-[0px] !border-[0px] font-semibold !bg-darkcoloro rounded-full text-bwleftblue text-[14px] dark:!text-darkcolor/[0.6] ",children:(0,n.jsx)(b.G,{icon:t(89229).Xc,transform:{size:16}})}):null,(0,n.jsx)("div",{style:ok||lM?{display:"none"}:{},className:"".concat(e_?"":"pt-[16px]"),children:!oD&&(0,n.jsx)(A.Z,{title:(eO||eZ)&&em?"Get App":"Share",children:(eO||eZ)&&em?(0,n.jsx)("a",{target:"_blank",href:eO?"https://apps.apple.com/app/chatllm-ai-chat-and-agents/id6502844681":"https://play.google.com/store/apps/details?id=com.abacusai.chatllm",children:(0,n.jsxs)(g.Z,{className:"text-white !bg-transparent text-[18px] font-bold !p-0 mr-[5px] flex items-center justify-center gap-[8px]",noScale:!0,children:[eO&&(0,n.jsx)("img",{alt:"ChatLLM App",src:"/chatllm/staticllm/app_store.svg"}),eZ&&(0,n.jsx)("img",{alt:"ChatLLM App",src:"/chatllm/staticllm/play_store.svg"})]})}):(0,n.jsx)("span",{children:(0,n.jsx)(N.Z,{zIndex:"z-[13]",title:"Share 'Chat'",content:(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:" text-darkcolor py-[10px] px-[15px] border-[1px] border-darkcolor/[0.1] rounded mt-[10px] bg-darkcolor/[0.05] ",children:[(0,n.jsx)("div",{className:" text-[12px] font-[500] ",children:"General Access"}),(0,n.jsxs)("div",{className:" flex gap-[5px] pt-[8px] ",children:[(0,n.jsx)("div",{className:" flex items-center justify-center ",children:(0,n.jsx)("div",{className:" rounded-full px-[9px] py-[5px] bg-darkcolor/[0.15] ",children:(0,n.jsx)(b.G,{icon:t(2095).HI,transform:{size:16}})})}),(0,n.jsxs)("div",{className:" text-[12px] flex flex-col gap-[2px] ",children:[(0,n.jsx)("div",{className:" font-[500] ",children:"Restricted"}),(0,n.jsx)("div",{className:" text-[11px] ",children:"Only users with authorized access to this chatbot will be able to view this page"})]})]}),(0,n.jsx)("div",{className:" mt-[12px] flex items-center justify-center ",children:(0,n.jsx)(g.Z,{onClick:e=>{tF("".concat(window.location.origin,"/chatllm/?convoId=").concat(null!=lg?lg:"","&appId=").concat(oO)),j.Am.success("Copied to Clipboard!",{icon:(0,n.jsx)(b.G,{icon:t(66522).Yj,transform:{size:16}})})},children:"Copy Link"})})]})}),cancelText:"Done",hideOkButton:!0,children:(0,n.jsx)(g.Z,{className:"text-bwleftblue !bg-bwleftblue/[0.18] rounded-[8px] w-[32px] h-[32px] !px-0 !py-0 dark:!border-darkcolor/[0.1] dark:!text-darkcolor/[0.6] dark:!bg-darkcolor/[0.05] dark:hover:!bg-darkcolor/[0.1]",children:(0,n.jsx)("span",{className:" amr-[5px] ",children:(0,n.jsx)(b.G,{icon:t(34129).M6,transform:{size:16}})})})})})})}),(0,n.jsx)("div",{className:" mx-[3px] md:block hidden "}),(0,n.jsx)(A.Z,{title:"Download",children:(0,n.jsx)("div",{style:ok||lM?{display:"none"}:{},className:" hidden md:flex items-center ".concat(e_?"":"pt-[16px]"),children:(0,n.jsx)(T.Z,{align:"end",width:180,content:(0,n.jsxs)("div",{className:" -m-[8px] text-[13px] text-darkcolor",children:[(0,n.jsx)("div",{onClick:rn.bind(null,!0),className:" !cursor-pointer w-full hover:bg-darkcolor/[0.05] rounded px-[10px] py-[3px]",children:"Download PDF"}),(0,n.jsx)("div",{onClick:rn.bind(null,!1),className:" !cursor-pointer w-full hover:bg-darkcolor/[0.05] rounded px-[10px] py-[3px] ",children:"Download Word"})]}),children:(0,n.jsx)("span",{children:(0,n.jsx)(g.Z,{className:"text-bwleftblue !bg-bwleftblue/[0.18] rounded-[8px] w-[32px] h-[32px] !px-0 !py-0 dark:!border-darkcolor/[0.1] dark:!text-darkcolor/[0.6] dark:!bg-darkcolor/[0.05] dark:hover:!bg-darkcolor/[0.1]",children:(0,n.jsx)("span",{className:" amr-[5px] ",children:(0,n.jsx)(b.G,{icon:t(48812).q7,transform:{size:16}})})})})})})})]}),(0,n.jsxs)("div",{className:"flex-1 relative",children:[(0,n.jsx)("div",{className:"px-[0] ".concat(!e_&&(ec||rc||lY||le)?"pt-[20px]":""," ").concat(rD&&rF&&!nc?"":"h-full"," relative"),ref:oh,children:(0,n.jsxs)("div",{className:"relative h-full",children:[o4&&!rZ&&!e_&&!ec&&rP&&rO?(0,n.jsxs)("div",{className:G().filesContent+" absolute pl-[16px] ".concat(nz||tH||(null==nP?void 0:nP.content)?"w-[98px]":"w-[210px]"," overflow-auto h-full pb-[30px] flex flex-col gap-[2px] z-[1] top-[32px]"),children:[(0,n.jsx)("div",{className:"text-darkcolor text-[14px] font-semibold flex gap-[12px]",children:"TASK"}),(0,n.jsx)("div",{className:"max-h-[676px] overflow-auto flex flex-col gap-[2px]",children:(0,n.jsx)(eM,{taskId:rO,noData:oY&&!(null==oX?void 0:null===(D=oX.result)||void 0===D?void 0:null===(M=D.history)||void 0===M?void 0:M.length)})})]}):null,o4&&rZ?(0,n.jsx)("div",{className:(0,O.cn)("flex flex-col items-center justify-center z-10 !mx-auto mt-36",a.uO,{" !pl-[32px] !mx-0 !pr-0 !max-w-[480px] !my-0 h-full":nc}),children:(0,n.jsx)(eM,{taskId:rO,noData:oY&&!(null==oX?void 0:null===(F=oX.result)||void 0===F?void 0:null===(Z=F.history)||void 0===Z?void 0:Z.length),centered:!0})}):null,o4&&rD&&rF?(0,n.jsx)($.Z,{appId:oO,isHideTopBar:eE,isBotLLM:ir,botIconUrl:oF,defaultPrompts:lJ,extAppName:id,extAppDescription:is,onlyImageGenEnabled:ia,isProcessing:nZ,isProcessingUpload:ts,setIsProcessing:nF,setIsProcessingUpload:ta,onSend:ld?rC:rd,onSendConvoOne:ld?rC:rA,onUploadDocument:iH,isBinaryEnable:ek,supportsBinaryUpload:th,isSelfServe:em,themeApp:lQ,showTricks:!lg||nc&&(null==re?void 0:re.length)===0,deploymentId:ei,onRemoveFileByID:iU,deploymentConversationId:lg,isNewTask:"task"===e2,isAgent:ec,hasThinkingOption:iu,textareaRef:e8}):null,(0,n.jsx)("div",{className:"",children:(0,n.jsx)(ep,{sideBySideWW:oE,deploymentConversationId:lg,isMobile:e_,deploymentId:ei,highlightColorHex:eL,isWorkflowAgentFormInterface:!1,data:rL,canSideBySide:oN,forceWidthDiff:oC,widthDiffChanged:ru,scoreIndex:oa,setScoreIndex:od})}),ik&&!ef?(0,n.jsx)(ee.Z,{onAgentConnectorSuccess:rw,unConfiguredAgentConnectors:t5,unConfiguredOrgLevelAgentConnectors:t3,validAppConnectors:eG,agentInfo:eJ}):rT&&(null==re?void 0:re.length)>0&&(0,n.jsxs)("div",{"data-convo-content":!0,ref:lW,style:{fontFamily:'ui-sans-serif, -apple-system, system-ui, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"'},onWheel:e=>{var l,t;null===(t=e4.current)||void 0===t||null===(l=t.forceSetAlreadyStopped)||void 0===l||l.call(t,!0)},className:" absolute top-0 left-0 right-0 bottom-0 prose0 ",children:[(0,n.jsx)(eI,{isStreaming:nZ,refAnchor:e9,ref:e4,stopClassName:"absolute transform -translate-x-1/2 flex justify-center !bottom-[36px] !bg-darkcoloro dark:!bg-[rgb(33,33,33)] hover:dark:!bg-[rgb(63,63,63)] !border-[1px] !border-[rgba(118,118,118,1)] !shadow-[0_0_7px_rgba(0,0,0,0.7)] items-center !w-[32px] !h-[32px] !rounded-full cursor-pointer left-1/2 ".concat("ai_engineer"===oO&&(null==re?void 0:re.length)<3?"hidden":""),children:rH}),(0,n.jsx)("div",{className:"relative ml-[2px]",children:(0,n.jsx)("div",{className:"relative border-[1px] border-transparent",ref:oP},"a"+ob)})]})]})}),(0,n.jsx)("div",{ref:e3})]}),!eP&&!ef&&!rD&&rB&&!or&&(0,n.jsx)("div",{style:{height:l5+((null==t_?void 0:t_[lg])&&!nc?16:0)+(nc&&(null==t_?void 0:t_[lg])?36:0)+(tV?20:-13)+"px"},className:" flex-shrink-0",children:(0,n.jsx)(a.ZP,{onChangeHeight:rj,isWrite:!0,textwithTableWidth0:o_,dataChat:oX,onSend:rN,doStop:rl,deploymentId:ei,deploymentConversationId:lg,botIconUrl:oF,themeApp:lQ,widthDiffChanged:ru,forceWidthDiff:oC,sideBySideWW:oE,canSideBySide:oN>0,onRemoveFileByID:iU,onUploadDoc:iH,isAgent:ec,isBinaryEnable:ek,supportsBinaryUpload:th,isProcessing:nH||tC||nZ||nB,setIsProcessing:nF,setIsRegenerateProcessing:nU,isProcessingUpload:ts,setIsProcessingUpload:ta,isSelfServe:em,isMobile:e_,appId:oO,conversationWarning:null==t_?void 0:t_[lg],disabled:eR&&(!!(null==t5?void 0:t5.length)||!!(null==t3?void 0:t3.length)),humanizeInstructions:i3,scoreIndex:oa,setScoreIndex:od,isTaskConversation:rP,showAgentWorkflowPreview:rW,hasThinkingOption:iu,textareaRef:e8,doAnimateLeaveEmptySpaceScrollRef:iX,listExtApps:eN})}),nC?(0,n.jsx)(J.E.div,{className:(0,O.cn)("absolute top-[0px] bottom-[0px] right-[16px] z-[1]"),animate:{width:"400px"},children:(0,n.jsx)(eW,{botSegments:null==re?void 0:null===(z=re[null==nC?void 0:nC.botMsgId])||void 0===z?void 0:z.segments,isProcessing:nZ||nB,botIconUrl:oF,llmBotIcon:null==re?void 0:null===(H=re[null==nC?void 0:nC.botMsgId])||void 0===H?void 0:H.llmBotIcon,isLastResponse:(null==nC?void 0:nC.botMsgId)===(null==re?void 0:re.length)-1})}):null]})]})}function eX(e){let l=(0,d.useRef)();return(0,d.useEffect)(()=>{l.current=e}),l.current}},60059:function(e,l,t){"use strict";t.d(l,{Z:function(){return v}});var n=t(57437),o=t(48547),i=t(14301),r=t(2265),s=t(53436),a=t(99376),d=t(14438),u=t(3916),c=t(90216);function v(e){let{isAdmin:l,deployId:v,onlyButton:m,forceMessage:p,onChangeStatus:h,className:f,showOnTop:x}=e;(0,a.useRouter)();let[g,b]=(0,r.useState)(!1),[y,w]=(0,r.useState)(null),{ignoreDeploymentUpdate:j,forceDeploymentUpdate:I}=(0,c.J)();(0,r.useEffect)(()=>{if(w(null),!v)return;let e=null,l=()=>{(0,s.vHz)({deploymentId:v}).then(l=>{if(null==l?void 0:l.success){var t,n,o;w(null==l?void 0:null===(t=l.result)||void 0===t?void 0:t.status),["ACTIVE","FAILED","CANCELLED"].includes(null==l?void 0:null===(o=l.result)||void 0===o?void 0:null===(n=o.status)||void 0===n?void 0:n.toUpperCase())&&(w(null),clearInterval(e),e=null,I())}}).catch(l=>{clearInterval(e),e=null})};return e=setInterval(()=>{l()},5e3),l(),()=>{clearInterval(e),e=null}},[v]);let k=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=y||null;null==h||h(e)},[y]),(0,r.useEffect)(()=>{if(null!=k.current&&(clearInterval(k.current),k.current=null),g&&v)return k.current=setInterval(()=>{(0,s.vHz)({deploymentId:v}).then(e=>{var l,t;(null==e?void 0:e.success)&&["ACTIVE","STOPPED","FAILED","CANCELLED"].includes(null==e?void 0:null===(t=e.result)||void 0===t?void 0:null===(l=t.status)||void 0===l?void 0:l.toUpperCase())&&(b(!1),clearInterval(k.current),k.current=null,I())}).catch(e=>{})},3e3),()=>{clearInterval(k.current),k.current=null}},[g,v]);let C=(0,r.useMemo)(()=>u.Z.isNullOrEmpty(y)||(null==y?void 0:y.toUpperCase())==="STOPPED"?g?"Deploying...":"Deployment is Stopped":u.Z.upperFirst(y),[g,y]),A=g||!["ACTIVE","STOPPED","FAILED","CANCELLED"].includes(y)&&!!y;return(0,n.jsxs)(n.Fragment,{children:[x,(0,n.jsx)("div",{className:" flex h-full mb-[10px] w-full text-darkcolor rounded-xl px-[15px] text-center justify-center items-center "+(m?"":" bg-bwcentercolor mx-[15px] ")+" "+(null==x?"":" mt-[20px] ")+" "+(null!=f?f:" ")+" ",children:(0,n.jsxs)("div",{className:" flex items-center text-[14px] sm:text-[16px] ",children:[(!m||A)&&(0,n.jsx)("div",{className:" flex items-center justify-center "+(A?" mr-[10px] ":" mr-[20px] "),children:(0,n.jsx)(o.G,{spin:A,className:" drop-shadow-2xl "+(p?" text-yellow-600 ":A?"":" text-red-500 "),icon:p?t(85374).sq:A?t(39847).QD:t(74961).i5,transform:{size:A?18:30}})}),!m&&(0,n.jsx)("div",{children:null!=p?p:C}),!A&&!p&&(0,n.jsx)("div",{children:(0,n.jsx)(i.Z,{onClick:e=>{null!=k.current&&(clearInterval(k.current),k.current=null),b(!0),setTimeout(()=>{I()},0),(0,s.KwF)({deploymentId:v}).then(e=>{(null==e?void 0:e.success)||(b(!1),d.Am.error((null==e?void 0:e.error)||u.Z.errorDefault))}).catch(e=>{d.Am.error(u.Z.isNullOrEmpty(e)?u.Z.errorDefault:""+e),b(!1)})},useAccentColor:!0,className:" text-[14px] !py-[3px] "+(m?" ":" ml-[30px] "),children:"Re-Start Deployment"})})]})})]})}},93398:function(e,l,t){"use strict";t.d(l,{e:function(){return n}});let n=(0,t(59625).Ue)(e=>({lastUsedBot:{loaded:!1,result:null},setLastUsedBot:l=>e({lastUsedBot:l})}))},89520:function(e){e.exports={filesContent:"ConvoMain_filesContent__rBwu2"}}},function(e){e.O(0,[7466,1091,2239,3954,2957,3772,160,7179,9763,7774,2806,1100,7316,7648,5429,5969,2617,4546,2805,3623,9252,7948,1909,4106,2971,6067,1744],function(){return e(e.s=7164)}),_N_E=e.O()}]);